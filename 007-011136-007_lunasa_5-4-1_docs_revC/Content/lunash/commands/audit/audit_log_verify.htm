<!DOCTYPE html>
<html xmlns:MadCap="http://www.madcapsoftware.com/Schemas/MadCap.xsd" lang="en-us" xml:lang="en-us" data-mc-search-type="Stem" data-mc-help-system-file-name="index.xml" data-mc-path-to-help-system="../../../../" data-mc-conditions="Primary.Default" data-mc-target-type="WebHelp2" data-mc-runtime-file-type="Topic" data-mc-preload-images="false" data-mc-in-preview-mode="false" data-mc-medium="non-print" data-mc-toc-path="LunaSH Command Reference Guide|LunaSH Commands|audit">
    <head>
        <meta charset="utf-8" />
        <meta http-equiv="Content-Type" content="text/html; charset=utf-8" /><title>audit log verify</title>
        <link href="../../../Resources/TableStyles/Page.css" rel="stylesheet" />
        <link href="../../../../Skins/Default/Stylesheets/TextEffects.css" rel="stylesheet" />
        <link href="../../../../Skins/Default/Stylesheets/Topic.css" rel="stylesheet" />
        <link href="../../../Resources/TableStyles/Breadcrumbs.css" rel="stylesheet" />
        <link href="../../../Resources/Stylesheets/SafeNet_Template.css" rel="stylesheet" />
        <script src="../../../../Resources/Scripts/jquery.min.js">
        </script>
        <script src="../../../../Resources/Scripts/plugins.min.js">
        </script>
        <script src="../../../../Resources/Scripts/require.min.js">
        </script>
        <script src="../../../../Resources/Scripts/require.config.js">
        </script>
        <script src="../../../../Resources/Scripts/MadCapAll.js">
        </script>
    </head>
    <body>
        <p class="MCWebHelpFramesetLink MCWebHelpFramesetLinkTop"><a href="../../../../index.html#lunash/commands/audit/audit_log_verify.htm">Open topic with navigation</a>
        </p>
        <table style="width: 100%;border-spacing: 0px 0px;mc-table-style: url('../../../Resources/TableStyles/Breadcrumbs.css');border-left-style: none;border-left-width: 1px;border-left-color: #000000;border-right-style: none;border-right-width: 1px;border-right-color: #000000;border-top-style: none;border-top-width: 0px;border-top-color: #000000;border-bottom-style: solid;border-bottom-width: 2px;border-bottom-color: #e6e6e6;" class="TableStyle-Breadcrumbs" cellspacing="0">
            <col style="width: 41px;" class="TableStyle-Breadcrumbs-Column-Column1" />
            <col class="TableStyle-Breadcrumbs-Column-Column1" />
            <tbody>
                <tr class="TableStyle-Breadcrumbs-Body-Body1">
                    <th class="TableStyle-Breadcrumbs-BodyB-Column1-Body1">
                        <p class="home" style="font-weight: normal;"><a href="../../../Home_sa.htm">Home</a> &gt;
                        </p>
                    </th>
                    <th class="TableStyle-Breadcrumbs-BodyA-Column1-Body1">
                        <div class="MCBreadcrumbsBox_0"><span class="MCBreadcrumbsPrefix"> </span><span class="MCBreadcrumbsSelf">LunaSH Command Reference Guide</span><span class="MCBreadcrumbsDivider"> &gt; </span><a class="MCBreadcrumbsLink" href="../commands.htm">LunaSH Commands</a><span class="MCBreadcrumbsDivider"> &gt; </span><a class="MCBreadcrumbsLink" href="audit.htm">audit</a><span class="MCBreadcrumbsDivider"> &gt; </span><span class="MCBreadcrumbs">audit log verify</span>
                        </div>
                    </th>
                </tr>
            </tbody>
        </table>
        <h2 class="pageBreak"><a name="aanchor45"></a>
            <MadCap:concept term="HSM login" /><a name="kanchor264"></a><a name="kanchor265"></a>audit log verify</h2>
        <p>Verify the audit log records.</p>
        <h3 class="ntoc">Syntax</h3>
        <p class="code"><b>audit log verify -file</b> &lt;filename&gt; [<b>-serialtarget</b> &lt;serialnum&gt;]  [<b>-serialsource</b> &lt;serialnum&gt;] [<b>-start</b> &lt;number&gt;] [<b>-end</b> &lt;number&gt;] [<b>-external</b>]</p>
        <table style="caption-side: top;width: 100%;mc-table-style: url('../../../Resources/TableStyles/Page.css');" class="TableStyle-Page" cellspacing="0">
            <col class="Column-Column1" style="width: 159px;" />
            <col class="Column-Column1" style="width: 96px;" />
            <col class="Column-Column1" style="width: 291px;" />
            <thead>
                <tr class="Head-Header1">
                    <th class="HeadE-Column1-Header1">Parameter</th>
                    <th class="HeadE-Column1-Header1">Shortcut</th>
                    <th class="HeadD-Column1-Header1">Description </th>
                </tr>
            </thead>
            <tbody>
                <tr class="Body-Body1">
                    <td class="BodyE-Column1-Body1" style="font-weight: bold;">-end</td>
                    <td class="BodyE-Column1-Body1" style="font-weight: bold;">-en</td>
                    <td class="BodyD-Column1-Body1">
                        <p>Specifies the final record of the subset of records to be verified from the file.</p>
                    </td>
                </tr>
                <tr class="Body-Body1">
                    <td class="BodyE-Column1-Body1" style="font-weight: bold;">-external</td>
                    <td class="BodyE-Column1-Body1" style="font-weight: bold;">-ex</td>
                    <td class="BodyD-Column1-Body1">
                        <p>Specifies that the file from which log entries are to be verified is from an external HSM. In this case, the audit secret for that HSM must either be the same secret (white PED Key) as is used on the current HSM, or must have been imported to the current HSM. </p>
                        <p>The current HSM's own audit secret cannot verify log files from other HSMs if those were created using independent secrets. The HSM holds only one audit secret at a time, so the secret for the relevant HSM's logs must be brought into the HSM when needed for log verification, if it is not already present. </p>
                    </td>
                </tr>
                <tr class="Body-Body1">
                    <td class="BodyE-Column1-Body1" style="font-weight: bold;">-file</td>
                    <td class="BodyE-Column1-Body1" style="font-weight: bold;">-f</td>
                    <td class="BodyD-Column1-Body1">Specifies the name of the log file to verify.</td>
                </tr>
                <tr class="Body-Body1">
                    <td class="BodyE-Column1-Body1" style="font-weight: bold;">-serialsource</td>
                    <td class="BodyE-Column1-Body1" style="font-weight: bold;">-serials</td>
                    <td class="BodyD-Column1-Body1">
                        <p>Specifies the serial number of the HSM that generated the log file that is being verified.</p>
                    </td>
                </tr>
                <tr class="Body-Body1">
                    <td class="BodyE-Column1-Body1" style="font-weight: bold;">-serialtarget</td>
                    <td class="BodyE-Column1-Body1" style="font-weight: bold;">-serialt</td>
                    <td class="BodyD-Column1-Body1">
                        <p>Specifies the serial number of the HSM that is performing the verification.</p>
                    </td>
                </tr>
                <tr class="Body-Body1">
                    <td class="BodyB-Column1-Body1" style="font-weight: bold;">-start</td>
                    <td class="BodyB-Column1-Body1" style="font-weight: bold;">-st</td>
                    <td class="BodyA-Column1-Body1">
                        <p>Specifies the starting record of the subset of records to be verified from the file. &#160;&#160;</p>
                    </td>
                </tr>
            </tbody>
        </table>
        <h3 class="ntoc">Example</h3>
        <h5>Verification of my own log file, with my own secret</h5><pre xml:space="preserve">
lunash:&gt;audit log verify -f hsm_150073_00000011.log

Log file being verified hsm_150073_00000011.log.

Verifying log on HSM with serial 150073

Verified messages 236 to 236

Command Result : 0 (Success)
  </pre>
        <h5>Attempted verification of external log, with my own secret</h5><pre xml:space="preserve">
lunash:&gt;audit log verify -f hsm_100548_000004a3.log

Log file being verified /home/audit/lush_files/hsm_100548_000004a3.log.

Verifying log from HSM with serial 150073 on HSM with serial 150073
Make sure that you have already imported the audit log secret.

Verify failed on record 10760271

If you have imported a log secret from another HSM please export then re-import
your own log secret. For security reasons it is not possible to verify logs
using two difference secrets at the same time.One or more messages did not verify.

The audit sub-command failed. (LUNA_RET_LOG_BAD_RECORD_HMAC)

Command Result : 65535 (Luna Shell execution)
</pre>
        <h5>Verification of external log with external secret:</h5>
        <p>In this example, we show the process from both HSMs.</p><pre xml:space="preserve">
[myluna72] lunash:&gt; audit secret export

The encrypted log secret file 153593.lws now available for scp.

Now that you have exported your log secret, if you wish to verify your logs
on another HSM see the 'audit secret import' command. If you wish to verify
your logs on another Luna SA see the 'audit log tar' command.

Command Result : 0 (Success)</pre><pre xml:space="preserve">
[myluna72] lunash:&gt;audit log tar


Compressing log files:

153593/
153593/hsm_153593_00000019.log
153593/153593.lws
153593/ready_for_archive/
153593/ready_for_archive/hsm_153593_0000000b.log
153593/ready_for_archive/hsm_153593_00000003.log
153593/ready_for_archive/hsm_153593_00000002.log
153593/ready_for_archive/hsm_153593_00000011.log
153593/ready_for_archive/hsm_153593_00000010.log
153593/ready_for_archive/hsm_153593_00000007.log
153593/ready_for_archive/hsm_153593_00000005.log
153593/ready_for_archive/hsm_153593_00000004.log
153593/ready_for_archive/hsm_153593_00000016.log
153593/ready_for_archive/hsm_153593_0000000a.log
153593/ready_for_archive/hsm_153593_0000000d.log
153593/ready_for_archive/hsm_153593_00000009.log
153593/ready_for_archive/hsm_153593_00000008.log
153593/ready_for_archive/hsm_153593_00000013.log
153593/ready_for_archive/hsm_153593_0000000f.log
153593/ready_for_archive/hsm_153593_00000014.log
153593/ready_for_archive/hsm_153593_00000015.log
153593/ready_for_archive/hsm_153593_00000018.log
153593/ready_for_archive/hsm_153593_0000000c.log
153593/ready_for_archive/hsm_153593_0000000e.log
153593/ready_for_archive/hsm_153593_00000012.log
153593/ready_for_archive/hsm_153593_00000017.log
153593/ready_for_archive/hsm_153593_00000006.log
153593/ready_for_archive/hsm_153593_00000001.log

The tar file containing logs is now available as file 'audit-153593.tgz'.
If you wish to verify your logs on another SA, scp them to another SA's audit
directory then use the 'audit log untar' command.

Command Result : 0 (Success)
</pre>
        <p>
            <br />Here is where we scp the secret file and the .tgz file to a different Luna SA
<br /></p><pre xml:space="preserve">
lunash:&gt; audit secret import -serialtarget 150825 -file 153593.lws -serialsource 153593

Successfully imported the encrypted log secret 153593.lws

Now that you have imported a log secret if you wish to verify
your logs please see the 'audit log verify' command.

Command Result : 0 (Success)
[myluna73] lunash:&gt; audit log untarlogs -file audit-153593.tgz

Extracting logs to audit home:

153593/
153593/hsm_153593_00000019.log
153593/153593.lws
153593/ready_for_archive/
153593/ready_for_archive/hsm_153593_0000000b.log
153593/ready_for_archive/hsm_153593_00000003.log
153593/ready_for_archive/hsm_153593_00000002.log
153593/ready_for_archive/hsm_153593_00000011.log
153593/ready_for_archive/hsm_153593_00000010.log
153593/ready_for_archive/hsm_153593_00000007.log
153593/ready_for_archive/hsm_153593_00000005.log
153593/ready_for_archive/hsm_153593_00000004.log
153593/ready_for_archive/hsm_153593_00000016.log
153593/ready_for_archive/hsm_153593_0000000a.log
153593/ready_for_archive/hsm_153593_0000000d.log
153593/ready_for_archive/hsm_153593_00000009.log
153593/ready_for_archive/hsm_153593_00000008.log
153593/ready_for_archive/hsm_153593_00000013.log
153593/ready_for_archive/hsm_153593_0000000f.log
153593/ready_for_archive/hsm_153593_00000014.log
153593/ready_for_archive/hsm_153593_00000015.log
153593/ready_for_archive/hsm_153593_00000018.log
153593/ready_for_archive/hsm_153593_0000000c.log
153593/ready_for_archive/hsm_153593_0000000e.log
153593/ready_for_archive/hsm_153593_00000012.log
153593/ready_for_archive/hsm_153593_00000017.log
153593/ready_for_archive/hsm_153593_00000006.log
153593/ready_for_archive/hsm_153593_00000001.log

To verify these logs see the 'audit secret import' command to import the HSM's
log secret.

Command Result : 0 (Success)
[myluna73] lunash:&gt; audit log verify -serialtarget 150825 -file hsm_153593_00000001.log -serialsource 153593


Log file being verified /home/audit/lush_files/153593/ready_for_archive/hsm_153593_00000001.log.

Verifying log from HSM with serial 153593 on HSM with serial 150825
 Make sure that you have already imported the audit log secret.

Verified messages 39638 to 39641

Command Result : 0 (Success)
[myluna73] </pre>
        <p>&#160;</p>
        <p class="notepad_note">On the verifying HSM ([myluna73] in the example),  you just imported a secret (displacing the native secret of the local HSM) and used it to verify logs that were transported from a different HSM ([myluna<strong>72</strong>] in the example). <br /><br />If you now wished to verify the second HSM's ([myluna73]) own log files, you would need to re-import that HSM's secret, having replaced it with the other HSM's ([myluna72]'s0 secret for the example operation. <br /><br />That is, [myluna72]'s log secret that was imported into [myluna73] to allow [myluna73] to verify logs received from [myluna72], is not useful to verify [myluna73]'s own logs. An HSM can have only one log secret at a time, so [myluna73] needs its own secret back if it is to verify its own logs, rather than the logs it received from [myluna72]. </p>
        <h5>Attempted Verification of local log with external secret:</h5><pre xml:space="preserve">
[myluna] lunash:&gt;audit log verify -f hsm_150073_00000011.log

Log file being verified hsm_150073_00000011.log.

Verifying log on HSM with serial 150073

Verify failed on record 236

If you have imported a log secret from another HSM please export then re-import
your own log secret. For security reasons it is not possible to verify logs
using two difference secrets at the same time. One or more messages did not verify.
The log file you specified was either open by the logger daemon, or was
improperly terminated.  If the file was open by the logger daemon, the
content of it may have changed as the result of new messages being logged.
In this case, running the query again will succeed.

The audit sub-command failed. (LUNA_RET_LOG_BAD_RECORD_HMAC)


Command Result : 65535 (Luna Shell execution)
[myluna] lunash:&gt;
</pre>
        <p>&#160;</p>
        <p class="footer"><span class="DefaultProduct">Luna SA</span> <span class="DefaultRelease">5.4.1</span> <span class="DefaultProjectTitle">Product Documentation</span> <br /><span class="DefaultPartNumber">007-011136-007</span> <span class="DefaultRevision">Rev C</span> <span style="color: #5e5e5c;"> <![CDATA[ ]]></span> <span class="DefaultDateShort">July 2014</span> <span style="color: #5e5e5c;"> <![CDATA[ ]]></span> <span class="DefaultCopyright">Copyright 2014</span>&#160;<span class="DefaultCompanyNameLong">SafeNet, Inc.</span> <span style="color: #5e5e5c;"> <![CDATA[ ]]></span>All rights reserved. </p>
        <p class="MCWebHelpFramesetLink MCWebHelpFramesetLinkBottom"><a href="../../../../index.html#lunash/commands/audit/audit_log_verify.htm">Open topic with navigation</a>
        </p>
    </body>
</html>