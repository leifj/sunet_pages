<!DOCTYPE html>
<html xmlns:MadCap="http://www.madcapsoftware.com/Schemas/MadCap.xsd" lang="en-us" xml:lang="en-us" data-mc-search-type="Stem" data-mc-help-system-file-name="index.xml" data-mc-path-to-help-system="../../../" data-mc-conditions="Primary.Default" data-mc-target-type="WebHelp2" data-mc-runtime-file-type="Topic" data-mc-preload-images="false" data-mc-in-preview-mode="false" data-mc-medium="non-print" data-mc-toc-path="SDK Reference Guide|Supported Mechanisms">
    <head>
        <meta charset="utf-8" />
        <meta http-equiv="Content-Type" content="text/html; charset=utf-8" /><title>CKM_DES2_DUKPT_DATA</title>
        <link href="../../Resources/TableStyles/Page.css" rel="stylesheet" />
        <link href="../../../Skins/Default/Stylesheets/TextEffects.css" rel="stylesheet" />
        <link href="../../../Skins/Default/Stylesheets/Topic.css" rel="stylesheet" />
        <link href="../../Resources/TableStyles/Breadcrumbs.css" rel="stylesheet" />
        <link href="../../Resources/Stylesheets/SafeNet_Template.css" rel="stylesheet" />
        <script src="../../../Resources/Scripts/jquery.min.js">
        </script>
        <script src="../../../Resources/Scripts/plugins.min.js">
        </script>
        <script src="../../../Resources/Scripts/require.min.js">
        </script>
        <script src="../../../Resources/Scripts/require.config.js">
        </script>
        <script src="../../../Resources/Scripts/MadCapAll.js">
        </script>
    </head>
    <body>
        <p class="MCWebHelpFramesetLink MCWebHelpFramesetLinkTop"><a href="../../../index.html#sdk/mechanisms/CKM_DES2_DUKPT_DATA.htm">Open topic with navigation</a>
        </p>
        <table style="width: 100%;border-spacing: 0px 0px;mc-table-style: url('../../Resources/TableStyles/Breadcrumbs.css');border-left-style: none;border-left-width: 1px;border-left-color: #000000;border-right-style: none;border-right-width: 1px;border-right-color: #000000;border-top-style: none;border-top-width: 0px;border-top-color: #000000;border-bottom-style: solid;border-bottom-width: 2px;border-bottom-color: #e6e6e6;" class="TableStyle-Breadcrumbs" cellspacing="0">
            <col style="width: 41px;" class="TableStyle-Breadcrumbs-Column-Column1" />
            <col class="TableStyle-Breadcrumbs-Column-Column1" />
            <tbody>
                <tr class="TableStyle-Breadcrumbs-Body-Body1">
                    <th class="TableStyle-Breadcrumbs-BodyB-Column1-Body1">
                        <p class="home" style="font-weight: normal;"><a href="../../Home_sa.htm">Home</a> &gt;
                        </p>
                    </th>
                    <th class="TableStyle-Breadcrumbs-BodyA-Column1-Body1">
                        <div class="MCBreadcrumbsBox_0"><span class="MCBreadcrumbsPrefix">  <![CDATA[ ]]></span><span class="MCBreadcrumbsSelf">SDK Reference Guide</span><span class="MCBreadcrumbsDivider"> &gt; </span><a class="MCBreadcrumbsLink" href="mechanisms.htm">Supported Mechanisms</a><span class="MCBreadcrumbsDivider"> &gt; </span><span class="MCBreadcrumbs">CKM_DES2_DUKPT_DATA</span>
                        </div>
                    </th>
                </tr>
            </tbody>
        </table>
        <h2 class="pageBreak">CKM_DES2_DUKPT_DATA</h2>
        <p>The CKM_DES2_DUKPT family of key derive mechanisms create keys used to protect EFTPOS terminal sessions.  The mechanisms implement the algorithm for server side DUKPT derivation as defined by ANSI X9.24 part 1.</p>
        <h3 class="ntoc">Summary</h3>
        <table style="width: 100%;mc-table-style: url('../../Resources/TableStyles/Page.css');" class="TableStyle-Page" cellspacing="0">
            <tbody>
                <tr class="Body-Body1">
                    <td style="font-weight: bold;" class="BodyE-Column1-Body1">FIPS approved?</td>
                    <td class="BodyD-Column1-Body1">No</td>
                </tr>
                <tr class="Body-Body1">
                    <td style="font-weight: bold;" class="BodyE-Column1-Body1">Supported functions</td>
                    <td class="BodyD-Column1-Body1">Derive</td>
                </tr>
                <tr class="Body-Body1">
                    <td style="font-weight: bold;" class="BodyE-Column1-Body1">Minimum key length (bits)</td>
                    <td class="BodyD-Column1-Body1">128</td>
                </tr>
                <tr class="Body-Body1">
                    <td style="font-weight: bold;" class="BodyE-Column1-Body1">Minimum key length for FIPS use (bits)</td>
                    <td class="BodyD-Column1-Body1">128</td>
                </tr>
                <tr class="Body-Body1">
                    <td style="font-weight: bold;" class="BodyE-Column1-Body1">Minimum legacy key length for FIPS use (bits)</td>
                    <td class="BodyD-Column1-Body1">N/A</td>
                </tr>
                <tr class="Body-Body1">
                    <td style="font-weight: bold;" class="BodyE-Column1-Body1">Maximum key length (bits)</td>
                    <td class="BodyD-Column1-Body1">192</td>
                </tr>
                <tr class="Body-Body1">
                    <td style="font-weight: bold;" class="BodyE-Column1-Body1">Block size</td>
                    <td class="BodyD-Column1-Body1">0</td>
                </tr>
                <tr class="Body-Body1">
                    <td style="font-weight: bold;" class="BodyE-Column1-Body1">Digest size</td>
                    <td class="BodyD-Column1-Body1">0</td>
                </tr>
                <tr class="Body-Body1">
                    <td style="font-weight: bold;" class="BodyE-Column1-Body1">Key types</td>
                    <td class="BodyD-Column1-Body1">None</td>
                </tr>
                <tr class="Body-Body1">
                    <td style="font-weight: bold;" class="BodyE-Column1-Body1">Algorithms</td>
                    <td class="BodyD-Column1-Body1">None</td>
                </tr>
                <tr class="Body-Body1">
                    <td style="font-weight: bold;" class="BodyE-Column1-Body1">Modes</td>
                    <td class="BodyD-Column1-Body1">None</td>
                </tr>
                <tr class="Body-Body1">
                    <td style="font-weight: bold;" class="BodyB-Column1-Body1">Flags</td>
                    <td class="BodyA-Column1-Body1">None</td>
                </tr>
            </tbody>
        </table>
        <h3 class="ntoc">Usage</h3>
        <p>This mechanism has the following attributes:</p>
        <p class="ul1" data-mc-autonum="&lt;b&gt;•&lt;/b&gt;"><span class="autonumber"><span class="ul1Bullet"><b>•</b></span></span>Only CKK_DES2 keys can be derived. The mechanism will force the CKA_KEY_TYPE attribute of the derived object to equal CKK_DES2. If the template does specify a CKA_KEY_TYPE attribute then it must be CKK_DES2.</p>
        <p class="ul1" data-mc-autonum="&lt;b&gt;•&lt;/b&gt;"><span class="autonumber"><span class="ul1Bullet"><b>•</b></span></span>The mechanism takes a CK_KEY_DERIVATION_STRING_DATA structure as a parameter.</p>
        <p class="ul1" data-mc-autonum="&lt;b&gt;•&lt;/b&gt;"><span class="autonumber"><span class="ul1Bullet"><b>•</b></span></span>The pData field of the parameter must point to a 10 byte array which holds the 80 bit Key Sequence Number (KSN).</p>
        <p class="ul1" data-mc-autonum="&lt;b&gt;•&lt;/b&gt;"><span class="autonumber"><span class="ul1Bullet"><b>•</b></span></span>This mechanism contributes the CKA_CLASS and CKA_KEY_TYPE and CKA_VALUE to the resulting object.</p>
        <p>The DUKPT MAC and DATA versions will default to the appropriate usage mechanism as described in the following table:</p>
        <table style="width: 100%;mc-table-style: url('../../Resources/TableStyles/Page.css');" class="TableStyle-Page" cellspacing="0">
            <col class="Column-Column1" />
            <col class="Column-Column1" />
            <col class="Column-Column1" />
            <col class="Column-Column1" />
            <col class="Column-Column1" />
            <thead>
                <tr class="Head-Header1">
                    <th class="HeadE-Column1-Header1">Mechanism</th>
                    <th class="HeadE-Column1-Header1">CKA_SIGN</th>
                    <th class="HeadE-Column1-Header1">CKA_VERIFY</th>
                    <th class="HeadE-Column1-Header1">CKA_DECRYPT</th>
                    <th class="HeadD-Column1-Header1">CKA_ENCRYPT</th>
                </tr>
            </thead>
            <tbody>
                <tr class="Body-Body1">
                    <td class="BodyE-Column1-Body1">CKM_DES2_DUKPT_MAC</td>
                    <td class="BodyE-Column1-Body1">True</td>
                    <td class="BodyE-Column1-Body1">True</td>
                    <td class="BodyE-Column1-Body1">&#160;</td>
                    <td class="BodyD-Column1-Body1">&#160;</td>
                </tr>
                <tr class="Body-Body1">
                    <td class="BodyE-Column1-Body1">CKM_DES2_DUKPT_MAC_RESP</td>
                    <td class="BodyE-Column1-Body1">True</td>
                    <td class="BodyE-Column1-Body1">&#160;</td>
                    <td class="BodyE-Column1-Body1">&#160;</td>
                    <td class="BodyD-Column1-Body1">&#160;</td>
                </tr>
                <tr class="Body-Body1">
                    <td class="BodyE-Column1-Body1">CKM_DES2_DUKPT_DATA</td>
                    <td class="BodyE-Column1-Body1">&#160;</td>
                    <td class="BodyE-Column1-Body1">&#160;</td>
                    <td class="BodyE-Column1-Body1">True</td>
                    <td class="BodyD-Column1-Body1">True</td>
                </tr>
                <tr class="Body-Body1">
                    <td class="BodyB-Column1-Body1">CKM_DES2_DUKPT_DATA_RESP</td>
                    <td class="BodyB-Column1-Body1">&#160;</td>
                    <td class="BodyB-Column1-Body1">&#160;</td>
                    <td class="BodyB-Column1-Body1">&#160;</td>
                    <td class="BodyA-Column1-Body1">True</td>
                </tr>
            </tbody>
        </table>
        <h3 class="ntoc">Example</h3><pre xml:space="preserve">#define CKM_DES2_DUKPT_PIN		(CKM_VENDOR_DEFINED + 0x611)</pre><pre xml:space="preserve">#define CKM_DES2_DUKPT_MAC		(CKM_VENDOR_DEFINED + 0x612)</pre><pre xml:space="preserve">#define CKM_DES2_DUKPT_MAC_RESP  	(CKM_VENDOR_DEFINED + 0x613)</pre><pre xml:space="preserve">#define CKM_DES2_DUKPT_DATA		(CKM_VENDOR_DEFINED + 0x614)</pre><pre xml:space="preserve">#define CKM_DES2_DUKPT_DATA_RESP 	(CKM_VENDOR_DEFINED + 0x615)</pre><pre xml:space="preserve">&#160;</pre><pre xml:space="preserve">CK_OBJECT_HANDLE hBDKey; // handle of CKK_DES2 or CKK_DES2 Base Derive Key</pre><pre xml:space="preserve">CK_OBJECT_HANDLE hMKey;   // handle of CKK_DES2 MAC session Key</pre><pre xml:space="preserve">CK_MECHANISM svMech = { CKM_DES3_X919_MAC , NULL, 0};</pre><pre xml:space="preserve">&#160;</pre><pre xml:space="preserve">CK_KEY_DERIVATION_STRING_DATA param;</pre><pre xml:space="preserve">CK_MECHANISM kdMech = { CKM_DES2_DUKPT_MAC , NULL, 0};</pre><pre xml:space="preserve">CK_CHAR ksn[10];</pre><pre xml:space="preserve">CK_CHAR inp[any length];</pre><pre xml:space="preserve">CK_CHAR mac[4];</pre><pre xml:space="preserve">CK_SIZE len;</pre><pre xml:space="preserve">&#160;</pre><pre xml:space="preserve">// Derive MAC verify session key</pre><pre xml:space="preserve">param.pData=ksn;</pre><pre xml:space="preserve">param.ulLen = 10;</pre><pre xml:space="preserve">&#160;</pre><pre xml:space="preserve">kdMech.mechanism = CKM_DES2_DUKPT_MAC;</pre><pre xml:space="preserve">kdMech.pParameter = &amp;param;</pre><pre xml:space="preserve">kdMech.ulParameterLen = sizeof parram;</pre><pre xml:space="preserve">&#160;</pre><pre xml:space="preserve">C_DeriveKey(hSes, &amp;kdMech, hBDKey , NULL, 0, &amp;hMKey);</pre><pre xml:space="preserve">&#160;</pre><pre xml:space="preserve">// Single part verify operation</pre><pre xml:space="preserve">&#160;</pre><pre xml:space="preserve">C_VerifyInit(hSes, &amp;svMech, hMKey);</pre><pre xml:space="preserve">len = sizeof mac;</pre><pre xml:space="preserve">C_Verify(hSes, inp, sizeof inp, mac, len);</pre><pre xml:space="preserve">&#160;</pre><pre xml:space="preserve">// clean up</pre><pre xml:space="preserve">&#160;</pre><pre xml:space="preserve">C_DestroyObject(hSes, hMKey);</pre><pre xml:space="preserve">&#160;</pre><pre xml:space="preserve">// Test vectors</pre>
        <p class="footer"><span class="DefaultProduct">Luna SA</span> <span class="DefaultRelease">5.4.1</span> <span class="DefaultProjectTitle">Product Documentation</span> <br /><span class="DefaultPartNumber">007-011136-007</span> <span class="DefaultRevision">Rev C</span> <span style="color: #5e5e5c;"> </span> <span class="DefaultDateShort">July 2014</span> <span style="color: #5e5e5c;"> </span> <span class="DefaultCopyright">Copyright 2014</span>&#160;<span class="DefaultCompanyNameLong">SafeNet, Inc.</span> <span style="color: #5e5e5c;"> </span>All rights reserved. </p>
        <p class="MCWebHelpFramesetLink MCWebHelpFramesetLinkBottom"><a href="../../../index.html#sdk/mechanisms/CKM_DES2_DUKPT_DATA.htm">Open topic with navigation</a>
        </p>
    </body>
</html>