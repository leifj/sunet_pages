<!DOCTYPE html>
<html xmlns:MadCap="http://www.madcapsoftware.com/Schemas/MadCap.xsd" lang="en-us" xml:lang="en-us" data-mc-search-type="Stem" data-mc-help-system-file-name="index.xml" data-mc-path-to-help-system="../../../" data-mc-conditions="Primary.Default" data-mc-target-type="WebHelp2" data-mc-runtime-file-type="Topic" data-mc-preload-images="false" data-mc-in-preview-mode="false" data-mc-medium="non-print" data-mc-toc-path="Luna SA Appliance Administration Guide|Backing Up the Appliance Configuration">
    <head>
        <meta charset="utf-8" />
        <meta http-equiv="Content-Type" content="text/html; charset=utf-8" /><title>Backup and Restore Your Appliance Service Configuration</title>
        <link href="../../../Skins/Default/Stylesheets/TextEffects.css" rel="stylesheet" />
        <link href="../../../Skins/Default/Stylesheets/Topic.css" rel="stylesheet" />
        <link href="../../Resources/TableStyles/Breadcrumbs.css" rel="stylesheet" />
        <link href="../../Resources/Stylesheets/SafeNet_Template.css" rel="stylesheet" />
        <script src="../../../Resources/Scripts/jquery.min.js">
        </script>
        <script src="../../../Resources/Scripts/plugins.min.js">
        </script>
        <script src="../../../Resources/Scripts/require.min.js">
        </script>
        <script src="../../../Resources/Scripts/require.config.js">
        </script>
        <script src="../../../Resources/Scripts/MadCapAll.js">
        </script>
    </head>
    <body>
        <p class="MCWebHelpFramesetLink MCWebHelpFramesetLinkTop"><a href="../../../index.html#sa_appliance_admin/backup/backup-restore_your_service_config.htm">Open topic with navigation</a>
        </p>
        <table style="width: 100%;border-spacing: 0px 0px;mc-table-style: url('../../Resources/TableStyles/Breadcrumbs.css');border-left-style: none;border-left-width: 1px;border-left-color: #000000;border-right-style: none;border-right-width: 1px;border-right-color: #000000;border-top-style: none;border-top-width: 0px;border-top-color: #000000;border-bottom-style: solid;border-bottom-width: 2px;border-bottom-color: #e6e6e6;" class="TableStyle-Breadcrumbs" cellspacing="0">
            <col style="width: 41px;" class="TableStyle-Breadcrumbs-Column-Column1" />
            <col class="TableStyle-Breadcrumbs-Column-Column1" />
            <tbody>
                <tr class="TableStyle-Breadcrumbs-Body-Body1">
                    <th class="TableStyle-Breadcrumbs-BodyB-Column1-Body1">
                        <p class="home" style="font-weight: normal;"><a href="../../Home_sa.htm">Home</a> &gt;
                        </p>
                    </th>
                    <th class="TableStyle-Breadcrumbs-BodyA-Column1-Body1">
                        <div class="MCBreadcrumbsBox_0"><span class="MCBreadcrumbsPrefix">  <![CDATA[ ]]></span><span class="MCBreadcrumbsSelf">Luna SA Appliance Administration Guide</span><span class="MCBreadcrumbsDivider"> &gt; </span><a class="MCBreadcrumbsLink" href="backup.htm">Backing Up the Appliance Configuration</a><span class="MCBreadcrumbsDivider"> &gt; </span><span class="MCBreadcrumbs">Backup and Restore Your Appliance Service Configuration</span>
                        </div>
                    </th>
                </tr>
            </tbody>
        </table>
        <h2>Backup and Restore Your Appliance Service Configuration</h2>
        <p>Luna SA stores details of your appliance's configuration settings for various services. Use the <code>sysconf config</code> commands to access and manage those settings. A file named "factoryInit_local_host_Config.tar.gz" preserves the original factory settings for all the configurable appliance services [ network, SSH, NTLS, syslog, NTP, SNMP, users, and system services ].</p>
        <p>You can create a backup summary of the state of all those service parameters at any time with <code>sysconf config backup -description &lt;some_words_of comment&gt;</code>, and you can list all such files, complete with the description you provided for each one with <code>sysconf config list</code>.</p>
        <p>At any time, you can reset all the configurable appliance parameters back to factory state with <code>sysconf config factoryReset</code>, which applies the settings from "factoryInit_local_host_Config.tar.gz". When you run that command, the system first takes a snapshot of your current settings, in case you later wish to revert back from original factory settings to the settings you had just before<code>sysconf config factoryReset</code> was issued. </p>
        <p>Thus the configuration settings file area will always contain the original factory file, and might additionally contain any number of intentionally created backups, and possibly one or more automatic backup files, similar to this example for a Luna&#160;SA&#160;appliance named "sa5":</p><pre xml:space="preserve">[sa5] lunash:&gt;sysconf config list</pre><pre xml:space="preserve">Configuration backup files in file system:</pre><pre xml:space="preserve">Size		File Name  &#160;&#160;&#160;				Description. &#160;&#160;&#160;</pre><pre xml:space="preserve">16641&#160;&#160;&#160;&#160;   | &#160;sa5_Config_20120222_0556.tar.gz&#160;&#160;&#160;&#160;&#160;&#160;   | &#160;testing-this &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;    &#160; </pre><pre xml:space="preserve">.7028&#160;&#160;&#160;&#160;   | &#160;factoryInit_local_host_Config.tar.gz&#160;  &#160;| &#160;Initial Factory Settings&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;    &#160; </pre><pre xml:space="preserve">16588&#160;&#160;&#160;&#160;   | &#160;sa5_Config_20120222_0558.tar.gz&#160;&#160;&#160;&#160;&#160;&#160;   | &#160;Automatic Backup Before Restoring&#160;   &#160; </pre><pre xml:space="preserve">Command Result : 0 (Success) <br />[sa5] lunash:&gt;sysconf config restore</pre>
        <p>&#160;</p>
        <p>If you wish, you can keep only the backup files that you find useful, and individually delete any others with <code>sysconf config delete -file &lt;filename&gt;</code>.</p>
        <p>Optionally, you clear away all the files with <code>sysconf config clear</code>.</p>
        <p>Either way, the file "factoryInit_local_host_Config.tar.gz" is not touched.</p>
        <p>Note that the configuration backup file area is a special-purpose location. You will not see those files listed if you run the command <code>my file list</code>.</p>
        <h3>Example of Backing Up and Restoring </h3>
        <p>If we factoryReset the configuration parameters, a snapshot backup is created automatically, but for this example we will explicitly create a config backup file. </p>
        <p>Create a backup of current appliance configuration parameters.</p><pre xml:space="preserve">[sa5] lunash:&gt;sysconf config backup -description testing-this backup feature</pre><pre xml:space="preserve">Created configuration backup file: sa5_Config_20120222_0556.tar.gz</pre><pre xml:space="preserve">Command Result : 0 (Success) <br />[sa5] lunash:&gt;</pre>
        <p>&#160;</p>
        <p>Check the current state of a configuration parameter (users).</p><pre xml:space="preserve">[sa5] lunash:&gt;user list</pre><pre xml:space="preserve">Users&#160;		Roles&#160;		Status&#160;&#160;&#160;	RADIUS&#160;</pre><pre xml:space="preserve">admin&#160;		admin&#160;		enabled&#160;	no&#160;</pre><pre xml:space="preserve">bob&#160;		monitor&#160;	enabled&#160;	no&#160;</pre><pre xml:space="preserve">john&#160;		admin&#160;		enabled&#160;	no&#160;</pre><pre xml:space="preserve">monitor&#160;	monitor&#160;	enabled&#160;	no&#160;</pre><pre xml:space="preserve">operator&#160;&#160;	operator&#160;&#160;	enabled&#160;	no&#160;</pre>
        <p class="code">&#160;</p><pre xml:space="preserve">Command Result : 0 (Success) <br />[sa5] lunash:&gt;</pre>
        <p>&#160;</p>
        <p>Perform the factory reset of the chosen configuration parameter (users).</p><pre xml:space="preserve">[sa5] lunash:&gt;sysconf config factoryReset -service users</pre><pre xml:space="preserve">This command restores the initial factory configuration of service: users. <br />The HSM and Partition configurations are NOT included.</pre><pre xml:space="preserve">WARNING !!  This command restores the configuration backup file: factoryInit_local_host_Config.tar.gz. <br />It first creates a backup of the current configuration before restoring: factoryInit_local_host_Config.tar.gz. <br />If you are sure that you wish to proceed, then type 'proceed', otherwise type 'quit'.</pre><pre xml:space="preserve">&gt; proceed <br />Proceeding...</pre><pre xml:space="preserve">Created configuration backup file: sa5_Config_20120222_0800.tar.gz</pre><pre xml:space="preserve">Restore the users configuration: Succeeded</pre><pre xml:space="preserve">You must reboot the appliance for the changes to take effect. <br />Please check the new configurations BEFORE rebooting or restarting the services. <br />You can restore the previous configurations if the new settings are not acceptable.</pre><pre xml:space="preserve">Command Result : 0 (Success)</pre><pre xml:space="preserve">[sa5] lunash:&gt;sysconf appliance reboot</pre><pre xml:space="preserve">WARNING !!  This command will reboot the appliance. <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;All clients will be disconnected. <br />If you are sure that you wish to proceed, then type 'proceed', otherwise type 'quit'</pre><pre xml:space="preserve">&gt; proceed <br />Proceeding...</pre><pre xml:space="preserve">'hsm supportInfo' successful.</pre><pre xml:space="preserve">Use 'scp' from a client machine to get file named: <br />supportInfo.txt</pre><pre xml:space="preserve">Broadcast message from root (pts/1) (Wed Feb 22 08:00:41 2012):</pre><pre xml:space="preserve">The system is going down for reboot NOW! <br />Reboot commencing</pre><pre xml:space="preserve">Command Result : 0 (Success)</pre><pre xml:space="preserve">[sa5] lunash:&gt;</pre>
        <p>&#160;</p>
        <p> After the appliance returns from reboot, restart the SSH session and log in.</p><pre xml:space="preserve">[sa5] lunash:&gt;</pre><pre xml:space="preserve">login as: admin</pre><pre xml:space="preserve">admin@172.20.10.202's password:</pre><pre xml:space="preserve">Access denied</pre><pre xml:space="preserve">admin@172.20.10.202's password:</pre><pre xml:space="preserve">Last login: Wed Feb 22 05:44:39 2012 from 172.20.10.143</pre><pre xml:space="preserve">Luna SA 5.1.0-25 Command Line Shell - Copyright (c) 2001-2011 SafeNet, Inc. All rights reserved.</pre><pre xml:space="preserve">*****************************************************<br />**                                             &#160;&#160;&#160;&#160;&#160;** <br />**   For security purposes, you must change your &#160;&#160;&#160;** <br />**   admin password. &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; ** <br />** &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;  ** <br />**   Please ensure you store your new admin      &#160;&#160;&#160;** <br />**   password in a secure location. &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;  ** <br />**                                                 &#160;** <br />**               DO NOT LOSE IT!        &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;** <br />** &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;  ** <br />*****************************************************</pre><pre xml:space="preserve">Changing password for user admin.</pre><pre xml:space="preserve">You can now choose the new password.</pre><pre xml:space="preserve">A valid password should be a mix of upper and lower case letters, <br />digits, and other characters.  You can use an 8 character long <br />password with characters from at least 3 of these 4 classes.</pre><pre xml:space="preserve">An upper case letter that begins the password and a digit that <br />ends it do not count towards the number of character classes used.</pre><pre xml:space="preserve">Enter new password:</pre><pre xml:space="preserve">Re-type new password:</pre><pre xml:space="preserve">passwd: all authentication tokens updated successfully.</pre><pre xml:space="preserve">Password change successful.</pre><pre xml:space="preserve">[sa5] lunash:&gt;</pre>
        <p>&#160;</p>
        <p>The reset to factory appliance settings for the "users" parameter seems to have worked. Our "admin" password was reset to the default password "PASSWORD", and we had to apply a non-default password.</p>
        <p>With that done, we can verify if additional aspects of the "user" parameters were also reset to factory spec.</p><pre xml:space="preserve">[sa5] lunash:&gt;user list</pre><pre xml:space="preserve">Users&#160;		Roles&#160;		Status&#160;&#160;&#160;	RADIUS&#160;</pre><pre xml:space="preserve">admin&#160;		admin&#160;		enabled&#160;	no&#160;</pre><pre xml:space="preserve">monitor&#160;	monitor&#160;	enabled&#160;	no&#160;</pre><pre xml:space="preserve">operator&#160;&#160;&#160;&#160;	operator&#160;&#160;&#160;&#160;	enabled&#160;	no&#160;</pre><pre xml:space="preserve">Command Result : 0 (Success)<br />[sa5] lunash:&gt;</pre>
        <p>&#160;</p>
        <p>Notice that created users "bob" and "john" are gone, but the system-standard users "admin", "operator", and "monitor" persist. Both "operator" and "monitor" will have had their passwords reset to the default, as well.</p>
        <p> </p><pre xml:space="preserve">sa5] lunash:&gt;sysconf config list</pre><pre xml:space="preserve">Configuration backup files in file system:</pre><pre xml:space="preserve">Size  &#160;&#160;&#160;	File Name  &#160;&#160;&#160;				Description. &#160;&#160;&#160;</pre><pre xml:space="preserve">16641&#160;&#160;&#160;&#160;   | &#160;sa5_Config_20120222_0556.tar.gz&#160;&#160;&#160;&#160;&#160;&#160;   | &#160;testing-this&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;    &#160; </pre><pre xml:space="preserve">.7028&#160;&#160;&#160;&#160;   | &#160;factoryInit_local_host_Config.tar.gz&#160;&#160;&#160; |  Initial Factory Settings&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;    &#160; </pre><pre xml:space="preserve">16588&#160;&#160;&#160;&#160;   | &#160;sa5_Config_20120222_0558.tar.gz&#160;&#160;&#160;&#160;&#160;&#160;   | &#160;Automatic Backup Before Restoring&#160;   &#160; </pre><pre xml:space="preserve">Command Result : 0 (Success) <br />[sa5] lunash:&gt;sysconf config restore</pre>
        <p>&#160;</p>
        <p>The list of configuration backup files is unchanged. We can choose one and restore it.</p><pre xml:space="preserve">[sa5] lunash:&gt;sysconf config restore -service users -file sa5_Config_20120222_0556.tar.gz</pre><pre xml:space="preserve">WARNING !!  This command restores the configuration backup file: sa5_Config_20120222_0556.tar.gz.</pre><pre xml:space="preserve">It first creates a backup of the current configuration before restoring: sa5_Config_20120222_0556.tar.gz. <br />If you are sure that you wish to proceed, then type 'proceed', otherwise type 'quit'.</pre><pre xml:space="preserve">&gt; proceed <br />Proceeding...</pre><pre xml:space="preserve">Created configuration backup file: sa5_Config_20120222_0606.tar.gz</pre><pre xml:space="preserve">Restore the users configuration: Succeeded</pre><pre xml:space="preserve">You must reboot the appliance for the changes to take effect.</pre><pre xml:space="preserve">Please check the new configurations BEFORE rebooting or restarting the services. <br />You can restore the previous configurations if the new settings are not acceptable.</pre><pre xml:space="preserve">Command Result : 0 (Success)</pre><pre xml:space="preserve">[sa5] lunash:&gt;</pre><pre xml:space="preserve">[sa5] lunash:&gt;sysconf appliance reboot</pre><pre xml:space="preserve">WARNING !!  This command will reboot the appliance. <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;All clients will be disconnected. <br />If you are sure that you wish to proceed, then type 'proceed', otherwise type 'quit'</pre><pre xml:space="preserve">&gt; proceed <br />Proceeding...</pre><pre xml:space="preserve">'hsm supportInfo' successful.</pre><pre xml:space="preserve">Use 'scp' from a client machine to get file named: <br />supportInfo.txt</pre><pre xml:space="preserve">Broadcast message from root (pts/1) (Wed Feb 22 08:00:41 2012):</pre><pre xml:space="preserve">The system is going down for reboot NOW! <br />Reboot commencing</pre><pre xml:space="preserve">Command Result : 0 (Success)</pre><pre xml:space="preserve">[sa5] lunash:&gt;</pre>
        <p>&#160;</p>
        <p>After rebooting again, we are able to log in with our original "admin" password. </p>
        <p>Once again we check the list of users.</p><pre xml:space="preserve">[sa5] lunash:&gt;user list</pre><pre xml:space="preserve">Users&#160;		Roles&#160;		Status&#160;&#160;&#160;	RADIUS&#160;</pre><pre xml:space="preserve">admin&#160;		admin&#160;		enabled&#160;	no&#160;</pre><pre xml:space="preserve">bob&#160;		monitor&#160;	enabled&#160;	no&#160;</pre><pre xml:space="preserve">john&#160;		admin&#160;		enabled&#160;	no&#160;</pre><pre xml:space="preserve">monitor&#160;	monitor&#160;	enabled&#160;	no&#160;</pre><pre xml:space="preserve">operator&#160;&#160;&#160;&#160;	operator&#160;	enabled&#160;	no&#160;</pre>
        <p class="code">&#160;</p>
        <p>We see that users "bob" and "john" have returned. We could also log in as "operator" and "monitor" and find that their chosen passwords have been restored.</p>
        <p>Finally, ask for the list of system configuration backup files one more time.</p>
        <p> </p><pre xml:space="preserve">sa5] lunash:&gt;sysconf config list</pre><pre xml:space="preserve">Configuration backup files in file system:</pre><pre xml:space="preserve">Size File Name Description.  &#160;&#160;&#160;</pre><pre xml:space="preserve">16641&#160;&#160;&#160;&#160;   | sa5_Config_20120222_0556.tar.gz&#160;&#160;&#160;&#160;&#160;&#160;   | testing-this&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;     &#160; </pre><pre xml:space="preserve">.7028&#160;&#160;&#160;&#160;   | factoryInit_local_host_Config.tar.gz&#160; |  Initial Factory Settings&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;     &#160; </pre><pre xml:space="preserve">16588&#160;&#160;&#160;&#160;   | sa5_Config_20120222_0558.tar.gz&#160;&#160;&#160;&#160;&#160;&#160;   | Automatic Backup Before Restoring&#160;    &#160; </pre><pre xml:space="preserve">16248&#160;&#160;&#160;&#160;   | sa5_Config_20120222_0606.tar.gz&#160;&#160;&#160;&#160;&#160;&#160;   | Automatic Backup Before Restoring&#160;    &#160; </pre><pre xml:space="preserve">Command Result : 0 (Success) <br />[sa5] lunash:&gt;sysconf config restore</pre>
        <p>&#160;</p>
        <p>We see that a new file was created (...0606.tar.gz...) before the restore operation, and the other files are intact.</p>
        <h3>Backup to HSM</h3>
        <p>You can protect a configuration setup against the possibility of appliance failure by moving a backup snapshot file into your HSM. The command <code>sysconf config export</code> allows you to place the configuration backup file onto an HSM and <code>sysconf config import</code> allows you to retrieve the file from that HSM, back to the appliance file system. The export command gives you two target options:</p>
        <p class="ul1" data-mc-autonum="&lt;b&gt;•&lt;/b&gt;"><span class="autonumber"><span class="ul1Bullet"><b>•</b></span></span>The internal HSM of your Luna&#160;SA appliance. This could be useful if a component failed in the appliance, you sent the appliance back to SafeNet for rework under the RMA&#160;procedure, received it back repaired, and then retrieved the file from your HSM to restore your appliance settings. </p>
        <p class="ul1" data-mc-autonum="&lt;b&gt;•&lt;/b&gt;"><span class="autonumber"><span class="ul1Bullet"><b>•</b></span></span>An external HSM, such as a Backup HSM or token. This could be useful if the current appliance failed and you wished to install a replacement. Similarly, you could use system configuration backup files restored from a Backup HSM to uniformly configure multiple Luna appliances with a standard set of parameters applicable to your enterprise.</p>
        <p class="footer"><span class="DefaultProduct">Luna SA</span> <span class="DefaultRelease">5.4.1</span> <span class="DefaultProjectTitle">Product Documentation</span> <br /><span class="DefaultPartNumber">007-011136-007</span> <span class="DefaultRevision">Rev C</span> <span style="color: #5e5e5c;"> </span> <span class="DefaultDateShort">July 2014</span> <span style="color: #5e5e5c;"> </span> <span class="DefaultCopyright">Copyright 2014</span>&#160;<span class="DefaultCompanyNameLong">SafeNet, Inc.</span> <span style="color: #5e5e5c;"> </span>All rights reserved. </p>
        <p class="MCWebHelpFramesetLink MCWebHelpFramesetLinkBottom"><a href="../../../index.html#sa_appliance_admin/backup/backup-restore_your_service_config.htm">Open topic with navigation</a>
        </p>
    </body>
</html>