<!DOCTYPE html>
<html xmlns:MadCap="http://www.madcapsoftware.com/Schemas/MadCap.xsd" lang="en-us" xml:lang="en-us" data-mc-search-type="Stem" data-mc-help-system-file-name="index.xml" data-mc-path-to-help-system="../../../" data-mc-conditions="Primary.Default" data-mc-target-type="WebHelp2" data-mc-runtime-file-type="Topic" data-mc-preload-images="false" data-mc-in-preview-mode="false" data-mc-medium="non-print" data-mc-toc-path="Luna SA Appliance Administration Guide|Client Connections">
    <head>
        <meta charset="utf-8" />
        <meta http-equiv="Content-Type" content="text/html; charset=utf-8" /><title>NTLS Keys in Hardware or in Software</title>
        <link href="../../Resources/TableStyles/Page.css" rel="stylesheet" />
        <link href="../../../Skins/Default/Stylesheets/TextEffects.css" rel="stylesheet" />
        <link href="../../../Skins/Default/Stylesheets/Topic.css" rel="stylesheet" />
        <link href="../../Resources/TableStyles/Breadcrumbs.css" rel="stylesheet" />
        <link href="../../Resources/Stylesheets/SafeNet_Template.css" rel="stylesheet" />
        <script src="../../../Resources/Scripts/jquery.min.js">
        </script>
        <script src="../../../Resources/Scripts/plugins.min.js">
        </script>
        <script src="../../../Resources/Scripts/require.min.js">
        </script>
        <script src="../../../Resources/Scripts/require.config.js">
        </script>
        <script src="../../../Resources/Scripts/MadCapAll.js">
        </script>
    </head>
    <body>
        <p class="MCWebHelpFramesetLink MCWebHelpFramesetLinkTop"><a href="../../../index.html#sa_appliance_admin/client_connections/ntls_keys_in_hardware_or_software.htm">Open topic with navigation</a>
        </p>
        <table style="width: 100%;border-spacing: 0px 0px;mc-table-style: url('../../Resources/TableStyles/Breadcrumbs.css');border-left-style: none;border-left-width: 1px;border-left-color: #000000;border-right-style: none;border-right-width: 1px;border-right-color: #000000;border-top-style: none;border-top-width: 0px;border-top-color: #000000;border-bottom-style: solid;border-bottom-width: 2px;border-bottom-color: #e6e6e6;" class="TableStyle-Breadcrumbs" cellspacing="0">
            <col style="width: 41px;" class="TableStyle-Breadcrumbs-Column-Column1" />
            <col class="TableStyle-Breadcrumbs-Column-Column1" />
            <tbody>
                <tr class="TableStyle-Breadcrumbs-Body-Body1">
                    <th class="TableStyle-Breadcrumbs-BodyB-Column1-Body1">
                        <p class="home" style="font-weight: normal;"><a href="../../Home_sa.htm">Home</a> &gt;
                        </p>
                    </th>
                    <th class="TableStyle-Breadcrumbs-BodyA-Column1-Body1">
                        <div class="MCBreadcrumbsBox_0"><span class="MCBreadcrumbsPrefix">  <![CDATA[ ]]></span><span class="MCBreadcrumbsSelf">Luna SA Appliance Administration Guide</span><span class="MCBreadcrumbsDivider"> &gt; </span><a class="MCBreadcrumbsLink" href="client_connections.htm">Client Connections</a><span class="MCBreadcrumbsDivider"> &gt; </span><span class="MCBreadcrumbs">NTLS Keys in Hardware or in Software</span>
                        </div>
                    </th>
                </tr>
            </tbody>
        </table>
        <h2>NTLS Keys in Hardware or in Software</h2>
        <p>In this context, "in hardware" means inside the HSM, while "in software" means on the appliance's hard disk, within the file system. </p>
        <p>The default for Luna HSM appliances prior to Luna SA&#160;5 has been to have the securing keys for the NTLS link generated by the lunash command <span style="font-family: monospace;">sysconf regenCert</span>, and stored in the file system on the appliance's hard disk. </p>
        <h3>Moving into 'Hardware' (the HSM)</h3>
        <p>In Luna SA&#160;5.x, it is also possible to create the ssl keys directly in the HSM and store them there, using the lunash command <span style="font-family: monospace;">sysconf hwRegenCert</span>.</p>
        <p>A third option is to preserve software-created-and-stored keys and transfer them onto the HSM, using the lunash command <span style="font-family: monospace;">sysconf secureKeys</span>. </p>
        <p>Either of the latter two options requires the creation of a special HSM partition named "Cryptoki User" to store those NTLS keys. This partition must be manually created with lunash command partition create.</p>
        <p>Following creation or migration onto the HSM, the partition containing the NTLS keys must be activated with the lunash command <span style="font-family: monospace;">ntls activateKeys</span>. </p>
        <p>You can verify if the system is using keys in hardware with the lunash command <span class="code">ntls show</span>.</p>
        <p>The keys in hardware feature creates a special container "Cryptoki User" to keep the RSA key pair for NTLS. Even though it shows in the partition list, this container is not meant to be managed by customers directly. Once it is created you should never to need touch this partition at all. </p>
        <p>If sets of NTLS&#160;keys exist in both software (on the appliance's file system) and hardware (inside the HSM), only one set is valid and registered with clients.</p>
        <h3>Going Back to 'Software' </h3>
        <p>If you were using hardware secured (stored on the HSM) keys for your NTLS links between clients and appliance, and you decide to go back to using software-stored NTLS keys, you will need to generate new keys and certificates for NTLS, as you cannot move the existing NTLS keys from the "Cryptoki User" partition back to the appliance hard disk.</p>
        <p>First, deactivate the "Cryptoki User" partition with the lunash command <span class="code">ntls deactivateKeys</span>.</p>
        <p>Then, remove the "Cryptoki User" partition with the lunash command <span class="code">partition delete</span>.</p>
        <p>Then, regenerate the NTLS keys and certificates in software with the lunash command <span class="code">sysconf regenCert</span>.</p>
        <p>Finally, restart NTLS service with the lunash command <span class="code">service restart ntls</span>.</p>
        <h3>Additional Notes</h3>
        <p>Most customers are expected to choose one option or the other (NTLS keys in HSM&#160;or NTLS&#160;keys on file system) and remain with that. Probably the only situation where you might encounter the above scenarios is in a lab, while trying the options before operational deployment. </p>
        <p>If you deploy using one scheme, then wish to change at a later date by regenerating certificates (whether in hardware or in software), you must re-register all your clients with the new certificates. </p>
        <p>If you migrate an existing set of keys from software (the file system) to hardware (the HSM), using <span style="font-family: monospace;">sysconf secureKeys</span>, you can carry on with your current registrations, because the NTLS keys have not changed. However, you do have to <span class="MCExpanding MCExpanding_Open expanding "><span class="MCExpandingHead MCExpandingHotSpot expandingHead  MCExpandingHotSpot_" title="Expanding Text">activate the NTLS partition and restart the NTLS&#160;service after any restart or power failure.</span><span class="MCExpandingBody expandingBody "> &#160;[This is a limitation of having the NTLS private key in hardware. &#160;NTLS  needs to open a session with a known appid that is already created and logged in by admin using “ntls activatekey” command. &#160; Every time the appliance reboots, the admin must issue the ntls command and restart NTLS before any NTLS connections can be established between Clients and their working partitions. ]</span></span> <![CDATA[ ]]></p>
        <table class="TableStyle-Page" style="mc-table-style: url('../../Resources/TableStyles/Page.css');margin-left: 0;margin-right: auto;" cellspacing="0">
            <col style="width: 175px;" class="Column-Column1" />
            <col style="width: 282px;" class="Column-Column1" />
            <col style="width: 282px;" class="Column-Column1" />
            <thead>
                <tr class="Head-Header1">
                    <th class="HeadE-Column1-Header1" rowspan="2">
                        <p rowspan="2">&#160;</p>
                        <p rowspan="2"> Item</p>
                    </th>
                    <th class="HeadD-Column1-Header1" colspan="2">Keys in...</th>
                </tr>
                <tr class="Head-Header1">
                    <th class="HeadE-Column1-Header1">Hardware (HSM)</th>
                    <th class="HeadD-Column1-Header1">Software (hard disk)</th>
                </tr>
            </thead>
            <tbody>
                <tr class="Body-Body1">
                    <td class="BodyE-Column1-Body1">Security of NTLS keys</td>
                    <td class="BodyE-Column1-Body1">
                        <p>More</p>
                    </td>
                    <td class="BodyD-Column1-Body1">
                        <p>Less</p>
                    </td>
                </tr>
                <tr class="Body-Body1">
                    <td class="BodyE-Column1-Body1">Speed of link setup</td>
                    <td class="BodyE-Column1-Body1">Slower (more overhead - but little effect for client applications that set up a link, then perform many operations before link tear-down)</td>
                    <td class="BodyD-Column1-Body1">Faster (advantage to client applications that set up a fresh link for each operation, then tear down after the individual operation concludes - no advantage for long-duration links)</td>
                </tr>
                <tr class="Body-Body1">
                    <td class="BodyE-Column1-Body1">Speed ongoing</td>
                    <td class="BodyE-Column1-Body1">
                        <p>No advantage or disadvantage</p>
                    </td>
                    <td class="BodyD-Column1-Body1">
                        <p>No advantage or disadvantage<br /></p>
                    </td>
                </tr>
                <tr class="Body-Body1">
                    <td class="BodyB-Column1-Body1">Convenience</td>
                    <td class="BodyB-Column1-Body1">
                        <p>Must swap keys with each client (registration) first time only. <br />Afterward, you must activate the Cryptoki User partition and restart the NTLS service following any system restart. </p>
                        <p>Partition AutoActivation does not include the special Cryptoki User partition.</p>
                    </td>
                    <td class="BodyA-Column1-Body1">Must swap keys with each client (registration) first time only.<br />Once the keys exist, the only task is to swap certificates with each client (registering), then no further link maintenance while the registrations are valid. </td>
                </tr>
            </tbody>
        </table>
        <p class="footer"><span class="DefaultProduct">Luna SA</span> <span class="DefaultRelease">5.4.1</span> <span class="DefaultProjectTitle">Product Documentation</span> <br /><span class="DefaultPartNumber">007-011136-007</span> <span class="DefaultRevision">Rev C</span> <span style="color: #5e5e5c;"> </span> <span class="DefaultDateShort">July 2014</span> <span style="color: #5e5e5c;"> </span> <span class="DefaultCopyright">Copyright 2014</span>&#160;<span class="DefaultCompanyNameLong">SafeNet, Inc.</span> <span style="color: #5e5e5c;"> </span>All rights reserved. </p>
        <p class="MCWebHelpFramesetLink MCWebHelpFramesetLinkBottom"><a href="../../../index.html#sa_appliance_admin/client_connections/ntls_keys_in_hardware_or_software.htm">Open topic with navigation</a>
        </p>
    </body>
</html>