<!DOCTYPE html>
<html xmlns:MadCap="http://www.madcapsoftware.com/Schemas/MadCap.xsd" lang="en-us" xml:lang="en-us" data-mc-search-type="Stem" data-mc-help-system-file-name="index.xml" data-mc-path-to-help-system="../../../" data-mc-conditions="Primary.notLunaSP,Primary.Default" data-mc-target-type="WebHelp2" data-mc-runtime-file-type="Topic" data-mc-preload-images="false" data-mc-in-preview-mode="false" data-mc-medium="non-print" data-mc-toc-path="HSM Administration Guide|Software Updates and Maintenance">
    <head>
        <meta charset="utf-8" />
        <meta http-equiv="Content-Type" content="text/html; charset=utf-8" /><title>About Updating Luna SA</title>
        <link href="../../../Skins/Default/Stylesheets/TextEffects.css" rel="stylesheet" />
        <link href="../../../Skins/Default/Stylesheets/Topic.css" rel="stylesheet" />
        <link href="../../Resources/TableStyles/Breadcrumbs.css" rel="stylesheet" />
        <link href="../../Resources/Stylesheets/SafeNet_Template.css" rel="stylesheet" />
        <script src="../../../Resources/Scripts/jquery.min.js">
        </script>
        <script src="../../../Resources/Scripts/plugins.min.js">
        </script>
        <script src="../../../Resources/Scripts/require.min.js">
        </script>
        <script src="../../../Resources/Scripts/require.config.js">
        </script>
        <script src="../../../Resources/Scripts/MadCapAll.js">
        </script>
    </head>
    <body>
        <p class="MCWebHelpFramesetLink MCWebHelpFramesetLinkTop"><a href="../../../index.html#administration/sw_maint/about_updating_lunasa.htm">Open topic with navigation</a>
        </p>
        <table style="width: 100%;border-spacing: 0px 0px;mc-table-style: url('../../Resources/TableStyles/Breadcrumbs.css');border-left-style: none;border-left-width: 1px;border-left-color: #000000;border-right-style: none;border-right-width: 1px;border-right-color: #000000;border-top-style: none;border-top-width: 0px;border-top-color: #000000;border-bottom-style: solid;border-bottom-width: 2px;border-bottom-color: #e6e6e6;" class="TableStyle-Breadcrumbs" cellspacing="0">
            <col style="width: 41px;" class="TableStyle-Breadcrumbs-Column-Column1" />
            <col class="TableStyle-Breadcrumbs-Column-Column1" />
            <tbody>
                <tr class="TableStyle-Breadcrumbs-Body-Body1">
                    <th class="TableStyle-Breadcrumbs-BodyB-Column1-Body1">
                        <p class="home" style="font-weight: normal;"><a href="../../Home_sa.htm">Home</a> &gt;
                        </p>
                    </th>
                    <th class="TableStyle-Breadcrumbs-BodyA-Column1-Body1">
                        <div class="MCBreadcrumbsBox_0"><span class="MCBreadcrumbsPrefix"> </span><span class="MCBreadcrumbsSelf">HSM Administration Guide</span><span class="MCBreadcrumbsDivider"> &gt; </span><a class="MCBreadcrumbsLink" href="sw_maint.htm">Software Updates and Maintenance</a><span class="MCBreadcrumbsDivider"> &gt; </span><span class="MCBreadcrumbs">About Updating Luna SA</span>
                        </div>
                    </th>
                </tr>
            </tbody>
        </table>
        <h2><a name="kanchor197"></a><a name="kanchor198"></a><a name="kanchor199"></a>About Updating Luna SA</h2>
        <p>This page covers updating (not upgrading) of your Luna SA.</p>
        <p>Your Luna SA system consists of components that might, from time to time, 
 require updating to newer versions. The newer version might have fixes 
 or functional improvements that are useful or important for your application. 
 The components that might be affected are:</p>
        <p class="ul1" data-mc-autonum="&lt;b&gt;•&lt;/b&gt;"><span class="autonumber"><span class="ul1Bullet"><b>•</b></span></span>Client software</p>
        <p class="ul1" data-mc-autonum="&lt;b&gt;•&lt;/b&gt;"><span class="autonumber"><span class="ul1Bullet"><b>•</b></span></span>Luna SA system software (the lunash command-line 
 shell and its underlying software)</p>
        <p class="ul1" data-mc-autonum="&lt;b&gt;•&lt;/b&gt;"><span class="autonumber"><span class="ul1Bullet"><b>•</b></span></span>Luna SA keycard firmware</p>
        <p class="ul1" data-mc-autonum="&lt;b&gt;•&lt;/b&gt;"><span class="autonumber"><span class="ul1Bullet"><b>•</b></span></span>Luna Backup HSM firmware</p>
        <h3><a name="kanchor200"></a>How Firmware 
 Updates Affect Agency Validation</h3>
        <p>In the case of FIPS 140, cryptographic devices are evaluated as a combination of hardware and firmware. Therefore, if either of those elements changes, the device is no longer covered by the current validation certificate. If you require that equipment used in your application be (for example) FIPS 140-2 level 3 validated, you can use the most recent of our relevant HSM products that has been validated - which applies to a specific hardware and firmware combination. If we release a newer version of firmware, your own security or compliance policies would not permit you to install that update until we have submitted the updated HSM for [re-] evaluation, and a new validation certificate has been issued.</p>
        <p>
&#160;As a general rule (exceptions are possible) we submit HSMs with new firmware versions. If the changes are small or do not affect areas that concern the FIPS evaluators, then the re-evaluation is performed on a delta basis and therefore occurs relatively quickly. For a completely new product or major revision, the evaluators require a complete re-submission and the process takes roughly a year from submission to certificate. Therefore, when a FIPS-candidate firmware version exists, our practice is to ship the respective HSM product with the most recent FIPS-validated firmware version installed, and with the candidate version as a standby update file (on the appliance, ready to install, but not yet installed).  This ensures that customers who require validated systems continue to get them, and that customers who do not require validated systems are able to easily and quickly apply the update if they choose to do so. &#160;</p>
        <p>The obvious trade-off is that customers who elect to remain with the as-shipped installed firmware version are maintaining the FIPS compliance at the cost of any upgraded capabilities or any security or functional fixes that are part of the firmware update. 
Similarly, customers who choose to perform the update benefit from the improved  capabilities and any security or functional fixes, but at the cost of moving out of FIPS compliance.</p>
        <h3>Updating the Client Software</h3>
        <p>To update the software on a Client, you simply remove the older version 
 and Install the newer, using the same procedure (for your operating system) 
 that you used for the original software installation. That applies to 
 Luna SA Client software itself, as well as to the SDK material.</p>
        <h3>Updating the Appliance Software</h3>
        <p><a name="kanchor201"></a>To update system software and firmware, you must move the updates, in 
 the form of update package files, to Luna SA and apply them. Updates 
 are accompanied by instructions that provide detailed update 
 instructions for each component. System and firmware updates require an 
 authentication code, which is provided in a text file accompanying the update package.</p>
        <p>The steps are:</p>
        <p class="ol1Start" data-mc-autonum="1."><span class="autonumber"><span class="ol1Number">1.</span></span>Copy the Luna SA 5.x.y-z Appliance package file from the ftp directory to the Luna SA, as follows:. &#160;<br /> <span class="code">scp \&lt;path&gt;\lunasa_update-5.x.y-z.spkg admin@&lt;LunaSAhostname&gt;:</span> <br />where x.y-z is the version and build number &#160;&#160;<br />(in Windows, use the supplied PSCP utility). </p>
        <p class="ol1" data-mc-autonum="2."><span class="autonumber"><span class="ol1Number">2.</span></span>Stop all client applications connected to the Luna SA appliance. &#160;</p>
        <p class="ol1" data-mc-autonum="3."><span class="autonumber"><span class="ol1Number">3.</span></span>At the shell prompt, log in to the Luna SA appliance as admin. &#160;</p>
        <p class="ol1" data-mc-autonum="4."><span class="autonumber"><span class="ol1Number">4.</span></span>Log in to the Luna SA HSM as HSM Admin or SO. &#160;<br />Use <span class="code">lunash:&gt;hsm login</span> <br />For Luna SA with PED Authentication, the blue PED Key is required. &#160;<br />For Luna SA with Password Authentication, you are prompted for the HSM Admin (SO) password. &#160;</p>
        <p class="ol1" data-mc-autonum="5."><span class="autonumber"><span class="ol1Number">5.</span></span>[Optional Step] Verify that the file that you copied is present on the Luna SA &#160;<br /> <span class="code">lunash:&gt;package listfile</span> <![CDATA[ ]]></p>
        <p class="ol1" data-mc-autonum="6."><span class="autonumber"><span class="ol1Number">6.</span></span> [Optional Step] Verify the package on the Luna SA &#160;<br /> <span class="code">lunash:&gt;package verify lunasa_update-5.x.y-z.spkg -authcode ################</span> <br />where "################" is the authorization code from the file lunasa_update-5x.y-z.auth. &#160;<br />The verification process requires approximately one and a half minutes. &#160;</p>
        <p class="ol1" data-mc-autonum="7."><span class="autonumber"><span class="ol1Number">7.</span></span>Install the software upgrade package on Luna SA &#160;<br />&#160;&#160;&#160;<span class="code">lunash:&gt;package update lunasa_update-5.x.y-z.spkg.spkg -authcode  ############### </span>&#160;<br />where "################" is the authorization code from the file lunasa_update-5.x.y-z.auth. &#160;<br />The installation/update process requires approximately one and a half minutes. During that time, a series of messages shows the progress of the update. &#160;</p>
        <p class="ol1" data-mc-autonum="8."><span class="autonumber"><span class="ol1Number">8.</span></span>At the end of this process, a message “Software update completed!” appears. The software version is now 5.x.y-z. If the software update also included a firmware update, then the firmware 6.v.w package is now on the appliance, waiting to be installed in the HSM.<br />Perform a reboot of the Luna SA appliance before you update the firmware. &#160;<br /> <span class="code">lunash:&gt; sysconf appliance reboot</span> <br /></p>
        <p>Follow these steps to update your HSM firmware to 6.v.w.</p>
        <p><b>[Optional Firmware Update]</b>  &#160;In general, a new Luna SA is delivered with the current FIPS- validated firmware installed on the internal HSM card, and with the most recent firmware version (typically in the process of being FIPS validated) included - waiting, but not yet installed - on the Luna SA hard drive as an optional update.  <br /><br />Similarly, when you install a software update package that includes a firmware component, the software is changed and the accompanying new firmware goes into the waiting area on the appliance hard disk, replacing any previous optional firmware. <br /><br />Regardless of whether the optional firmware update is one that was originally loaded (as an option) or one that was supplied later with a software update (as an option), it is always a separate step if you wish to install that waiting (optional) firmware into the HSM. </p>
        <p class="warning_note">It is strongly recommended that your Luna SA be connected 
 to an Un-interruptible Power Supply (UPS) when you run firmware update. There 
 is a small chance that a power failure during the update command could 
 leave Luna SA in an unrecoverable condition.</p>
        <p class="caution_note">For PED-authenticated Luna HSMs,  ensure that <strong>SRK</strong> (the use of the purple PED Key)&#160;<strong>is disabled</strong> (bring the external portion of the MTK&#160;back into the HSM) <strong>before you begin the firmware update operation</strong>. This requires that you present the currently valid purple PED Key when you issue the <span class="code">hsm srk disable</span> command. &#160;<br /><br />If you run <span class="code">hsm update firmware</span> while SRK is enabled (a portion of the MTK is outside the HSM, on a purple PED&#160;Key) you can expect an error like:<br /><span class="code">Error:  'hsm update firmware' failed. (10A0B : LUNA_RET_OPERATION_RESTRICTED)</span> <br /><br />If you have had SRK enabled and a valid purple PED Key, you can always perform <span class="code">hsm srk enable</span> again after the firmware update operation, and resume with a new external secure recovery vector (SRV)&#160;imprinted onto a new purple PED Key (SRK). </p>
        <p class="ol1Start" data-mc-autonum="1."><span class="autonumber"><span class="ol1Number">1.</span></span>Log in to the HSM with: &#160;<br />&#160;&#160;<span class="code">lunash:&gt; hsm login</span> <![CDATA[ ]]></p>
        <p class="ol1" data-mc-autonum="2."><span class="autonumber"><span class="ol1Number">2.</span></span>Run the firmware update command: &#160;<br /> <span class="code">lunash:&gt; hsm firmware upgrade</span></p>
        <p class="ol1" data-mc-autonum="3."><span class="autonumber"><span class="ol1Number">3.</span></span>Log in to the HSM with: &#160;<br /> <span class="code">lunash:&gt; hsm login</span> <![CDATA[ ]]></p>
        <p class="ol1" data-mc-autonum="4."><span class="autonumber"><span class="ol1Number">4.</span></span>Verify that the change has taken place (should show version 6.v.w): &#160;<br /> <span class="code">lunash:&gt; hsm show</span> <![CDATA[ ]]></p>
        <p class="notepad_note">A capability update or a firmware update is meant to be applied just one time to an HSM. If you attempt to re-apply a capability update to an HSM that already has the capability installed, the system throws an error like " C0000002 : RC_GENERAL_ERROR ". A similar result occurs if you attempt to install a particular firmware update more than once on one HSM. This is expected behavior.</p>
        <p>For information and instructions regarding purchased Capability Updates, see <a href="luna_hsm_capability_updates.htm" class="MCXref xref "><span style="color: #6c286b;" class="mcFormatColor">"Luna HSM Capability Updates"</span></a>.</p>
        <h3>Standalone Firmware Update</h3>
        <p>On occasion you might need to update HSM firmware on a standalone basis - that is, where the activity is not part of appliance software update. The process is similar, except that the package transferred to the Luna SA appliance is just a wrapper around the firmware update, and does not contain other appliance software. This can occur when you are performing evaluations and might be testing several firmware versions, or when, for whatever reason, the firmware version that you wish to install is not currently the standby firmware version on the appliance, in which case SafeNet supplies a standalone firmware update secure package .</p>
        <p class="ol1Start" data-mc-autonum="1."><span class="autonumber"><span class="ol1Number">1.</span></span>Obtain the firmware update secure package from SafeNet. Use scp/pscp to upload the package to the Luna SA appliance.  &#160;<br />Linux/UNIX<br /><span class="code">scp /&lt;path&gt;/&lt;packagename&gt;.spkg admin@&lt;LunaSAhostname&gt;:</span> &#160;<br /><br />Windows<br /><span class="code">pscp \&lt;path&gt;\&lt;packagename&gt;.spkg admin@&lt;LunaSAhostname&gt;:</span></p>
        <p class="ol1" data-mc-autonum="2."><span class="autonumber"><span class="ol1Number">2.</span></span>Stop all client applications connected to the Luna SA appliance. &#160;</p>
        <p class="ol1" data-mc-autonum="3."><span class="autonumber"><span class="ol1Number">3.</span></span>At the shell prompt, log in to the Luna SA appliance as admin. &#160;</p>
        <p class="ol1" data-mc-autonum="4."><span class="autonumber"><span class="ol1Number">4.</span></span>Log in to the Luna SA HSM as HSM Admin or SO. &#160;<br></br>Use <span class="code">lunash:&gt;hsm login</span><br></br>For Luna SA with PED Authentication, the blue PED Key is required. &#160;<br></br>For Luna SA with Password Authentication, you are prompted for the HSM Admin (SO) password. &#160;</p>
        <p class="ol1" data-mc-autonum="5."><span class="autonumber"><span class="ol1Number">5.</span></span>[Optional Step] Verify that the file that you copied is present on the Luna SA &#160;<br></br><span class="code">lunash:&gt;package listfile</span> <![CDATA[ ]]></p>
        <p class="ol1" data-mc-autonum="6."><span class="autonumber"><span class="ol1Number">6.</span></span> [Optional Step] Verify the package on the Luna SA &#160;<br /><span class="code">lunash:&gt;package verify &lt;packagename&gt;.spkg -authcode ################</span><br />where "################" is the authorization code from the file &lt;packagename&gt;.auth. &#160;<br /></p>
        <p class="ol1" data-mc-autonum="7."><span class="autonumber"><span class="ol1Number">7.</span></span>Install the firmware upgrade secure package on Luna SA &#160;<br />&#160;&#160;&#160;<span class="code">lunash:&gt;package update &lt;packagename&gt;.spkg.spkg -authcode  ############### </span>&#160;<br />where "################" is the authorization code from the file &lt;packagename&gt;.auth. &#160;<br />The package update process completes in seconds. &#160;The firmware  package is now on the appliance, waiting to be installed in the HSM. &#160;&#160;</p>
        <p class="note" data-mc-autonum="&lt;b&gt;Note:&lt;/b&gt; &#160;"><span class="autonumber"><span><b>Note:</b> &#160;</span></span>It is strongly recommended that your Luna HSM be powered from an uninterruptable power supply (UPS) when firmware update is performed. </p>
        <p class="ol1" data-mc-autonum="8."><span class="autonumber"><span class="ol1Number">8.</span></span>Run the firmware update command: &#160;<br /><span class="code">lunash:&gt; hsm firmware upgrade</span></p>
        <p class="ol1" data-mc-autonum="9."><span class="autonumber"><span class="ol1Number">9.</span></span>Log in to the HSM with: &#160;<br /><span class="code">lunash:&gt; hsm login</span> <![CDATA[ ]]></p>
        <p class="ol1" data-mc-autonum="10."><span class="autonumber"><span class="ol1Number">10.</span></span>Verify that the change has taken place (should show the desired target version ): &#160;<br /><span class="code">lunash:&gt; hsm show</span> <br /></p>
        <p>&#160;</p>
        <p class="footer"><span class="DefaultProduct">Luna SA</span> <span class="DefaultRelease">5.4.1</span> <span class="DefaultProjectTitle">Product Documentation</span> <br /><span class="DefaultPartNumber">007-011136-007</span> <span class="DefaultRevision">Rev C</span> <span style="color: #5e5e5c;"> <![CDATA[ ]]></span> <span class="DefaultDateShort">July 2014</span> <span style="color: #5e5e5c;"> <![CDATA[ ]]></span> <span class="DefaultCopyright">Copyright 2014</span>&#160;<span class="DefaultCompanyNameLong">SafeNet, Inc.</span> <span style="color: #5e5e5c;"> <![CDATA[ ]]></span>All rights reserved. </p>
        <p class="MCWebHelpFramesetLink MCWebHelpFramesetLinkBottom"><a href="../../../index.html#administration/sw_maint/about_updating_lunasa.htm">Open topic with navigation</a>
        </p>
    </body>
</html>