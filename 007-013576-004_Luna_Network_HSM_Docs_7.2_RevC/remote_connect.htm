<!DOCTYPE html>
<html xmlns:MadCap="http://www.madcapsoftware.com/Schemas/MadCap.xsd" lang="en-us" xml:lang="en-us" data-mc-search-type="Stem" data-mc-help-system-file-name="index.xml" data-mc-path-to-help-system="../../../../" data-mc-target-type="WebHelp2" data-mc-runtime-file-type="Topic" data-mc-preload-images="false" data-mc-in-preview-mode="false" data-mc-medium="non-print" data-mc-toc-path="HSM Administration Guide|[%=System.LinkedTitle%]|[%=System.LinkedTitle%]">
    <head>
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <meta charset="utf-8" />
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <meta http-equiv="Content-Type" content="text/html; charset=utf-8" /><title>Opening a Remote PED Connection</title>
        <link href="../../../../Skins/Default/Stylesheets/Slideshow.css" rel="stylesheet" />
        <link href="../../../../Skins/Default/Stylesheets/TextEffects.css" rel="stylesheet" />
        <link href="../../../../Skins/Default/Stylesheets/Topic.css" rel="stylesheet" />
        <link href="../../../../Skins/Default/Stylesheets/Components/Styles.css" rel="stylesheet" />
        <link href="../../../Resources/TableStyles/Breadcrumbs.css" rel="stylesheet" />
        <link href="../../../Resources/Stylesheets/Gemalto_Template.css" rel="stylesheet" />
        <script src="../../../../Resources/Scripts/custom.modernizr.js">
        </script>
        <script src="../../../../Resources/Scripts/jquery.min.js">
        </script>
        <script src="../../../../Resources/Scripts/require.min.js">
        </script>
        <script src="../../../../Resources/Scripts/require.config.js">
        </script>
        <script src="../../../../Resources/Scripts/foundation.min.js">
        </script>
        <script src="../../../../Resources/Scripts/plugins.min.js">
        </script>
        <script src="../../../../Resources/Scripts/MadCapAll.js">
        </script>
    </head>
    <body>
        <p class="MCWebHelpFramesetLink MCWebHelpFramesetLinkTop"><a href="../../../../index.html#administration/PED_Auth/remote/remote_connect.htm">Show Navigation</a>
        </p>
        <!-- Remove this comment to enable syntax highlighting		
        <script type="text/javascript" src="../Stylesheets/SyntaxHilite/Prism/prism.js"></script>
-->
        <table style="width: 100%;border-spacing: 0px 0px;mc-table-style: url('../../../Resources/TableStyles/Breadcrumbs.css');border-left-style: none;border-left-width: 1px;border-left-color: #000000;border-right-style: none;border-right-width: 1px;border-right-color: #000000;border-top-style: none;border-top-width: 0px;border-top-color: #000000;border-bottom-style: none;border-bottom-width: 0px;" class="TableStyle-Breadcrumbs" cellspacing="0">
            <col style="width: 41px;" class="TableStyle-Breadcrumbs-Column-Column1" />
            <col class="TableStyle-Breadcrumbs-Column-Column1" />
            <tbody>
                <tr class="TableStyle-Breadcrumbs-Body-Body1">
                    <th class="TableStyle-Breadcrumbs-BodyB-Column1-Body1">
                        <p class="home" style="font-weight: normal;"><a href="../../../Home_network.htm">Home</a> &gt;
                        </p>
                    </th>
                    <th class="TableStyle-Breadcrumbs-BodyA-Column1-Body1">
                        <div class="nocontent">
                            <div class="MCBreadcrumbsBox_0 breadcrumbs" data-mc-breadcrumbs-divider=" &gt; " data-mc-breadcrumbs-count="3" data-mc-toc="True"><span class="MCBreadcrumbsPrefix">  <![CDATA[ ]]></span>
                            </div>
                        </div>
                    </th>
                </tr>
            </tbody>
        </table>
        <h3>Opening a Remote PED Connection</h3>
        <p data-mc-conditions="Default.SA">There are two methods of establishing a Remote PED connection to the HSM:</p>
        <p class="ul1" data-mc-autonum="&lt;b&gt;&amp;gt;&lt;/b&gt;" data-mc-conditions="Default.SA"><span class="autonumber"><span class="ul1Bullet"><b>&gt;</b></span></span><b>HSM-initiated:</b> When the HSM requires authentication, it sends (via PEDclient) a request for PED services to the Remote PED host (which receives the request via PEDserver). This requires that the <span class="DefaultProduct">SafeNet Luna Network HSM</span> be allowed to initiate external connections, and that the PEDserver IP&#160;port remains open. If the <span class="DefaultProduct">SafeNet Luna Network HSM</span> resides behind a firewall with rules prohibiting these connections, or if your IT policy prohibits opening a port on the Remote PED host, use a PED-initiated connection. </p>
        <p class="listLevel1" data-mc-conditions="Default.SA">See <a href="#HSMinit" class="MCXref xref">HSM-Initiated Remote PED</a>.</p>
        <p class="ul1" data-mc-autonum="&lt;b&gt;&amp;gt;&lt;/b&gt;" data-mc-conditions="Default.SA"><span class="autonumber"><span class="ul1Bullet"><b>&gt;</b></span></span><b>PED-initiated:</b> The HSM and Remote PED host exchange and register certificates, creating a trusted connection. This allows the Remote PED host (via PEDserver) to initiate the connection to the <span class="DefaultProduct">SafeNet Luna Network HSM</span>. If you have firewall or other constraints that prevent your HSM from initiating a connection to a Remote PED in the external network, use this connection method. </p>
        <p class="listLevel1" data-mc-conditions="Default.SA">See <a href="#PEDinit" class="MCXref xref">PED-Initiated Remote PED</a>. </p>
        <p>If you encounter issues, see <a href="troubleshooting.htm" class="MCXref xref">Remote PED Troubleshooting</a>.</p>
        <h4>
            <MadCap:conditionalText data-mc-conditions="Default.SA"><a name="HSMinit"></a>HSM-Initiated Remote PED</MadCap:conditionalText>
        </h4>
        <p>The HSM/client administrator can use this procedure to establish an HSM-initiated Remote PED connection. <MadCap:conditionalText data-mc-conditions="Default.SA">The procedure is different depending on whether you are setting up Remote PED for the HSM appliance or a client. </MadCap:conditionalText>You require:</p>
        <p class="ul1" data-mc-autonum="&lt;b&gt;&amp;gt;&lt;/b&gt;"><span class="autonumber"><span class="ul1Bullet"><b>&gt;</b></span></span>Administrative access to a network-connected workstation with PEDserver installed and Luna PED connected (see <a href="PEDserver_install.htm" class="MCXref xref">Installing PEDserver and Setting Up the Remote Luna PED</a>)</p>
        <p class="ul1" data-mc-autonum="&lt;b&gt;&amp;gt;&lt;/b&gt;"><span class="autonumber"><span class="ul1Bullet"><b>&gt;</b></span></span>Administrative access to the <span class="DefaultProduct">SafeNet Luna Network HSM</span> via SSH<MadCap:conditionalText data-mc-conditions="Default.SA"> (if using Remote PED for HSM-level authentication)</MadCap:conditionalText></p>
        <p class="ul1" data-mc-autonum="&lt;b&gt;&amp;gt;&lt;/b&gt;" data-mc-conditions="Default.SA"><span class="autonumber"><span class="ul1Bullet"><b>&gt;</b></span></span>Administrative access to a Luna HSM Client workstation with an assigned user partition (if using Remote PED for partition-level authentication)</p>
        <p class="ul1" data-mc-autonum="&lt;b&gt;&amp;gt;&lt;/b&gt;" data-mc-conditions="Default.SA"><span class="autonumber"><span class="ul1Bullet"><b>&gt;</b></span></span>One of the following:</p>
        <p class="ul2" data-mc-autonum="&lt;b&gt;•&lt;/b&gt;" data-mc-conditions="Default.SA"><span class="autonumber"><span class="ul2Bullet"><b>•</b></span></span>Orange PED key with the HSM's RPV (see <a href="RPK.htm" class="MCXref xref">Initializing the Remote PED Vector (RPV) and Creating the Orange PED&#160;Key</a>)</p>
        <p class="ul2" data-mc-autonum="&lt;b&gt;•&lt;/b&gt;" data-mc-conditions="Default.SA"><span class="autonumber"><span class="ul2Bullet"><b>•</b></span></span>Blank orange PED key (or multiple keys, if you plan to use an M of N scheme)</p>
        <h5 data-mc-conditions="Default.SA">To launch PEDserver:</h5>
        <p class="ol1Start" data-mc-autonum="1."><span class="autonumber"><span class="ol1Number">1.</span></span>Open an Administrator command prompt by right-clicking the Command Prompt icon and selecting <b>Run as administrator</b>. This step is not necessary if you are running Windows Server 20xx, as the Administrator prompt is launched by default. </p>
        <p class="ol1" data-mc-autonum="2."><span class="autonumber"><span class="ol1Number">2.</span></span>Navigate to the SafeNet Luna HSM Client install directory. </p>
        <p class="listLevel1">&gt;<b>cd C:\Program Files\SafeNet\LunaClient\</b></p>
        <p class="ol1" data-mc-autonum="3."><span class="autonumber"><span class="ol1Number">3.</span></span>Launch PEDserver. See <a href="../ped_utils/pedserver.htm" class="MCXref xref">pedserver</a> for all available options. If you are launching PEDserver on an IPv6 network, you must include the <b>-ip</b> option. </p>
        <p class="listLevel1">&gt;<b>pedserver mode start</b> [<b>-ip</b> &lt;PEDserver_IP&gt;]</p><pre class="listLevel1" xml:space="preserve">C:\Program Files\SafeNet\LunaClient&gt;pedserver mode start</pre><pre class="listLevel1">Ped Server Version 1.0.6 (10006)</pre><pre class="listLevel1">Ped Server launched in startup mode.</pre><pre class="listLevel1">Starting background process</pre><pre class="listLevel1">Background process started</pre><pre class="listLevel1" xml:space="preserve">Ped Server Process created, exiting this process.</pre>
        <p class="ol1" data-mc-autonum="4."><span class="autonumber"><span class="ol1Number">4.</span></span>Verify that the service has launched successfully. </p>
        <p class="listLevel1">&gt;<b>pedserver mode show</b></p>
        <p class="listLevel1">Note the <b>Ped2 Connection Status</b>. If it says <b>Connected</b>, PEDserver is able to communicate with the Luna PED. </p>
        <p class="listLevel1">Note also the server port number (default: <b>1503</b>). You must specify this port along with the PEDserver host IP when you open a connection.</p><pre class="listLevel1">c:\Program Files\SafeNet\LunaClient&gt;pedserver mode show</pre><pre class="listLevel1">Ped Server Version 1.0.6 (10006)</pre><pre class="listLevel1" xml:space="preserve">Ped Server launched in status mode.</pre><pre class="listLevel1" xml:space="preserve">&#160;</pre><pre class="listLevel1" xml:space="preserve">   Server Information:</pre><pre class="listLevel1" xml:space="preserve">      Hostname:                           DWG9999</pre><pre class="listLevel1" xml:space="preserve">      IP:                                 0.0.0.0</pre><pre class="listLevel1" xml:space="preserve">      Firmware Version:                   2.7.1-5</pre><pre class="listLevel1" xml:space="preserve">      PedII Protocol Version:             1.0.1-0</pre><pre class="listLevel1" xml:space="preserve">      Software Version:                   1.0.6 (10006)</pre><pre class="listLevel1">&#160;</pre><pre class="listLevel1" xml:space="preserve">      Ped2 Connection Status:             <span style="color: #ff0000;">Connected</span></pre><pre class="listLevel1" xml:space="preserve">      Ped2 RPK Count                      0</pre><pre class="listLevel1" xml:space="preserve">      Ped2 RPK Serial Numbers             (none)</pre><pre class="listLevel1">&#160;</pre><pre class="listLevel1" xml:space="preserve">   Client Information:                    Not Available</pre><pre class="listLevel1">&#160;</pre><pre class="listLevel1" xml:space="preserve">   Operating Information:</pre><pre class="listLevel1" xml:space="preserve">      Server Port:                        <span style="color: #ff0000;">1503</span></pre><pre class="listLevel1" xml:space="preserve">      External Server Interface:          Yes</pre><pre class="listLevel1" xml:space="preserve">      Admin Port:                         1502</pre><pre class="listLevel1" xml:space="preserve">      External Admin Interface:           No</pre><pre class="listLevel1" xml:space="preserve">&#160;</pre><pre class="listLevel1" xml:space="preserve">      Server Up Time:                     190 (secs)</pre><pre class="listLevel1" xml:space="preserve">      Server Idle Time:                   0 (secs) (0%)</pre><pre class="listLevel1" xml:space="preserve">      Idle Timeout Value:                 1800 (secs)</pre><pre class="listLevel1" xml:space="preserve">&#160;</pre><pre class="listLevel1" xml:space="preserve">      Current Connection Time:            0 (secs)</pre><pre class="listLevel1" xml:space="preserve">      Current Connection Idle Time:       0 (secs)</pre><pre class="listLevel1" xml:space="preserve">      Current Connection Total Idle Time: 0 (secs) (100%)</pre><pre class="listLevel1" xml:space="preserve">      Total Connection Time:              0 (secs)</pre><pre class="listLevel1" xml:space="preserve">      Total Connection Idle Time:         0 (secs) (100%)</pre><pre class="listLevel1">&#160;</pre><pre class="listLevel1" xml:space="preserve">Show command passed.</pre>
        <p class="ol1" data-mc-autonum="5."><span class="autonumber"><span class="ol1Number">5.</span></span>Use <b>ipconfig</b> to determine the PEDserver host IP. A static IP&#160;is recommended, but if you are connecting over a VPN, you may need to determine the current IP&#160;each time you connect to the VPN server. </p>
        <p class="listLevel1">&gt;<b>ipconfig</b></p>
        <p data-mc-conditions="Default.SA">If you are setting up Remote PED with a <span class="DefaultProduct">SafeNet Luna Network HSM</span> appliance, see <a href="#OpenSA" class="MCXref xref">To open a Remote PED connection from the SafeNet Luna Network HSM appliance (LunaSH):</a>. </p>
        <p data-mc-conditions="Default.SA">If you are setting up Remote PED with a client, see <a href="#OpenClient" class="MCXref xref">To open a Remote PED connection from a client workstation (LunaCM):</a>. </p>
        <h5 data-mc-conditions="Default.SA"><a name="OpenSA"></a>To open a Remote PED connection from the <span class="DefaultProduct">SafeNet Luna Network HSM</span> appliance (LunaSH):</h5>
        <p class="ol1Start" data-mc-autonum="1." data-mc-conditions="Default.SA"><span class="autonumber"><span class="ol1Number">1.</span></span>Open an SSH session to the <span class="DefaultProduct">SafeNet Luna Network HSM</span> and log in to LunaSH as <b>admin</b>. </p>
        <p class="ol1" data-mc-autonum="2." data-mc-conditions="Default.SA"><span class="autonumber"><span class="ol1Number">2.</span></span>Initiate the Remote PED connection from the <span class="DefaultProduct">SafeNet Luna Network HSM</span>.</p>
        <p class="listLevel1" data-mc-conditions="Default.SA">lunash:&gt; <b>hsm ped connect -ip</b> &lt;PEDserver_IP&gt; <b>-port</b> &lt;PEDserver_port&gt; [<b>-serial</b> &lt;serial#&gt;]</p>
        <p class="note" data-mc-autonum="&lt;span style=&quot;color: #6c286b;&quot; class=&quot;mcFormatColor&quot;&gt; &lt;b&gt;NOTE&lt;/b&gt; &#160;&#160;&lt;/span&gt;" data-mc-conditions="Default.SA"><span class="autonumber"><span><span style="color: #6c286b;" class="mcFormatColor"> <b>NOTE</b> &#160;&#160;</span></span></span>The <b>-serial</b> option is required only if you are using Remote PED&#160;to authenticate a SafeNet Luna Backup HSM connected to one of the <span class="DefaultProduct">SafeNet Luna Network HSM</span>'s USB ports. If a serial number is not specified, the appliance's internal HSM is used.</p><pre class="listLevel1" xml:space="preserve" data-mc-conditions="Default.SA">lunash:&gt;hsm ped connect -ip 192.124.106.100 -port 1503</pre><pre class="listLevel1" xml:space="preserve" data-mc-conditions="Default.SA">&#160;</pre><pre class="listLevel1" xml:space="preserve" data-mc-conditions="Default.SA">Luna PED operation required to connect to Remote PED - use orange PED key(s).</pre>
        <p class="ul2" data-mc-autonum="&lt;b&gt;•&lt;/b&gt;" data-mc-conditions="Default.SA"><span class="autonumber"><span class="ul2Bullet"><b>•</b></span></span>If you have not yet initialized the RPV, and the HSM is not in initialized state, LunaSH prompts you to enter a password.</p><pre class="listLevel2" xml:space="preserve" data-mc-conditions="Default.SA">Enter PED Password:</pre>
        <p class="listLevel2" xml:space="preserve" data-mc-conditions="Default.SA">See <a href="RPK.htm#Remote" class="MCXref xref">Remote RPV Initialization</a> for this procedure. </p>
        <p class="ul2" data-mc-autonum="&lt;b&gt;•&lt;/b&gt;" data-mc-conditions="Default.SA"><span class="autonumber"><span class="ul2Bullet"><b>•</b></span></span>If you already initialized the RPV, the Luna PED prompts for the orange PED key.</p>
        <p class="listLevel2" data-mc-conditions="Default.SA">
            <img src="../../../Resources/Images/ped_screens/PEDscrn_orange_insert.svg" />
        </p>
        <p class="listLevel2" data-mc-conditions="Default.SA">Present the orange PED key with the correct RPV. The HSM authenticates the RPV, and control is returned to the LunaSH prompt. </p><pre class="listLevel2" xml:space="preserve" data-mc-conditions="Default.SA">Command Result : 0 (Success)</pre>
        <p class="listLevel2" xml:space="preserve" data-mc-conditions="Default.SA">The HSM-initiated Remote PED connection is now open. </p>
        <p class="ol1" data-mc-autonum="3." data-mc-conditions="Default.SA"><span class="autonumber"><span class="ol1Number">3.</span></span>Verify the Remote PED connection by entering a command that requires PED authentication.</p>
        <p class="ul2" data-mc-autonum="&lt;b&gt;•&lt;/b&gt;" data-mc-conditions="Default.SA"><span class="autonumber"><span class="ul2Bullet"><b>•</b></span></span>If the HSM is already initialized and you have the blue HSM SO key, you can use <b>hsm login</b>.</p>
        <p class="ul2" data-mc-autonum="&lt;b&gt;•&lt;/b&gt;" data-mc-conditions="Default.SA"><span class="autonumber"><span class="ul2Bullet"><b>•</b></span></span>If the HSM is uninitialized, you can initialize it now with <b>hsm init -label</b> &lt;label&gt;. Have blank or reusable blue and red PED keys ready (or multiple blue and red keys for M of N or to make multiple copies). See <a href="../key_mgmt/create.htm" class="MCXref xref">Creating PED Keys</a> for more information. </p>
        <p class="note" data-mc-autonum="&lt;span style=&quot;color: #6c286b;&quot; class=&quot;mcFormatColor&quot;&gt; &lt;b&gt;NOTE&lt;/b&gt; &#160;&#160;&lt;/span&gt;" data-mc-conditions="Default.SA"><span class="autonumber"><span><span style="color: #6c286b;" class="mcFormatColor"> <b>NOTE</b> &#160;&#160;</span></span></span>The HSM-initiated Remote PED connection eventually times out (default: 1800 seconds), and must be re-initiated each time authentication is required. To simplify this process, you can set a default IP&#160;address and/or port for LunaSH to use each time you connect. To drop the Remote PED connection manually, see <a href="disconnect_PED.htm" class="MCXref xref">Ending or Switching the Remote PED Connection</a>. </p>
        <p class="ol1" data-mc-autonum="4." data-mc-conditions="Default.SA"><span class="autonumber"><span class="ol1Number">4.</span></span>[OPTIONAL] Set a default IP address and/or port for the <span class="DefaultProduct">SafeNet Luna Network HSM</span> to look for a configured Remote PED. </p>
        <p class="listLevel1" data-mc-conditions="Default.SA">lunash:&gt;<b>hsm ped set -ip</b> &lt;PEDserver_IP&gt; <b>-port</b> &lt;PEDserver_port&gt;</p><pre class="listLevel1" xml:space="preserve" data-mc-conditions="Default.SA">lunash:&gt;hsm ped set -ip 192.124.106.100 -port 1503</pre><pre class="listLevel1" xml:space="preserve" data-mc-conditions="Default.SA">&#160;</pre><pre class="listLevel1" xml:space="preserve" data-mc-conditions="Default.SA">Command Result : 0 (Success)</pre>
        <p class="listLevel1" data-mc-conditions="Default.SA">With this default address set, the HSM administrator can use <b>hsm ped connect</b> (without specifying the IP/port) to initiate the Remote PED connection. The orange PED key will be required each time. </p>
        <p class="note" data-mc-autonum="&lt;span style=&quot;color: #6c286b;&quot; class=&quot;mcFormatColor&quot;&gt; &lt;b&gt;NOTE&lt;/b&gt; &#160;&#160;&lt;/span&gt;" data-mc-conditions="Default.SA"><span class="autonumber"><span><span style="color: #6c286b;" class="mcFormatColor"> <b>NOTE</b> &#160;&#160;</span></span></span>If you want to use the Remote PED&#160;to authenticate a different HSM, you must first drop the current connection. See <a href="disconnect_PED.htm" class="MCXref xref">Ending or Switching the Remote PED Connection</a>. </p>
        <h5 data-mc-conditions="Default.SA"><a name="OpenClient"></a>To open a Remote PED connection from a client workstation (LunaCM):</h5>
        <p class="ol1Start" data-mc-autonum="1." data-mc-conditions="Default.SA"><span class="autonumber"><span class="ol1Number">1.</span></span>Launch LunaCM on the client. </p>
        <p class="ol1" data-mc-autonum="2." data-mc-conditions="Default.SA"><span class="autonumber"><span class="ol1Number">2.</span></span>Initiate the Remote PED connection.</p>
        <p class="listLevel1" data-mc-conditions="Default.SA">lunacm:&gt;<b>ped connect -ip</b> &lt;PEDserver_IP&gt; <b>-port</b> &lt;PEDserver_port&gt;</p><pre class="listLevel1" xml:space="preserve" data-mc-conditions="Default.SA">lunacm:&gt;ped connect -ip 192.124.106.100 -port 1503</pre><pre class="listLevel1" xml:space="preserve" data-mc-conditions="Default.SA">&#160;</pre><pre class="listLevel1" xml:space="preserve" data-mc-conditions="Default.SA">Command Result : No Error</pre>
        <p class="ol1" data-mc-autonum="3." data-mc-conditions="Default.SA"><span class="autonumber"><span class="ol1Number">3.</span></span>Issue the first command that requires authentication. </p>
        <p class="ul2" data-mc-autonum="&lt;b&gt;•&lt;/b&gt;" data-mc-conditions="Default.SA"><span class="autonumber"><span class="ul2Bullet"><b>•</b></span></span>If the partition is already initialized and you have the blue Partition SO key, log in.</p>
        <p class="listLevel2" data-mc-conditions="Default.SA">lunacm:&gt;<b>role login -name po</b></p>
        <p class="ul2" data-mc-autonum="&lt;b&gt;•&lt;/b&gt;" data-mc-conditions="Default.SA"><span class="autonumber"><span class="ul2Bullet"><b>•</b></span></span>If the partition is uninitialized, you can initialize it now. Have blank or reusable blue and red PED keys ready (or multiple blue and red keys for MofN or multiple copies). See <a href="../key_mgmt/create.htm" class="MCXref xref">Creating PED Keys</a> for more information on creating PED keys. </p>
        <p class="listLevel2" data-mc-conditions="Default.SA">lunacm:&gt;<b>partition init -label</b> &lt;label&gt;</p>
        <p class="ol1" data-mc-autonum="4." data-mc-conditions="Default.SA"><span class="autonumber"><span class="ol1Number">4.</span></span>The Luna PED prompts for an orange PED key. Present the orange PED key with the correct RPK.</p>
        <p class="listLevel1" data-mc-conditions="Default.SA">
            <img src="../../../Resources/Images/ped_screens/PEDscrn_orange_insert.svg" />
        </p>
        <p class="ol1" data-mc-autonum="5." data-mc-conditions="Default.SA"><span class="autonumber"><span class="ol1Number">5.</span></span>The Luna PED prompts for the key associated with the command you issued. Follow the on-screen directions to complete the authentication process. </p>
        <p class="listLevel1" data-mc-conditions="Default.SA">
            <img src="../../../Resources/Images/ped_screens/PEDscrn_blue_login.svg" />
        </p>
        <p class="note" data-mc-autonum="&lt;span style=&quot;color: #6c286b;&quot; class=&quot;mcFormatColor&quot;&gt; &lt;b&gt;NOTE&lt;/b&gt; &#160;&#160;&lt;/span&gt;" data-mc-conditions="Default.SA"><span class="autonumber"><span><span style="color: #6c286b;" class="mcFormatColor"> <b>NOTE</b> &#160;&#160;</span></span></span>The HSM-initiated Remote PED connection eventually times out (default: 1800 seconds), and must be re-initiated each time authentication is required. To simplify this process, you can set a default IP&#160;address and/or port for LunaCM to use each time you connect. To drop the Remote PED connection manually, see <a href="disconnect_PED.htm" class="MCXref xref">Ending or Switching the Remote PED Connection</a></p>
        <p class="ol1" data-mc-autonum="6." data-mc-conditions="Default.SA"><span class="autonumber"><span class="ol1Number">6.</span></span>[OPTIONAL] Set a default IP address and/or port for the <span class="DefaultProduct">SafeNet Luna Network HSM</span> to look for a configured Remote PED. </p>
        <p class="listLevel1" data-mc-conditions="Default.SA">lunacm:&gt;<b>ped set -ip</b> &lt;PEDserver_IP&gt; <b>-port</b> &lt;PEDserver_port&gt;</p><pre class="listLevel1" xml:space="preserve" data-mc-conditions="Default.SA">lunacm:&gt;ped set -ip 192.124.106.100 -port 1503</pre><pre class="listLevel1" xml:space="preserve" data-mc-conditions="Default.SA">&#160;</pre><pre class="listLevel1" xml:space="preserve" data-mc-conditions="Default.SA">Command Result : 0 (Success)</pre>
        <p class="listLevel1" data-mc-conditions="Default.SA">With this default address set, the HSM administrator can use <b>ped connect</b> (without specifying the IP/port) to initiate the Remote PED connection. The orange PED key may be required if the RPK has been invalidated on the PED since you last used it. </p>
        <p class="note" data-mc-autonum="&lt;span style=&quot;color: #6c286b;&quot; class=&quot;mcFormatColor&quot;&gt; &lt;b&gt;NOTE&lt;/b&gt; &#160;&#160;&lt;/span&gt;" data-mc-conditions="Default.SA"><span class="autonumber"><span><span style="color: #6c286b;" class="mcFormatColor"> <b>NOTE</b> &#160;&#160;</span></span></span>If you want to use the Remote PED&#160;to authenticate a different HSM, you must first drop the current connection. See <a href="disconnect_PED.htm" class="MCXref xref">Ending or Switching the Remote PED Connection</a>. </p>
        <h4 data-mc-conditions="Default.SA"><a name="PEDinit"></a>PED-Initiated Remote PED</h4>
        <p data-mc-conditions="Default.SA">A PED-initiated connection requires the HSM and Remote PED host to exchange and register certificates, creating a trusted connection. This allows the Remote PED host (via PEDserver) to initiate the connection to the <span class="DefaultProduct">SafeNet Luna Network HSM</span>. If you have firewall or other constraints that prevent your HSM from initiating a connection to a Remote PED in the external network, use this connection method. The HSM administrator can use this procedure to set up the connection. You require:</p>
        <p class="ul1" data-mc-autonum="&lt;b&gt;&amp;gt;&lt;/b&gt;" data-mc-conditions="Default.SA"><span class="autonumber"><span class="ul1Bullet"><b>&gt;</b></span></span>Administrative access to a network-connected workstation with PEDserver installed and Luna PED connected (see <a href="PEDserver_install.htm" class="MCXref xref">Installing PEDserver and Setting Up the Remote Luna PED</a>)</p>
        <p class="ul1" data-mc-autonum="&lt;b&gt;&amp;gt;&lt;/b&gt;" data-mc-conditions="Default.SA"><span class="autonumber"><span class="ul1Bullet"><b>&gt;</b></span></span>Orange PED key with the HSM's RPV (see <a href="RPK.htm" class="MCXref xref">Initializing the Remote PED Vector (RPV) and Creating the Orange PED&#160;Key</a>)</p>
        <p class="ul1" data-mc-autonum="&lt;b&gt;&amp;gt;&lt;/b&gt;" data-mc-conditions="Default.SA"><span class="autonumber"><span class="ul1Bullet"><b>&gt;</b></span></span>Administrative access to the <span class="DefaultProduct">SafeNet Luna Network HSM</span> via SSH</p>
        <p class="note" data-mc-autonum="&lt;span style=&quot;color: #6c286b;&quot; class=&quot;mcFormatColor&quot;&gt; &lt;b&gt;NOTE&lt;/b&gt; &#160;&#160;&lt;/span&gt;" data-mc-conditions="Default.SA"><span class="autonumber"><span><span style="color: #6c286b;" class="mcFormatColor"> <b>NOTE</b> &#160;&#160;</span></span></span>The PED-initiated Remote PED connection procedure requires <b>admin</b> access to the appliance via LunaSH, and therefore this method cannot provide authentication services for client partitions. </p>
        <h5 data-mc-conditions="Default.SA">To open a PED-initiated Remote PED connection:</h5>
        <p class="ol1Start" data-mc-autonum="1." data-mc-conditions="Default.SA"><span class="autonumber"><span class="ol1Number">1.</span></span>On the Remote PED host, open an Administrator command prompt by right-clicking the Command Prompt icon and selecting <b>Run as administrator</b>. This step is not necessary if you are running Windows Server 20xx, as the Administrator prompt is launched by default. </p>
        <p class="ol1" data-mc-autonum="2." data-mc-conditions="Default.SA"><span class="autonumber"><span class="ol1Number">2.</span></span>Navigate to the SafeNet Luna HSM Client install directory (<b>C:\Program Files\SafeNet\LunaClient\</b>)</p>
        <p class="ol1" data-mc-autonum="3." data-mc-conditions="Default.SA"><span class="autonumber"><span class="ol1Number">3.</span></span>You will need the Remote PED host's NTLS certificate. If you have already set up an NTLS client connection to the appliance using LunaCM, you can find the certificate in <b>C:\Program Files\SafeNet\LunaClient\cert\client\</b> If the certificate is not available, you can generate it with the PEDserver utility. </p>
        <p class="caution" data-mc-autonum="&lt;span style=&quot;color: #6c286b;&quot; class=&quot;mcFormatColor&quot;&gt; &lt;b&gt;CAUTION!&lt;/b&gt; &#160;&#160;&lt;/span&gt;" data-mc-conditions="Default.SA"><span class="autonumber"><span><span style="color: #6c286b;" class="mcFormatColor"> <b>CAUTION!</b> &#160;&#160;</span></span></span>If the Remote PED host has registered NTLS partitions on any HSM, regenerating the certificate will cause you to lose contact with your registered NTLS partitions. Use the existing certificate instead. </p>
        <p class="listLevel1" data-mc-conditions="Default.SA">&gt;<b>pedserver -regen -commonname</b> &lt;name&gt;</p><pre class="listLevel1" xml:space="preserve" data-mc-conditions="Default.SA">c:\Program Files\SafeNet\LunaClient&gt;pedserver -regen -commonname RemotePED1</pre><pre class="listLevel1" xml:space="preserve" data-mc-conditions="Default.SA">Ped Server Version 1.0.6 (10006)</pre><pre class="listLevel1" xml:space="preserve" data-mc-conditions="Default.SA">&#160;</pre><pre class="listLevel1" data-mc-conditions="Default.SA">Are you sure you wish to regenerate the client certificate?</pre><pre class="listLevel1" xml:space="preserve" data-mc-conditions="Default.SA">All registered partitions may disappear.</pre><pre class="listLevel1" xml:space="preserve" data-mc-conditions="Default.SA">&#160;</pre><pre class="listLevel1" xml:space="preserve" data-mc-conditions="Default.SA">Are you sure you wish to continue?</pre><pre class="listLevel1" xml:space="preserve" data-mc-conditions="Default.SA">&#160;</pre><pre class="listLevel1" xml:space="preserve" data-mc-conditions="Default.SA">Type 'proceed' to continue, or 'quit' to quit now -&gt; proceed</pre><pre class="listLevel1" xml:space="preserve" data-mc-conditions="Default.SA">&#160;</pre><pre class="listLevel1" xml:space="preserve" data-mc-conditions="Default.SA">Private Key created and written to: C:\Program Files\SafeNet\LunaClient\cert\client\RemotePED1Key.pem</pre><pre class="listLevel1" xml:space="preserve" data-mc-conditions="Default.SA">Certificate created and written to: C:\Program Files\SafeNet\LunaClient\cert\client\RemotePED1.pem</pre><pre class="listLevel1" xml:space="preserve" data-mc-conditions="Default.SA">&#160;</pre><pre class="listLevel1" xml:space="preserve" data-mc-conditions="Default.SA">Successfully regenerated the client certificate.</pre>
        <p class="ol1" data-mc-autonum="4." data-mc-conditions="Default.SA"><span class="autonumber"><span class="ol1Number">4.</span></span>Use <b>pscp</b> to securely retrieve the <span class="DefaultProduct">SafeNet Luna Network HSM</span>'s NTLS certificate. Enter the appliance's admin account password when prompted. Note the period at the end of the command.</p>
        <p class="listLevel1" data-mc-conditions="Default.SA">&gt;<b>pscp admin@</b>&lt;appliance_IP&gt;<b>:server.pem .</b></p><pre class="listLevel1" xml:space="preserve" data-mc-conditions="Default.SA">c:\Program Files\SafeNet\LunaClient&gt;pscp admin@192.20.11.78:server.pem .</pre><pre class="listLevel1" xml:space="preserve" data-mc-conditions="Default.SA">admin@192.20.11.78's password:</pre><pre class="listLevel1" xml:space="preserve" data-mc-conditions="Default.SA">&#160;</pre><pre class="listLevel1" xml:space="preserve" data-mc-conditions="Default.SA">server.pem                | 1 kB |   1.1 kB/s | ETA: 00:00:00 | 100%</pre>
        <p class="ol1" data-mc-autonum="5." data-mc-conditions="Default.SA"><span class="autonumber"><span class="ol1Number">5.</span></span>Use <b>pscp</b> to securely transfer the Remote PED host's NTLS certificate to the <span class="DefaultProduct">SafeNet Luna Network HSM</span>'s <b>admin</b> account. </p>
        <p class="listLevel1" data-mc-conditions="Default.SA">&gt;<b>pscp .\cert\client\</b>&lt;certname&gt; <b>admin@</b>&lt;appliance_IP&gt;<b>:</b></p><pre class="listLevel1" xml:space="preserve" data-mc-conditions="Default.SA">c:\Program Files\SafeNet\LunaClient&gt;pscp .\cert\client\RemotePED1.pem admin@192.20.11.78:</pre><pre class="listLevel1" xml:space="preserve" data-mc-conditions="Default.SA">admin@192.20.11.78's password:</pre><pre class="listLevel1" xml:space="preserve" data-mc-conditions="Default.SA">&#160;</pre><pre class="listLevel1" xml:space="preserve" data-mc-conditions="Default.SA">RemotePED1.pem              | 1 kB |   1.1 kB/s | ETA: 00:00:00 | 100%</pre>
        <p class="ol1" data-mc-autonum="6." data-mc-conditions="Default.SA"><span class="autonumber"><span class="ol1Number">6.</span></span>Register the <span class="DefaultProduct">SafeNet Luna Network HSM</span> certificate with PEDserver. Use the mandatory <b>-name</b> argument to set a unique name for the appliance. The appliance listens for the SSL connection from PEDserver at the default port <b>9697</b>. </p>
        <p class="listLevel1" data-mc-conditions="Default.SA">&gt;<b>pedserver -appliance register -name</b> &lt;appliance_name&gt; <b>-certificate</b> &lt;cert_filename&gt; <b>-ip</b> &lt;appliance_IP&gt; <b>-port</b> &lt;port&gt;</p><pre class="listLevel1" xml:space="preserve" data-mc-conditions="Default.SA">c:\Program Files\SafeNet\LunaClient&gt;pedserver -appliance register -name myLunaHSM -certificate server.pem -ip 192.20.11.78 -port 9697</pre><pre class="listLevel1" xml:space="preserve" data-mc-conditions="Default.SA">Ped Server Version 1.0.6 (10006)</pre><pre class="listLevel1" xml:space="preserve" data-mc-conditions="Default.SA">&#160;</pre><pre class="listLevel1" xml:space="preserve" data-mc-conditions="Default.SA">Successfully registered host myLunaHSM.</pre>
        <p class="ol1" data-mc-autonum="7." data-mc-conditions="Default.SA"><span class="autonumber"><span class="ol1Number">7.</span></span>Open an SSH session to the <span class="DefaultProduct">SafeNet Luna Network HSM</span> and log in to LunaSH as <b>admin</b>.</p>
        <p class="ol1" data-mc-autonum="8." data-mc-conditions="Default.SA"><span class="autonumber"><span class="ol1Number">8.</span></span>Register the PEDserver host certificate.</p>
        <p class="listLevel1" data-mc-conditions="Default.SA">lunash:&gt;<b>hsm ped server register -certificate</b> &lt;certname&gt;</p><pre class="listLevel1" xml:space="preserve" data-mc-conditions="Default.SA">lunash:&gt;hsm ped server register -certificate RemotePED1.pem</pre><pre class="listLevel1" xml:space="preserve" data-mc-conditions="Default.SA">&#160;</pre><pre class="listLevel1" xml:space="preserve" data-mc-conditions="Default.SA">'hsm ped server register' successful.</pre><pre class="listLevel1" xml:space="preserve" data-mc-conditions="Default.SA">&#160;</pre><pre class="listLevel1" xml:space="preserve" data-mc-conditions="Default.SA">Command Result : 0 (Success)</pre>
        <p class="ol1" data-mc-autonum="9." data-mc-conditions="Default.SA"><span class="autonumber"><span class="ol1Number">9.</span></span>Initiate the connection between PEDserver and the <span class="DefaultProduct">SafeNet Luna Network HSM</span>. </p>
        <p class="listLevel1" data-mc-conditions="Default.SA">&gt;<b>pedserver mode connect -name</b> &lt;appliance_name&gt;</p><pre class="listLevel1" xml:space="preserve" data-mc-conditions="Default.SA">c:\Program Files\SafeNet\LunaClient&gt;pedserver mode connect -name myLunaHSM</pre><pre class="listLevel1" data-mc-conditions="Default.SA">Ped Server Version 1.0.6 (10006)</pre><pre class="listLevel1" data-mc-conditions="Default.SA">&#160;</pre><pre class="listLevel1" xml:space="preserve" data-mc-conditions="Default.SA">Connecting to myLunaHSM. Please wait..</pre><pre class="listLevel1" data-mc-conditions="Default.SA">&#160;</pre><pre class="listLevel1" xml:space="preserve" data-mc-conditions="Default.SA">Successfully connected to myLunaHSM.</pre>
        <p class="ol1" data-mc-autonum="10." data-mc-conditions="Default.SA"><span class="autonumber"><span class="ol1Number">10.</span></span>Using LunaSH, list the available registered Remote PED servers to find the server name (taken from the certificate filename during registration). Select the server you want to use to authenticate credentials for the appliance. </p>
        <p class="listLevel1" data-mc-conditions="Default.SA">lunash:&gt;<b>hsm ped server list</b></p>
        <p class="listLevel1" data-mc-conditions="Default.SA">lunash:&gt;<b>hsm ped select -host</b> &lt;server_name&gt;</p><pre class="listLevel1" xml:space="preserve" data-mc-conditions="Default.SA">lunash:&gt;hsm ped server list</pre><pre class="listLevel1" xml:space="preserve" data-mc-conditions="Default.SA">&#160;</pre><pre class="listLevel1" xml:space="preserve" data-mc-conditions="Default.SA">   Number of Registered PED Server :  1</pre><pre class="listLevel1" data-mc-conditions="Default.SA">&#160;</pre><pre class="listLevel1" xml:space="preserve" data-mc-conditions="Default.SA">      PED Server  1 : CN = RemotePED1</pre><pre class="listLevel1" data-mc-conditions="Default.SA">&#160;</pre><pre class="listLevel1" data-mc-conditions="Default.SA">Command Result : 0 (Success)</pre><pre class="listLevel1" xml:space="preserve" data-mc-conditions="Default.SA">&#160;</pre><pre class="listLevel1" xml:space="preserve" data-mc-conditions="Default.SA">&#160;</pre><pre class="listLevel1" xml:space="preserve" data-mc-conditions="Default.SA">lunash:&gt;hsm ped select -host RemotePED1</pre><pre class="listLevel1" xml:space="preserve" data-mc-conditions="Default.SA">&#160;</pre><pre class="listLevel1" xml:space="preserve" data-mc-conditions="Default.SA">Luna PED operation required to connect to Remote PED - use orange PED key(s).</pre>
        <p class="ol1" data-mc-autonum="11." data-mc-conditions="Default.SA"><span class="autonumber"><span class="ol1Number">11.</span></span>The Luna PED prompts for an orange PED key. Present the orange PED key with the correct RPK for the HSM.</p>
        <p class="listLevel1" data-mc-conditions="Default.SA">
            <img src="../../../Resources/Images/ped_screens/PEDscrn_orange_insert.svg" />
        </p>
        <p class="listLevel1" data-mc-conditions="Default.SA">The secure network connection is now in place between PEDserver and the appliance. You may now perform any actions that require Remote PED authentication. The PED-initiated Remote PED connection does not time out as long as PEDserver is running. If you wish to end the connection in order to connect to a different instance of PEDserver, see <a href="disconnect_PED.htm" class="MCXref xref">Ending or Switching the Remote PED Connection</a>. </p>
        <p class="footer"><span class="DefaultProduct">SafeNet Luna Network HSM</span> <span class="DefaultRelease">7.2</span> <span class="DefaultProjectTitle">Product Documentation</span> <br /><span class="DefaultPartNumber">007-013576-004</span> <span class="DefaultRevision">Rev. C</span> <span style="color: #5e5e5c;"><![CDATA[  ]]></span> <span class="DefaultDateLong">06 May 2019</span> <span style="color: #5e5e5c;"><![CDATA[  ]]></span> <span class="DefaultCopyright">Copyright 2001-2019</span>&#160;<span class="DefaultCompanyNameLong">Gemalto</span> <span style="color: #5e5e5c;"><![CDATA[  ]]></span>All rights reserved. </p>
    </body>
</html>