<!-- HTML header for doxygen 1.8.7-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.12"/>
<title>REST API: Tasks</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="gemalto_logo.png"/></td>
  <td style="padding-left: 0.5em;">
   <div id="projectname">REST API
   &#160;<span id="projectnumber">7.2</span>
   </div>
   <div id="projectbrief">REST API for SafeNet Network HSMs</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.12 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('_tasks_overview_page_name.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">Tasks </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><h1>Tasks </h1>
<h2>Introduction </h2>
<p>Many administrative actions take noticeable time to complete: they are not instantaneous. For example, the action of updating the firmware on the HSM can take a couple minutes to complete. Rather than block and wait for the action to complete, the REST API creates tasks for time-consuming resources and returns a response immediately for the action. An application can monitor an associated task for state and perform different actions depending upon the state. Returning to firmware update, for example, an application might display: an hour glass to signify that the operation is still in progress; a check mark for a successful completion; or an X for a failed operation. The state obtained for a GET operation on the applicable task identifier provides the information needed to decide what follow on action to take. <br />
</p>
<h2>How to Use Tasks </h2>
<p>An application can use a task and the state returned on query in different ways. The description that follows outlines one way. For the purpose of an example, assume that you want to login to the HSM. <br />
<br />
 Post the login resource on the HSM: <br />
 <code> </p><pre class="fragment">POST /api/lunasa/hsms/151256/login

{"ped": "1", "password": "", "role": "so"}
</pre><p> </code> <br />
 You get back: <br />
 <code> </p><pre class="fragment">{
    "finishTime": "",
    "instance": "/tasks/3",
    "responseUrl": "/tasks/3/response",
    "sourceUrl": "/api/lunasa/hsms/151256/login",
    "startTime": "",
    "state": "Waiting",
    "details": ""
}
</pre><p> </code> <br />
 To obtain a list of tasks from the appliance, get the tasks: <br />
 <code> </p><pre class="fragment">GET /tasks
</pre><p> </code> <br />
 The server response for our example might include: <code> </p><pre class="fragment">{
    "tasks": [
        {
            "finishTime": "",
            "instance": "/tasks/6",
            "responseUrl": "/tasks/6/response",
            "sourceUrl": "",
            "startTime": "2015-07-05T06:53:36Z",
            "state": "Running",
            "details":""
        }
    ]
}
</pre><p> </code> <br />
 "Running" means that the HSM login action is still in progress. After sufficient time to allow the login to complete, a query of tasks shows: <br />
 <code> </p><pre class="fragment">{
    "tasks": [
        {
            "finishTime": "2015-07-05T06:53:49Z",
            "instance": "/tasks/6",
            "responseUrl": "/tasks/6/response",
            "sourceUrl": "/api/lunasa/hsms/151256/login",
            "startTime": "2015-07-05T06:53:36Z",
            "state": "Finished",
            "details":""
        }
    ]
}
</pre><p> </code> <br />
 Starting a login again and using the task instance returned in the server response to do a GET operation shows: <br />
 <code> </p><pre class="fragment">GET /tasks/7
...
{
    "finishTime": "",
    "instance": "/tasks/7",
    "responseUrl": "/tasks/7/response",
    "sourceUrl": "/api/lunasa/hsms/151256/login",
    "startTime": "2015-07-05T09:10:30Z",
    "state": "Running",
    "details":""
}
</pre><p> </code> <br />
 Periodically polling with a GET on this resource continues to show a "Running" state. If the action fails (e.g., no PED response), the server response is: <br />
 <code> </p><pre class="fragment">GET /tasks/7
...
    "finishTime": "2015-07-05T09:15:30Z",
    "instance": "/tasks/7",
    "responseUrl": "/tasks/7/response",
    "sourceUrl": "/api/lunasa/hsms/151256/login",
    "startTime": "2015-07-05T09:10:30Z",
    "state": "Error",
    "details":""
}
</pre><p> </code> <br />
 Other states that you might encounter are:</p><ul>
<li>"Waiting" - This state means that the REST API is blocked from handing off a request to a plugin to complete. For example, with multi-party authentication, login to the REST API reports this state until authentication is established.</li>
<li>"Cancelled" - This state is reserved for future use and is TBD until then.</li>
<li>"Timed Out" - This state is reserved for future use and is TBD until then.</li>
<li>"Skipped" - This state is reserved for future use and is TBD until then.</li>
</ul>
<p><br />
 NOTE: Applications may choose to cleanup the tasks, this is done with the delete task resources (DELETE /tasks/{taskid} and DELETE /tasks), however this is not required as the maxiumum amount of stale tasks is 20. Stale tasks refer to tasks that either need to be started or queried for results in order to be removed (Waiting, Finished, Error).</p>
<h2>Tasked Resources </h2>
<p>Any resource action can result in a task. The return code for a tasked action on a resource is 202. Some resource actions are more likely to always use tasks to track progress, specifically:</p><ul>
<li>POST /api/lunasa/hsms/{hsmid}/... (see Note 1)</li>
<li>POST /api/lunasa/hsms/{hsmid}/partitions/{partitionid}/actions/backup</li>
<li>POST /api/lunasa/hsms/{hsmid}/partitions/{partitionid}/actions/restore</li>
<li>DELETE /api/lunasa/hsms/{hsmid}/partitions/{partitionid}</li>
<li>POST /api/lunasa/hsms/{hsmid}/partitions</li>
<li>POST /api/lunasa/hsms/{hsmid}/partitions/{partitionid}/actions/initialize</li>
<li>PUT /api/lunasa/hsms/{hsmid}/partitions/{partitionid}/roles/{roleid}/password</li>
<li>PUT /api/lunasa/hsms/{hsmid}/partitions/{partitionid}/roles/{roleid}</li>
<li>PUT /api/lunasa/hsms/{hsmid}/partitions/{partitionid}/policies/{policyid}</li>
<li>PATCH/api/lunasa/hsms/{hsmid}/partitions/{partitionid}/policies/{policyid}</li>
<li>POST /api/lunasa/hsms/{hsmid}/peds/{pedid}/actions/connect</li>
<li>POST /api/lunasa/hsms/{hsmid}/peds/{pedid}/actions/disconnect</li>
<li>POST /api/lunasa/hsms/{hsmid}/firmware/actions/rollback</li>
<li>POST /api/lunasa/hsms/{hsmid}/firmware/actions/upgrade</li>
<li>PUT /api/lunasa/hsms/{hsmid}/policies/{policyid}</li>
<li>PATCH /api/lunasa/hsms/{hsmid}/policies/{policyid}</li>
</ul>
<p><br />
 Note 1: Any resource that uses the PIN entry device is tasked. For example, /api/lunasa/hsms/{hsmid}/login. <br />
 <br />
 Some reference pages show examples of how tasks might result for certain operations. </p>
</div></div><!-- contents -->
</div><!-- doc-content -->
<p class="footer">
<span class="DefaultProduct">REST API for SafeNet Network HSMs</span>
<span class="DefaultRelease">7.2</span>
<span class="DefaultProjectTitle">Reference Guide</span><br />
<span class="DefaultPartNumber">007-013576-005</span>
<span class="DefaultRevision">Rev. A</span>
<span style="color: #5e5e5c;"> <![CDATA[ ]]></span><span style="color: #5e5e5c;"> <![CDATA[ ]]></span>
<span class="DefaultCopyright">Copyright 2015-2018</span>&#160;
<span class="DefaultCompanyNameLong">Gemalto.</span>
<span style="color: #5e5e5c;"> <![CDATA[ ]]></span>All rights reserved. </p>
