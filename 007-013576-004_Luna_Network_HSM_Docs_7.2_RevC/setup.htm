<!DOCTYPE html>
<html xmlns:MadCap="http://www.madcapsoftware.com/Schemas/MadCap.xsd" lang="en-us" xml:lang="en-us" data-mc-search-type="Stem" data-mc-help-system-file-name="index.xml" data-mc-path-to-help-system="../../../" data-mc-target-type="WebHelp2" data-mc-runtime-file-type="Topic" data-mc-preload-images="false" data-mc-in-preview-mode="false" data-mc-medium="non-print" data-mc-toc-path="HSM Administration Guide|[%=System.LinkedTitle%]">
    <head>
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <meta charset="utf-8" />
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <meta http-equiv="Content-Type" content="text/html; charset=utf-8" /><title>Setting Up an HA Group</title>
        <link href="../../../Skins/Default/Stylesheets/Slideshow.css" rel="stylesheet" />
        <link href="../../../Skins/Default/Stylesheets/TextEffects.css" rel="stylesheet" />
        <link href="../../../Skins/Default/Stylesheets/Topic.css" rel="stylesheet" />
        <link href="../../../Skins/Default/Stylesheets/Components/Styles.css" rel="stylesheet" />
        <link href="../../Resources/TableStyles/Breadcrumbs.css" rel="stylesheet" />
        <link href="../../Resources/Stylesheets/Gemalto_Template.css" rel="stylesheet" />
        <script src="../../../Resources/Scripts/custom.modernizr.js">
        </script>
        <script src="../../../Resources/Scripts/jquery.min.js">
        </script>
        <script src="../../../Resources/Scripts/require.min.js">
        </script>
        <script src="../../../Resources/Scripts/require.config.js">
        </script>
        <script src="../../../Resources/Scripts/foundation.min.js">
        </script>
        <script src="../../../Resources/Scripts/plugins.min.js">
        </script>
        <script src="../../../Resources/Scripts/MadCapAll.js">
        </script>
    </head>
    <body>
        <p class="MCWebHelpFramesetLink MCWebHelpFramesetLinkTop"><a href="../../../index.html#administration/ha/setup.htm">Show Navigation</a>
        </p>
        <!-- Remove this comment to enable syntax highlighting		
        <script type="text/javascript" src="../Stylesheets/SyntaxHilite/Prism/prism.js"></script>
-->
        <table style="width: 100%;border-spacing: 0px 0px;mc-table-style: url('../../Resources/TableStyles/Breadcrumbs.css');border-left-style: none;border-left-width: 1px;border-left-color: #000000;border-right-style: none;border-right-width: 1px;border-right-color: #000000;border-top-style: none;border-top-width: 0px;border-top-color: #000000;border-bottom-style: none;border-bottom-width: 0px;" class="TableStyle-Breadcrumbs" cellspacing="0">
            <col style="width: 41px;" class="TableStyle-Breadcrumbs-Column-Column1" />
            <col class="TableStyle-Breadcrumbs-Column-Column1" />
            <tbody>
                <tr class="TableStyle-Breadcrumbs-Body-Body1">
                    <th class="TableStyle-Breadcrumbs-BodyB-Column1-Body1">
                        <p class="home" style="font-weight: normal;"><a href="../../Home_network.htm">Home</a> &gt;
                        </p>
                    </th>
                    <th class="TableStyle-Breadcrumbs-BodyA-Column1-Body1">
                        <div class="nocontent">
                            <div class="MCBreadcrumbsBox_0 breadcrumbs" data-mc-breadcrumbs-divider=" &gt; " data-mc-breadcrumbs-count="3" data-mc-toc="True"><span class="MCBreadcrumbsPrefix">  <![CDATA[ ]]></span>
                            </div>
                        </div>
                    </th>
                </tr>
            </tbody>
        </table>
        <h2>Setting Up an HA Group</h2>
        <p>Use LunaCM to create an HA group from partitions assigned to your client. This procedure is completed by the Crypto Officer. Ensure that you have met all necessary prerequisites before proceeding with group creation. For a detailed description of HA functionality, see <a href="functionality.htm" class="MCXref xref">How HA Works</a>. </p>
        <p class="note" data-mc-autonum="&lt;span style=&quot;color: #6c286b;&quot; class=&quot;mcFormatColor&quot;&gt; &lt;b&gt;NOTE&lt;/b&gt; &#160;&#160;&lt;/span&gt;"><span class="autonumber"><span><span style="color: #6c286b;" class="mcFormatColor"> <b>NOTE</b> &#160;&#160;</span></span></span>Your LunaCM instance needs to update the <b>Chrystoki.conf</b> (Linux/UNIX) or <b>crystoki.ini</b> file (Windows) when setting up or reconfiguring HA. Ensure that you have Administrator privileges on the client workstation.</p>
        <h3 class="ntoc">Prerequisites</h3>
        <p>HA groups are set up in LunaCM by the Crypto Officer. Before the CO can perform this setup, however, all HSMs and member partitions must meet the following prerequisites, completed by the HSM and Partition Security Officers.</p>
        <h4>HSMs</h4>
        <p>The HSM SO must ensure that all HSMs containing HA group member partitions meet the following prerequisites:</p>
        <p class="ul1" data-mc-autonum="&lt;b&gt;&amp;gt;&lt;/b&gt;"><span class="autonumber"><span class="ul1Bullet"><b>&gt;</b></span></span>All HSMs must be the same hardware type (a mix of Network and PCIe HSMs is not supported) and use the same authentication method (Password/PED).</p>
        <p class="ul1" data-mc-autonum="&lt;b&gt;&amp;gt;&lt;/b&gt;" data-mc-conditions="Default.SA"><span class="autonumber"><span class="ul1Bullet"><b>&gt;</b></span></span>All must be running one of the supported software/firmware versions. Generally, <span class="DefaultCompanyNameLong">Gemalto</span> recommends using HSMs with the same software/firmware for HA. However, mixed-version HA groups containing Luna 6 and 7 member partitions are supported. See <a href="mixed.htm" class="MCXref xref">Luna 6/7 Mixed-Version HA Groups</a> for more information. </p>
        <p class="ul1" data-mc-autonum="&lt;b&gt;&amp;gt;&lt;/b&gt;" data-mc-conditions="Default.SA"><span class="autonumber"><span class="ul1Bullet"><b>&gt;</b></span></span>Network setup must be complete and the appliances must be accessible via SSH.</p>
        <p class="ul1" data-mc-autonum="&lt;b&gt;&amp;gt;&lt;/b&gt;"><span class="autonumber"><span class="ul1Bullet"><b>&gt;</b></span></span>HSM policies <b>7: Allow Cloning</b> and <b>16: Allow Network Replication</b> must be set to <b>1</b> (see <a href="../../configuration/initial_setup/about_hsm_capabilities_and_policies.htm" class="MCXref xref">Set the HSM Policies</a> in the <i>Configuration Guide</i>).</p>
        <p class="ul1" data-mc-autonum="&lt;b&gt;&amp;gt;&lt;/b&gt;"><span class="autonumber"><span class="ul1Bullet"><b>&gt;</b></span></span>HSM policies must be consistent across all HSMs, particularly <b>12: Allow non-FIPS algorithms</b>. Do not attempt to use an HA group combining HSMs with FIPS mode on and others with FIPS mode off.</p>
        <p class="ul1" data-mc-autonum="&lt;b&gt;&amp;gt;&lt;/b&gt;" data-mc-conditions="Default.SA"><span class="autonumber"><span class="ul1Bullet"><b>&gt;</b></span></span>The client must be able to access all the application partitions using NTLS or STC links (see <a href="../../configuration/client_partition/client_partition.htm" class="MCXref xref">Enable the Client to Access a Partition</a> in the <i>Configuration Guide</i>).</p>
        <h4>Partitions</h4>
        <p>The Partition SO must ensure that all partitions in an HA group meet the following prerequisites:</p>
        <p class="ul1" data-mc-autonum="&lt;b&gt;&amp;gt;&lt;/b&gt;" data-mc-conditions="Default.SA"><span class="autonumber"><span class="ul1Bullet"><b>&gt;</b></span></span>The partitions must be created on different HSMs; partitions on a single HSM cannot provide failover for each other, as they have a single point of failure.</p>
        <p class="ul1" data-mc-autonum="&lt;b&gt;&amp;gt;&lt;/b&gt;"><span class="autonumber"><span class="ul1Bullet"><b>&gt;</b></span></span>All partitions must be visible in LunaCM on the <MadCap:conditionalText data-mc-conditions="Default.SA">client</MadCap:conditionalText> workstation.</p>
        <p class="ul1" data-mc-autonum="&lt;b&gt;&amp;gt;&lt;/b&gt;"><span class="autonumber"><span class="ul1Bullet"><b>&gt;</b></span></span>All partitions must be initialized with the same cloning domain:</p>
        <p class="ul2" data-mc-autonum="&lt;b&gt;•&lt;/b&gt;" data-mc-conditions="Default.Password"><span class="autonumber"><span class="ul2Bullet"><b>•</b></span></span>Password-authenticated partitions must share the same domain string.</p>
        <p class="ul2" data-mc-autonum="&lt;b&gt;•&lt;/b&gt;" data-mc-conditions="Default.PED"><span class="autonumber"><span class="ul2Bullet"><b>•</b></span></span>PED-authenticated partitions must share the same red domain PED key.</p>
        <p class="ul1" data-mc-autonum="&lt;b&gt;&amp;gt;&lt;/b&gt;"><span class="autonumber"><span class="ul1Bullet"><b>&gt;</b></span></span>Partition policies <b>0: Allow private key cloning</b> and <b>4: Allow secret key cloning</b> must be set to <b>1</b> on all partitions.</p>
        <p class="ul1" data-mc-autonum="&lt;b&gt;&amp;gt;&lt;/b&gt;"><span class="autonumber"><span class="ul1Bullet"><b>&gt;</b></span></span>Partition policies must be consistent across all member partitions.</p>
        <p class="ul1" data-mc-autonum="&lt;b&gt;&amp;gt;&lt;/b&gt;"><span class="autonumber"><span class="ul1Bullet"><b>&gt;</b></span></span>The Crypto Officer role on each partition must be initialized with the same CO credential (password or black PED key).</p>
        <p class="ul1" data-mc-autonum="&lt;b&gt;&amp;gt;&lt;/b&gt;" data-mc-conditions="Default.PED"><span class="autonumber"><span class="ul1Bullet"><b>&gt;</b></span></span>PED-authenticated partitions must have partition policies <b>22: Allow activation</b> and <b>23: Allow auto-activation</b> set to <b>1</b>. All partitions must be activated and have auto-activation enabled, so that they can retain their login state after failure/recovery. Each partition must have the same activation challenge secret set (see <a href="../partitions/about_activation_and_auto-activation.htm" class="MCXref xref">Activation and Auto-Activation on PED-Authenticated Partitions</a>)</p>
        <p class="note" data-mc-autonum="&lt;span style=&quot;color: #6c286b;&quot; class=&quot;mcFormatColor&quot;&gt; &lt;b&gt;NOTE&lt;/b&gt; &#160;&#160;&lt;/span&gt;"><span class="autonumber"><span><span style="color: #6c286b;" class="mcFormatColor"> <b>NOTE</b> &#160;&#160;</span></span></span>If HSM policy <b>21: Force user PIN change after set/reset</b> is set to <b>1</b> (the default setting), the Crypto Officer must change the initial CO credential before using the partition for cryptographic operations<MadCap:conditionalText data-mc-conditions="Default.PED">. This applies to the activation challenge secret as well</MadCap:conditionalText> (see <a href="../../lunacm/commands/role/role_changepw.htm" class="MCTopicPopup MCTopicPopupHotSpot MCXref xref">role changepw</a> in the <i>LunaCM Command Reference Guide</i>). </p>
        <h5>To set up an HA group</h5>
        <p class="ol1Start" data-mc-autonum="1."><span class="autonumber"><span class="ol1Number">1.</span></span>Create a new HA group, specifying the following information (see <a href="../../lunacm/commands/hagroup/hagroup_creategroup.htm" class="MCTopicPopup MCTopicPopupHotSpot MCXref xref">hagroup creategroup</a>):</p>
        <p class="ul2" data-mc-autonum="&lt;b&gt;•&lt;/b&gt;"><span class="autonumber"><span class="ul2Bullet"><b>•</b></span></span>the group label (do not call the group "HA")</p>
        <p class="ul2" data-mc-autonum="&lt;b&gt;•&lt;/b&gt;"><span class="autonumber"><span class="ul2Bullet"><b>•</b></span></span> the Serial number OR the slot number of the first member partition</p>
        <p class="ul2" data-mc-autonum="&lt;b&gt;•&lt;/b&gt;"><span class="autonumber"><span class="ul2Bullet"><b>•</b></span></span>the Crypto Officer password or challenge secret for the partition</p>
        <p class="listLevel1">lunacm:&gt;<b>hagroup creategroup -label</b> &lt;label&gt; {<b>-slot</b> &lt;slotnum&gt; | <b>-serialnumber</b> &lt;serialnum&gt;}</p><pre class="listLevel1" xml:space="preserve">lunacm:&gt; hagroup creategroup -label myHAgroup -slot 0</pre><pre class="listLevel1" xml:space="preserve">&#160;</pre><pre class="listLevel1" xml:space="preserve">        Enter the password: ********</pre><pre class="listLevel1">&#160;</pre><pre class="listLevel1" xml:space="preserve">        New group with label "myHAgroup" created with group number 1154438865287.</pre><pre class="listLevel1" xml:space="preserve">        Group configuration is:</pre><pre class="listLevel1">&#160;</pre><pre class="listLevel1" xml:space="preserve">         HA Group Label:  myHAgroup</pre><pre class="listLevel1" xml:space="preserve">        HA Group Number:  1154438865287</pre><pre class="listLevel1" xml:space="preserve">       HA Group Slot ID:  Not Available</pre><pre class="listLevel1" xml:space="preserve">        Synchronization:  enabled</pre><pre class="listLevel1" xml:space="preserve">          Group Members:  154438865287</pre><pre class="listLevel1" xml:space="preserve">             Needs sync:  no</pre><pre class="listLevel1" xml:space="preserve">        Standby Members:  &lt;none&gt;</pre><pre class="listLevel1">&#160;</pre><pre class="listLevel1">&#160;</pre><pre class="listLevel1">Slot #    Member S/N                      Member Label    Status</pre><pre class="listLevel1">======    ==========                      ============    ======</pre><pre class="listLevel1" xml:space="preserve">     0  154438865287                              par0     alive</pre><pre class="listLevel1">&#160;</pre><pre class="listLevel1">&#160;</pre><pre class="listLevel1">Command Result : No Error</pre>
        <p class="listLevel1">LunaCM generates a serial number for the HA group (by adding a "1" before the partition serial number), assigns it a virtual slot number, and automatically restarts. </p><pre class="listLevel1">lunacm (64-bit) v7.3.0-74. Copyright (c) 2018 SafeNet. All rights reserved.</pre><pre class="listLevel1">&#160;</pre><pre class="listLevel1">&#160;</pre><pre class="listLevel1" xml:space="preserve">        Available HSMs:</pre><pre class="listLevel1" xml:space="preserve">&#160;</pre><pre class="listLevel1" xml:space="preserve">        Slot Id -&gt;              0</pre><pre class="listLevel1" xml:space="preserve">        Label -&gt;                par0</pre><pre class="listLevel1" xml:space="preserve">        Serial Number -&gt;        154438865287</pre><pre class="listLevel1" xml:space="preserve">        Model -&gt;                LunaSA 7.3.0</pre><pre class="listLevel1" xml:space="preserve">        Firmware Version -&gt;     7.3.0</pre><pre class="listLevel1" xml:space="preserve">        Configuration -&gt;        Luna User Partition With SO (PW) Key 
                                Export With Cloning Mode</pre><pre class="listLevel1" xml:space="preserve">        Slot Description -&gt;     Net Token Slot</pre><pre class="listLevel1">&#160;</pre><pre class="listLevel1" xml:space="preserve">        Slot Id -&gt;              1</pre><pre class="listLevel1" xml:space="preserve">        Label -&gt;                par1</pre><pre class="listLevel1" xml:space="preserve">        Serial Number -&gt;        1238700701509</pre><pre class="listLevel1" xml:space="preserve">        Model -&gt;                LunaSA 7.3.0</pre><pre class="listLevel1" xml:space="preserve">        Firmware Version -&gt;     7.3.0</pre><pre class="listLevel1" xml:space="preserve">        Configuration -&gt;        Luna User Partition With SO (PW) Key 
                                Export With Cloning Mode</pre><pre class="listLevel1" xml:space="preserve">        Slot Description -&gt;     Net Token Slot</pre><pre class="listLevel1">&#160;</pre><pre class="listLevel1" xml:space="preserve">        Slot Id -&gt;              5</pre><pre class="listLevel1" xml:space="preserve">        HSM Label -&gt;            myHAgroup</pre><pre class="listLevel1" xml:space="preserve">        HSM Serial Number -&gt;    1154438865287</pre><pre class="listLevel1" xml:space="preserve">        HSM Model -&gt;            LunaVirtual</pre><pre class="listLevel1" xml:space="preserve">        HSM Firmware Version -&gt; 7.3.0</pre><pre class="listLevel1" xml:space="preserve">        HSM Configuration -&gt;    Luna Virtual HSM (PW) Key Export With 
                                Cloning Mode</pre><pre class="listLevel1" xml:space="preserve">        HSM Status -&gt;           N/A - HA Group</pre><pre class="listLevel1" xml:space="preserve">&#160;</pre><pre class="listLevel1" xml:space="preserve">&#160;</pre><pre class="listLevel1" xml:space="preserve">Current Slot Id: 0</pre>
        <p class="ol1" data-mc-autonum="2."><span class="autonumber"><span class="ol1Number">2.</span></span>Add another 
partition to the HA group, specifying either the slot or the serial number (<a href="../../lunacm/commands/hagroup/hagroup_addmember.htm" class="MCTopicPopup MCTopicPopupHotSpot MCXref xref">hagroup addmember</a>) If the new member contains cryptographic objects, you are prompted to decide whether to replicate the objects within the HA group, or delete them.</p>
        <p class="listLevel1">lunacm:&gt;<b>hagroup addmember -group</b> &lt;grouplabel&gt; {<b>-slot</b> &lt;slotnum&gt; | <b>-serialnumber</b> &lt;serialnum&gt;}</p><pre class="listLevel1" xml:space="preserve">lunacm:&gt; hagroup addmember -group myHAgroup -slot 1</pre><pre class="listLevel1" xml:space="preserve">&#160;</pre><pre class="listLevel1" xml:space="preserve">&#160;</pre><pre class="listLevel1" xml:space="preserve">        Enter the password: ********</pre><pre class="listLevel1" xml:space="preserve">&#160;</pre><pre class="listLevel1" xml:space="preserve">&#160;</pre><pre class="listLevel1">Warning:  There are objects currently on the new member.</pre><pre class="listLevel1" xml:space="preserve">          Do you wish to propagate these objects within the HA</pre><pre class="listLevel1" xml:space="preserve">          group, or remove them?</pre><pre class="listLevel1">&#160;</pre><pre class="listLevel1" xml:space="preserve">          Type 'copy' to keep and propagate the existing</pre><pre class="listLevel1" xml:space="preserve">          objects, 'remove' to remove them before continuing,</pre><pre class="listLevel1" xml:space="preserve">          or 'quit' to stop adding this new group member.</pre><pre class="listLevel1" xml:space="preserve">          &gt;  copy</pre><pre class="listLevel1" xml:space="preserve">&#160;</pre><pre class="listLevel1" xml:space="preserve">        Member 1238700701509 successfully added to group myHAgroup. New group</pre><pre class="listLevel1" xml:space="preserve">        configuration is:</pre><pre class="listLevel1">&#160;</pre><pre class="listLevel1" xml:space="preserve">         HA Group Label:  myHAgroup</pre><pre class="listLevel1" xml:space="preserve">        HA Group Number:  1154438865287</pre><pre class="listLevel1" xml:space="preserve">       HA Group Slot ID:  5</pre><pre class="listLevel1" xml:space="preserve">        Synchronization:  enabled</pre><pre class="listLevel1" xml:space="preserve">          Group Members:  154438865287, 1238700701509</pre><pre class="listLevel1" xml:space="preserve">             Needs sync:  no</pre><pre class="listLevel1" xml:space="preserve">        Standby Members:  &lt;none&gt;</pre><pre class="listLevel1">&#160;</pre><pre class="listLevel1">&#160;</pre><pre class="listLevel1">Slot #    Member S/N                      Member Label    Status</pre><pre class="listLevel1">======    ==========                      ============    ======</pre><pre class="listLevel1" xml:space="preserve">     0  154438865287                              par0     alive</pre><pre class="listLevel1" xml:space="preserve">     1  1238700701509                             par1     alive</pre><pre class="listLevel1">&#160;</pre><pre class="listLevel1">&#160;</pre><pre class="listLevel1" xml:space="preserve">        Please use the command "ha synchronize" when you are ready</pre><pre class="listLevel1" xml:space="preserve">        to replicate data between all members of the HA group.</pre><pre class="listLevel1" xml:space="preserve">        (If you have additional members to add, you may wish to wait</pre><pre class="listLevel1" xml:space="preserve">        until you have added them before synchronizing to save time by</pre><pre class="listLevel1" xml:space="preserve">        avoiding multiple synchronizations.)</pre><pre class="listLevel1" xml:space="preserve">&#160;</pre><pre class="listLevel1" xml:space="preserve">Command Result : No Error</pre>
        <p class="listLevel1">Repeat this step for each additional HA group member. </p>
        <p class="ol1" data-mc-autonum="3."><span class="autonumber"><span class="ol1Number">3.</span></span>If you are adding member partitions that already have cryptographic objects stored on them, initiate a manual synchronization. You can tell whether this step is required by checking the line <b>Needs Sync : yes/no</b> in the HA group output. This will also confirm that the HA group is functioning correctly (<a href="../../lunacm/commands/hagroup/hagroup_synchronize.htm" class="MCTopicPopup MCTopicPopupHotSpot MCXref xref">hagroup synchronize</a>). </p>
        <p class="listLevel1">lunacm:&gt;<b>hagroup synchronize -group</b> &lt;grouplabel&gt;</p>
        <p class="ol1" data-mc-autonum="4."><span class="autonumber"><span class="ol1Number">4.</span></span>[Optional] If you created an HA group out of empty partitions, and you want to verify that the group is functioning correctly, see <a href="setup/verify_group.htm" class="MCXref xref">Verifying an HA Group</a>. </p>
        <p class="ol1" data-mc-autonum="5."><span class="autonumber"><span class="ol1Number">5.</span></span>Specify which member partitions, if any, will serve as standby members. </p>
        <p class="listLevel1">See <a href="setup/set_standby.htm" class="MCXref xref">Setting an HA Group Member to Standby</a>. </p>
        <p class="ol1" data-mc-autonum="6."><span class="autonumber"><span class="ol1Number">6.</span></span>Set up and configure auto-recovery (recommended). If you choose to use manual recovery, you will have to execute a recovery command whenever a group member fails. </p>
        <p class="listLevel1">See <a href="setup/autorecovery.htm" class="MCXref xref">Configuring HA Auto-Recovery</a>.</p>
        <p class="ol1" data-mc-autonum="7."><span class="autonumber"><span class="ol1Number">7.</span></span>[Optional] Enable HA Only mode (recommended). </p>
        <p class="listLevel1">See <a href="setup/haonly.htm" class="MCXref xref">Enabling/Disabling HA Only Mode</a>. </p>
        <p class="ol1" data-mc-autonum="8."><span class="autonumber"><span class="ol1Number">8.</span></span>[Optional] Configure HA logging. </p>
        <p class="listLevel1">See <a href="logging.htm" class="MCXref xref">HA Logging</a> for procedures and information on reading HA logs. </p>
        <p>The HA group is now ready for your application. </p>
        <p class="footer"><span class="DefaultProduct">SafeNet Luna Network HSM</span> <span class="DefaultRelease">7.2</span> <span class="DefaultProjectTitle">Product Documentation</span> <br /><span class="DefaultPartNumber">007-013576-004</span> <span class="DefaultRevision">Rev. C</span> <span style="color: #5e5e5c;"><![CDATA[  ]]></span> <span class="DefaultDateLong">06 May 2019</span> <span style="color: #5e5e5c;"><![CDATA[  ]]></span> <span class="DefaultCopyright">Copyright 2001-2019</span>&#160;<span class="DefaultCompanyNameLong">Gemalto</span> <span style="color: #5e5e5c;"><![CDATA[  ]]></span>All rights reserved. </p>
    </body>
</html>