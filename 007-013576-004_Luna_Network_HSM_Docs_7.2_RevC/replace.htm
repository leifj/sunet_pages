<!DOCTYPE html>
<html xmlns:MadCap="http://www.madcapsoftware.com/Schemas/MadCap.xsd" lang="en-us" xml:lang="en-us" data-mc-search-type="Stem" data-mc-help-system-file-name="index.xml" data-mc-path-to-help-system="../../../../" data-mc-target-type="WebHelp2" data-mc-runtime-file-type="Topic" data-mc-preload-images="false" data-mc-in-preview-mode="false" data-mc-medium="non-print" data-mc-toc-path="HSM Administration Guide|[%=System.LinkedTitle%]|[%=System.LinkedTitle%]">
    <head>
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <meta charset="utf-8" />
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <meta http-equiv="Content-Type" content="text/html; charset=utf-8" /><title>Replacing an HA Group Member</title>
        <link href="../../../../Skins/Default/Stylesheets/Slideshow.css" rel="stylesheet" />
        <link href="../../../../Skins/Default/Stylesheets/TextEffects.css" rel="stylesheet" />
        <link href="../../../../Skins/Default/Stylesheets/Topic.css" rel="stylesheet" />
        <link href="../../../../Skins/Default/Stylesheets/Components/Styles.css" rel="stylesheet" />
        <link href="../../../Resources/TableStyles/Breadcrumbs.css" rel="stylesheet" />
        <link href="../../../Resources/Stylesheets/Gemalto_Template.css" rel="stylesheet" />
        <script src="../../../../Resources/Scripts/custom.modernizr.js">
        </script>
        <script src="../../../../Resources/Scripts/jquery.min.js">
        </script>
        <script src="../../../../Resources/Scripts/require.min.js">
        </script>
        <script src="../../../../Resources/Scripts/require.config.js">
        </script>
        <script src="../../../../Resources/Scripts/foundation.min.js">
        </script>
        <script src="../../../../Resources/Scripts/plugins.min.js">
        </script>
        <script src="../../../../Resources/Scripts/MadCapAll.js">
        </script>
    </head>
    <body>
        <p class="MCWebHelpFramesetLink MCWebHelpFramesetLinkTop"><a href="../../../../index.html#administration/ha/manage/replace.htm">Show Navigation</a>
        </p>
        <!-- Remove this comment to enable syntax highlighting		
        <script type="text/javascript" src="../Stylesheets/SyntaxHilite/Prism/prism.js"></script>
-->
        <table style="width: 100%;border-spacing: 0px 0px;mc-table-style: url('../../../Resources/TableStyles/Breadcrumbs.css');border-left-style: none;border-left-width: 1px;border-left-color: #000000;border-right-style: none;border-right-width: 1px;border-right-color: #000000;border-top-style: none;border-top-width: 0px;border-top-color: #000000;border-bottom-style: none;border-bottom-width: 0px;" class="TableStyle-Breadcrumbs" cellspacing="0">
            <col style="width: 41px;" class="TableStyle-Breadcrumbs-Column-Column1" />
            <col class="TableStyle-Breadcrumbs-Column-Column1" />
            <tbody>
                <tr class="TableStyle-Breadcrumbs-Body-Body1">
                    <th class="TableStyle-Breadcrumbs-BodyB-Column1-Body1">
                        <p class="home" style="font-weight: normal;"><a href="../../../Home_network.htm">Home</a> &gt;
                        </p>
                    </th>
                    <th class="TableStyle-Breadcrumbs-BodyA-Column1-Body1">
                        <div class="nocontent">
                            <div class="MCBreadcrumbsBox_0 breadcrumbs" data-mc-breadcrumbs-divider=" &gt; " data-mc-breadcrumbs-count="3" data-mc-toc="True"><span class="MCBreadcrumbsPrefix">  <![CDATA[ ]]></span>
                            </div>
                        </div>
                    </th>
                </tr>
            </tbody>
        </table>
        <h2 data-mc-conditions="Default.ScreenOnly">Replacing an HA Group Member</h2>
        <p>Sometimes an HSM failure is permanent (from the perspective of the HA group). For example, if the HSM is re-initialized, the member partition is erased and must be recreated. In this case, you can recreate a partition on the same HSM or another HSM, and deploy the new member to the group. You do not need to pause your application to replace an HA group member. </p>
        <h4>Prerequisites</h4>
        <p>The Crypto Officer must complete this procedure, but any new member partition must first be created and assigned to the client by the HSM SO, and initialized by the Partition SO. All the prerequisites listed in <a href="../setup.htm" class="MCXref xref">Setting Up an HA Group</a> must be met. </p>
        <h5>To replace an HA group member</h5>
        <p class="ol1Start" data-mc-autonum="1."><span class="autonumber"><span class="ol1Number">1.</span></span>[Optional] Display the HA group to see the failed member (<a href="../../../lunacm/commands/hagroup/hagroup_listgroups.htm" class="MCTopicPopup MCTopicPopupHotSpot MCXref xref">hagroup listgroups</a>). You are prompted for the Crypto Officer password/challenge secret. </p>
        <p class="listLevel1">lunacm:&gt;<b>hagroup listgroups</b></p><pre class="listLevel1" xml:space="preserve">lunacm:&gt; hagroup listgroups</pre><pre class="listLevel1" xml:space="preserve">&#160;</pre><pre class="listLevel1" xml:space="preserve">        If you would like to see synchronization data for group myHAgroup,</pre><pre class="listLevel1" xml:space="preserve">        please enter the password for the group members. Sync info</pre><pre class="listLevel1" xml:space="preserve">        not available in HA Only mode.</pre><pre class="listLevel1">&#160;</pre><pre class="listLevel1">&#160;</pre><pre class="listLevel1" xml:space="preserve">        Enter the password: ********</pre><pre class="listLevel1">&#160;</pre><pre class="listLevel1">&#160;</pre><pre class="listLevel1" xml:space="preserve">              HA auto recovery:  enabled</pre><pre class="listLevel1" xml:space="preserve">              HA recovery mode:  activeEnhanced</pre><pre class="listLevel1" xml:space="preserve">   Maximum auto recovery retry:  500</pre><pre class="listLevel1" xml:space="preserve">   Auto recovery poll interval:  60 seconds</pre><pre class="listLevel1" xml:space="preserve">                    HA logging:  disabled</pre><pre class="listLevel1" xml:space="preserve">            Only Show HA Slots:  yes</pre><pre class="listLevel1">&#160;</pre><pre class="listLevel1">&#160;</pre><pre class="listLevel1" xml:space="preserve">         HA Group Label:  myHAgroup</pre><pre class="listLevel1" xml:space="preserve">        HA Group Number:  1154438865287</pre><pre class="listLevel1" xml:space="preserve">       HA Group Slot ID:  5</pre><pre class="listLevel1" xml:space="preserve">       Synchronization: enabled</pre><pre class="listLevel1" xml:space="preserve">          Group Members:  154438865287, 1238700701509</pre><pre class="listLevel1" xml:space="preserve">             Needs sync:  no</pre><pre class="listLevel1" xml:space="preserve">        Standby Members:  &lt;none&gt;</pre><pre class="listLevel1">&#160;</pre><pre class="listLevel1">&#160;</pre><pre class="listLevel1">Slot #    Member S/N                      Member Label    Status</pre><pre class="listLevel1">======    ==========                      ============    ======</pre><pre class="listLevel1">------  154438865287                              par0     alive</pre><pre class="listLevel1">------  1238700701509                      ------------      down</pre>
        <p class="ol1" data-mc-autonum="2."><span class="autonumber"><span class="ol1Number">2.</span></span>Prepare the new HA group member, whether that means creating a new partition on the original HSM or configuring a new <span class="DefaultProduct">SafeNet Luna Network HSM</span>, and assign the new partition to the HA client. Ensure that the new member partition and the HSM on which it resides meet the prerequisites outlined in <a href="../setup.htm" class="MCXref xref">Setting Up an HA Group</a> and is visible in LunaCM. </p><pre class="listLevel1" xml:space="preserve">lunacm (64-bit) v7.3.0-74. Copyright (c) 2018 SafeNet. All rights reserved.</pre><pre class="listLevel1" xml:space="preserve">&#160;</pre><pre class="listLevel1" xml:space="preserve">&#160;</pre><pre class="listLevel1" xml:space="preserve">        Available HSMs:</pre><pre class="listLevel1">&#160;</pre><pre class="listLevel1" xml:space="preserve">        Slot Id -&gt;              0</pre><pre class="listLevel1" xml:space="preserve">        Label -&gt;                par0</pre><pre class="listLevel1" xml:space="preserve">        Serial Number -&gt;        154438865287</pre><pre class="listLevel1" xml:space="preserve">        Model -&gt;                LunaSA 7.3.0</pre><pre class="listLevel1" xml:space="preserve">        Firmware Version -&gt;     7.3.0</pre><pre class="listLevel1" xml:space="preserve">        Configuration -&gt;        Luna User Partition With SO (PW) Key Export With Cloning Mode</pre><pre class="listLevel1" xml:space="preserve">        Slot Description -&gt;     Net Token Slot</pre><pre class="listLevel1" xml:space="preserve">&#160;</pre><pre class="listLevel1" xml:space="preserve">        Slot Id -&gt;              1</pre><pre class="listLevel1" xml:space="preserve">        Label -&gt;                par1</pre><pre class="listLevel1" xml:space="preserve">        Serial Number -&gt;        1238700701510</pre><pre class="listLevel1" xml:space="preserve">        Model -&gt;                LunaSA 7.3.0</pre><pre class="listLevel1" xml:space="preserve">        Firmware Version -&gt;     7.3.0</pre><pre class="listLevel1" xml:space="preserve">        Configuration -&gt;        Luna User Partition With SO (PW) Key Export With Cloning Mode</pre><pre class="listLevel1" xml:space="preserve">        Slot Description -&gt;     Net Token Slot</pre><pre class="listLevel1" xml:space="preserve">&#160;</pre><pre class="listLevel1" xml:space="preserve">        Slot Id -&gt;              5</pre><pre class="listLevel1" xml:space="preserve">        HSM Label -&gt;            myHAgroup</pre><pre class="listLevel1" xml:space="preserve">        HSM Serial Number -&gt;    1154438865287</pre><pre class="listLevel1" xml:space="preserve">        HSM Model -&gt;            LunaVirtual</pre><pre class="listLevel1" xml:space="preserve">        HSM Firmware Version -&gt; 7.3.0</pre><pre class="listLevel1" xml:space="preserve">        HSM Configuration -&gt;    Luna Virtual HSM (PW) Key Export With Cloning Mode</pre><pre class="listLevel1" xml:space="preserve">        HSM Status -&gt;           N/A - HA Group</pre><pre class="listLevel1" xml:space="preserve">&#160;</pre><pre class="listLevel1" xml:space="preserve">&#160;</pre><pre class="listLevel1" xml:space="preserve">Current Slot Id: 0</pre>
        <p class="ol1" data-mc-autonum="3."><span class="autonumber"><span class="ol1Number">3.</span></span>Add the new partition to the HA group by specifying either the slot or the serial number (<a href="../../../lunacm/commands/hagroup/hagroup_addmember.htm" class="MCTopicPopup MCTopicPopupHotSpot MCXref xref">hagroup addmember</a>). You are prompted for the Crypto Officer password/challenge secret. </p>
        <p class="listLevel1">lunacm:&gt; <b>hagroup addmember -group</b> &lt;label&gt; {<b>-slot</b> &lt;slotnum&gt; | <b>-serial</b> &lt;serialnum&gt;}</p><pre class="listLevel1" xml:space="preserve">lunacm:&gt; hagroup addmember -group myHAgroup -slot 1</pre><pre class="listLevel1" xml:space="preserve">&#160;</pre><pre class="listLevel1" xml:space="preserve">        Enter the password: ********</pre><pre class="listLevel1" xml:space="preserve">        Member 1238700701510 successfully added to group myHAgroup. New group</pre><pre class="listLevel1" xml:space="preserve">        configuration is:</pre><pre class="listLevel1">&#160;</pre><pre class="listLevel1" xml:space="preserve">         HA Group Label:  myHAgroup</pre><pre class="listLevel1" xml:space="preserve">        HA Group Number:  1154438865287</pre><pre class="listLevel1" xml:space="preserve">       HA Group Slot ID:  5</pre><pre class="listLevel1" xml:space="preserve">       Synchronization: enabled</pre><pre class="listLevel1" xml:space="preserve">          Group Members:  154438865287, 1238700701509, 1238700701510</pre><pre class="listLevel1" xml:space="preserve">             Needs sync:  no</pre><pre class="listLevel1" xml:space="preserve">        Standby Members:  &lt;none&gt;</pre><pre class="listLevel1">&#160;</pre><pre class="listLevel1">&#160;</pre><pre class="listLevel1">Slot #    Member S/N                      Member Label    Status</pre><pre class="listLevel1">======    ==========                      ============    ======</pre><pre class="listLevel1" xml:space="preserve">     0  154438865287                              par0     alive</pre><pre class="listLevel1">------  1238700701509                      ------------      down</pre><pre class="listLevel1" xml:space="preserve">     1  1238700701510                              par1     alive</pre><pre class="listLevel1">&#160;</pre><pre class="listLevel1">&#160;</pre><pre class="listLevel1" xml:space="preserve">        Please use the command "ha synchronize" when you are ready</pre><pre class="listLevel1" xml:space="preserve">        to replicate data between all members of the HA group.</pre><pre class="listLevel1" xml:space="preserve">        (If you have additional members to add, you may wish to wait</pre><pre class="listLevel1" xml:space="preserve">        until you have added them before synchronizing to save time by</pre><pre class="listLevel1" xml:space="preserve">        avoiding multiple synchronizations.)</pre><pre class="listLevel1" xml:space="preserve">&#160;</pre><pre class="listLevel1" xml:space="preserve">Command Result : No Error</pre>
        <p class="listLevel1">The new partition is now an active member of the HA group. If you have an application currently running, cryptographic objects are automatically replicated to the new member and it is assigned operations according to the load-balancing algorithm. </p>
        <p class="ol1" data-mc-autonum="4."><span class="autonumber"><span class="ol1Number">4.</span></span>Remove the old partition from the group by specifying the serial number (<a href="../../../lunacm/commands/hagroup/hagroup_removemember.htm" class="MCTopicPopup MCTopicPopupHotSpot MCXref xref">hagroup removemember</a>). </p>
        <p class="listLevel1">lunacm:&gt; <b>hagroup removemember -group</b> &lt;label&gt; <b>-serial</b> &lt;serialnum&gt;</p><pre class="listLevel1" xml:space="preserve">lunacm:&gt; hagroup removemember -group myHAgroup -serial 1238700701509</pre><pre class="listLevel1" xml:space="preserve">&#160;</pre><pre class="listLevel1" xml:space="preserve">        Member 1238700701509 successfully removed from group myHAgroup.</pre><pre class="listLevel1">&#160;</pre><pre class="listLevel1">Command Result : No Error</pre>
        <p class="listLevel1">LunaCM restarts.</p>
        <p class="ol1" data-mc-autonum="5."><span class="autonumber"><span class="ol1Number">5.</span></span>[Optional] If you do not currently have an application running, you can manually synchronize the contents of the HA group (<a href="../../../lunacm/commands/hagroup/hagroup_synchronize.htm" class="MCTopicPopup MCTopicPopupHotSpot MCXref xref">hagroup synchronize</a>). </p>
        <p class="caution" data-mc-autonum="&lt;span style=&quot;color: #6c286b;&quot; class=&quot;mcFormatColor&quot;&gt; &lt;b&gt;CAUTION!&lt;/b&gt; &#160;&#160;&lt;/span&gt;"><span class="autonumber"><span><span style="color: #6c286b;" class="mcFormatColor"> <b>CAUTION!</b> &#160;&#160;</span></span></span>Never use manual synchronization if you have an application running. The HA group performs this automatically. Using this command on an HA group that is running an application could create conflicting key versions. </p>
        <p class="listLevel1">lunacm:&gt;<b>hagroup synchronize -group</b> &lt;label&gt;</p><pre xml:space="preserve" class="listLevel1">lunacm:&gt; hagroup synchronize -group myHAgroup</pre><pre xml:space="preserve" class="listLevel1">&#160;</pre><pre xml:space="preserve" class="listLevel1">        Enter the password: ********</pre><pre class="listLevel1">&#160;</pre><pre xml:space="preserve" class="listLevel1">        Synchronization completed.</pre><pre class="listLevel1">&#160;</pre><pre xml:space="preserve" class="listLevel1">Command Result : No Error</pre>
        <p class="ol1" data-mc-autonum="6."><span class="autonumber"><span class="ol1Number">6.</span></span>[Optional] If you intend to have the new partition serve as a standby member, see <a href="../setup/set_standby.htm" class="MCXref xref">Setting an HA Group Member to Standby</a>. </p>
        <p class="footer"><span class="DefaultProduct">SafeNet Luna Network HSM</span> <span class="DefaultRelease">7.2</span> <span class="DefaultProjectTitle">Product Documentation</span> <br /><span class="DefaultPartNumber">007-013576-004</span> <span class="DefaultRevision">Rev. C</span> <span style="color: #5e5e5c;"><![CDATA[  ]]></span> <span class="DefaultDateLong">06 May 2019</span> <span style="color: #5e5e5c;"><![CDATA[  ]]></span> <span class="DefaultCopyright">Copyright 2001-2019</span>&#160;<span class="DefaultCompanyNameLong">Gemalto</span> <span style="color: #5e5e5c;"><![CDATA[  ]]></span>All rights reserved. </p>
    </body>
</html>