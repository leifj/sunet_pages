<!DOCTYPE html>
<html xmlns:MadCap="http://www.madcapsoftware.com/Schemas/MadCap.xsd" lang="en-us" xml:lang="en-us" data-mc-search-type="Stem" data-mc-help-system-file-name="index.xml" data-mc-path-to-help-system="../../../" data-mc-target-type="WebHelp2" data-mc-runtime-file-type="Topic" data-mc-preload-images="false" data-mc-in-preview-mode="false" data-mc-medium="non-print" data-mc-toc-path="SDK Reference Guide|Java Interfaces">
    <head>
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <meta charset="utf-8" />
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <meta http-equiv="Content-Type" content="text/html; charset=utf-8" /><title>SafeNet JSP&#160;Overview and Installation</title>
        <link href="../../../Skins/Default/Stylesheets/Slideshow.css" rel="stylesheet" />
        <link href="../../../Skins/Default/Stylesheets/TextEffects.css" rel="stylesheet" />
        <link href="../../../Skins/Default/Stylesheets/Topic.css" rel="stylesheet" />
        <link href="../../../Skins/Default/Stylesheets/Components/Styles.css" rel="stylesheet" />
        <link href="../../Resources/TableStyles/Breadcrumbs.css" rel="stylesheet" />
        <link href="../../Resources/Stylesheets/Gemalto_Template.css" rel="stylesheet" />
        <script src="../../../Resources/Scripts/custom.modernizr.js">
        </script>
        <script src="../../../Resources/Scripts/jquery.min.js">
        </script>
        <script src="../../../Resources/Scripts/require.min.js">
        </script>
        <script src="../../../Resources/Scripts/require.config.js">
        </script>
        <script src="../../../Resources/Scripts/foundation.min.js">
        </script>
        <script src="../../../Resources/Scripts/plugins.min.js">
        </script>
        <script src="../../../Resources/Scripts/MadCapAll.js">
        </script>
    </head>
    <body>
        <p class="MCWebHelpFramesetLink MCWebHelpFramesetLinkTop"><a href="../../../index.html#sdk/java/jsp_overview_install.htm">Show Navigation</a>
        </p>
        <!-- Remove this comment to enable syntax highlighting		
        <script type="text/javascript" src="../Stylesheets/SyntaxHilite/Prism/prism.js"></script>
-->
        <table style="width: 100%;border-spacing: 0px 0px;mc-table-style: url('../../Resources/TableStyles/Breadcrumbs.css');border-left-style: none;border-left-width: 1px;border-left-color: #000000;border-right-style: none;border-right-width: 1px;border-right-color: #000000;border-top-style: none;border-top-width: 0px;border-top-color: #000000;border-bottom-style: none;border-bottom-width: 0px;" class="TableStyle-Breadcrumbs" cellspacing="0">
            <col style="width: 41px;" class="TableStyle-Breadcrumbs-Column-Column1" />
            <col class="TableStyle-Breadcrumbs-Column-Column1" />
            <tbody>
                <tr class="TableStyle-Breadcrumbs-Body-Body1">
                    <th class="TableStyle-Breadcrumbs-BodyB-Column1-Body1">
                        <p class="home" style="font-weight: normal;"><a href="../../Home_network.htm">Home</a> &gt;
                        </p>
                    </th>
                    <th class="TableStyle-Breadcrumbs-BodyA-Column1-Body1">
                        <div class="nocontent">
                            <div class="MCBreadcrumbsBox_0 breadcrumbs" data-mc-breadcrumbs-divider=" &gt; " data-mc-breadcrumbs-count="3" data-mc-toc="True"><span class="MCBreadcrumbsPrefix"> </span>
                            </div>
                        </div>
                    </th>
                </tr>
            </tbody>
        </table>
        <h2><a name="kanchor284"></a>SafeNet JSP&#160;Overview and Installation</h2>
        <p><a name="kanchor285"></a>The SafeNet JSP is part of an application program interface (API) that 
 allows Java applications to make use of certain SafeNet products. </p>
        <p><a name="kanchor286"></a>As with other APIs, some existing Java-based applications might have generic 
requirements and calls that can already work with SafeNet products. In other 
 cases, it might be necessary for you or your vendor to create an application 
 or to adapt one, using the JSP API. </p>
        <p>You have the choice of:</p>
        <p class="ul1" data-mc-autonum="&lt;b&gt;&amp;gt;&lt;/b&gt;"><span class="autonumber"><span class="ul1Bullet"><b>&gt;</b></span></span>using a previously integrated 
third-party application, known to work with this SafeNet product</p>
        <p class="ul1" data-mc-autonum="&lt;b&gt;&amp;gt;&lt;/b&gt;"><span class="autonumber"><span class="ul1Bullet"><b>&gt;</b></span></span>performing your own integration 
with a Java-based application supplied by you or a third party, or </p>
        <p class="ul1" data-mc-autonum="&lt;b&gt;&amp;gt;&lt;/b&gt;"><span class="autonumber"><span class="ul1Bullet"><b>&gt;</b></span></span>developing your own application 
using our Java API.</p>
        <p>Develop your own Java apps using our included Software Development 
 Kit, which includes SafeNet Java API usage notes for developers, as well 
 as development support by SafeNet. A standard Java development environment 
 is required, in addition to the API provided by SafeNet.</p>
        <p>Please refer to the current-version <span class="DefaultProduct">SafeNet Luna Network HSM</span>&#160;Customer Release Notes (CRN) for the most up-to-date list of supported platforms and APIs.</p>
        <h3>JDK Compatibility</h3>
        <p>We formally test <span class="DefaultProduct">SafeNet Luna Network HSM</span>s and our Java provider with SUN JDK for all platforms except AIX, and with IBM JDK for the AIX platform. We have not had problems with OpenJDK, although it has not been part of our formal test suite. The SafeNet JCE provider is compliant with the JCE specification, and should work with any JVM that implements the Java language specification.</p>
        <p>Occasional problems have been encountered with respect to IBM JSSE.</p>
        <p>GNU JDK shipped with most Linux systems has historically been incomplete and not suitable.</p>
        <h3>Installation</h3>
        <p>To use the SafeNet JavaSP service providers four main components are needed.</p>
        <h4>Java SDK 7/8/9</h4>
        <p>First, acquire and install 
the Java SDK or RTE (available from the Java site, not included with the SafeNet software). Java must be installed before the SafeNet software, as some 
 of the Java files must be manipulated as described in the JSP portions 
of the Getting Started section of this Help. Note 
that the JVM 7, JVM 8, or JVM 9 is part of the Java SDK. &#160;</p>
        <h4>Java Cryptographic JCE Policy files (optional)</h4>
        <p>If you intend to generate 
 large key sizes, you will need two cryptographic JCE Policy files v 7/8/9 (available from the Java web site).&#160;The Getting Started section of this Help has instructions on what to do with 
 the two files (local_policy.jar and US_export_policy.jar). </p>
        <p>If you see errors like "Invalid Key size", that is usually an indication that the JCE is not properly installed.</p>
        <h4 data-mc-conditions="Default.CV_Exclude">SafeNet Luna HSM Client</h4>
        <p data-mc-conditions="Default.CV_Exclude">Follow the installation 
procedure for the SafeNet Luna HSM Client as described in the <i>Installation Guide</i>.</p>
        <h4>SafeNet JavaSP</h4>
        <p>When installing the SafeNet Luna Client software, also choose the option to install SafeNet JSP. Instructions 
 are provided in the platform-specific pages, including instructions for 
 installing SafeNet JSP for each operating system (files to copy/replace, 
 editing to perform, etc.) so that <span class="DefaultProduct">SafeNet Luna Network HSM</span> and SafeNet JSP can work with the 
 JRE.</p>
        <p class="note" data-mc-autonum="&lt;span style=&quot;color: #6c286b;&quot; class=&quot;mcFormatColor&quot;&gt; &lt;b&gt;NOTE&lt;/b&gt; &#160;&#160;&lt;/span&gt;"><span class="autonumber"><span><span style="color: #6c286b;" class="mcFormatColor"> <b>NOTE</b> &#160;&#160;</span></span></span><b>Java Provider (JSP)</b> - both GMC and GMAC are supported. "GmacAesDemo.java" provides a sample for using GMAC with Java. <br /><br />Java Parameter Specification class LunaGmacParameterSpec.java defines default values recommended by the NIST specification.</p>
        <h4>Notes about thread safe, session safe, and multi-threading</h4>
        <p>PKCS#11 (the standard, and Gemalto's implementation) requires that a session can be used only by a single thread at a time.  That is, multiple threads cannot access the same session simultaneously. Threads can share a session; however the application must ensure that only one thread accesses the session at a time.  It is simpler for an application to assign a unique session for each thread, but applications do not need to follow that pattern.</p>
        <p>Our LunaProvider endeavors to be thread safe in the way it uses our PKCS#11 library.  But customer Java applications must follow the threading model defined by Java.  For example, Java Cipher objects ( essentially all crypto-related objects) are not thread safe according to the JSP specification.  Similar to PKCS#11 sessions, only one thread should use a cipher object at a time.  Our LunaProvider requires that the Java application follows that JSP approach.</p>
        <p>Therefore, it is very possible, and expected, to see sessions being used by multiple threads, all in legitimate and thread-safe ways according to both JSP and PKCS#11.</p>
        <h3>Post-Installation Tasks</h3>
        <h4>Extractable Private and Secret Keys</h4>
        <p>By default, all generated private and secret keys have their CKA_EXTRACTABLE attribute set to <b>0</b> (see <a href="../design/attribute_defaults.htm" class="MCXref xref">Key Attribute Defaults</a>). These keys are stored in the HSM hardware and cannot be extracted, only cloned to a partition on another HSM. This attribute cannot be modified later. If you want the ability to wrap private and/or secret keys and export them off the HSM, you must use one of the following two methods to set CKA_EXTRACTABLE to <b>1</b> (TRUE) when the key is created:</p>
        <h5>Global configuration:</h5>
        <p>Configure <b>java.security</b> as follows to have JSP create all future private/secret keys with CKA_EXTRACTABLE=1:</p>
        <p class="ul1" data-mc-autonum="&lt;b&gt;&amp;gt;&lt;/b&gt;"><span class="autonumber"><span class="ul1Bullet"><b>&gt;</b></span></span>To make all private keys extractable, add the following line to <b>java.security</b>:</p>
        <p class="listLevel1" style="font-weight: bold;">com.safenetinc.luna.provider.createExtractablePrivateKeys=true</p>
        <p class="ul1" data-mc-autonum="&lt;b&gt;&amp;gt;&lt;/b&gt;"><span class="autonumber"><span class="ul1Bullet"><b>&gt;</b></span></span>To make all secret keys extractable, add the following line to <b>java.security</b>:</p>
        <p class="listLevel1" style="font-weight: bold;">com.safenetinc.luna.provider.createExtractableSecretKeys=true</p>
        <h5>Local configuration:</h5>
        <p>Configure CKA_EXTRACTABLE on a key-by-key basis by using the following methods in your Java application:</p>
        <p class="ul1" data-mc-autonum="&lt;b&gt;&amp;gt;&lt;/b&gt;"><span class="autonumber"><span class="ul1Bullet"><b>&gt;</b></span></span>To make the next generated private key extractable using the <b>LunaSlotManager.setPrivateKeysExtractable()</b> method:</p><pre xml:space="preserve" class="listLevel1">LunaSlotManager.getInstance().setPrivateKeysExtractable(true); // Set CKA_EXTRACTABLE=1 on upcoming private keys</pre><pre xml:space="preserve" class="listLevel1">kpg = KeyPairGenerator.getInstance("RSA", "LunaProvider");</pre><pre xml:space="preserve" class="listLevel1">kpg.initialize(2048);</pre><pre xml:space="preserve" class="listLevel1">myPair = kpg.generateKeyPair();</pre><pre xml:space="preserve" class="listLevel1">LunaSlotManager.getInstance().setPrivateKeysExtractable(false); // Set CKA_EXTRACTABLE=0 on upcoming private keys</pre>
        <p class="note" data-mc-autonum="&lt;span style=&quot;color: #6c286b;&quot; class=&quot;mcFormatColor&quot;&gt; &lt;b&gt;NOTE&lt;/b&gt; &#160;&#160;&lt;/span&gt;"><span class="autonumber"><span><span style="color: #6c286b;" class="mcFormatColor"> <b>NOTE</b> &#160;&#160;</span></span></span>To wrap and export private keys, the partition must have partition policy 1: Allow private key wrapping set to 1 (ON). See <a href="../../administration/CKE/cloning_key_export.htm" class="MCXref xref">Keys In Hardware vs. Private Key Export</a> in the <i>Administration Guide</i>. </p>
        <p class="ul1" data-mc-autonum="&lt;b&gt;&amp;gt;&lt;/b&gt;"><span class="autonumber"><span class="ul1Bullet"><b>&gt;</b></span></span>To make the next generated secret key extractable using the <b>LunaSlotManager.setSecretKeysExtractable()</b> method:</p><pre xml:space="preserve" class="listLevel1">LunaSlotManager.getInstance().setSecretKeysExtractable(true); // Set CKA_EXTRACTABLE=1 on upcoming secret keys</pre><pre xml:space="preserve" class="listLevel1">kg = KeyGenerator.getInstance("AES");</pre><pre xml:space="preserve" class="listLevel1">kg.init(256);</pre><pre xml:space="preserve" class="listLevel1">aesKey = kg.generateKey();</pre><pre xml:space="preserve" class="listLevel1">LunaSlotManager.getInstance().setPrivateKeysExtractable(false); // Set CKA_EXTRACTABLE=0 on upcoming secret keys</pre>
        <h4>Using SafeNet JCE/JCA with 64-bit Libraries</h4>
        <p>If you are using SafeNet JCE/JCA with the 64-bit libraries for <span class="DefaultProduct">SafeNet Luna Network HSM</span>, 
 you must include the "-d64" switch in the Java command-line.</p>
        <p>For example: java -d64 -jar jMultitoken.jar</p>
        <p>For most 64-bit platforms, 64-bit is supported. Some 64-bit 
 platforms support the option of running in 32-bit mode), as a backward compatibility feature.</p>
        <p>If you use the 64-bit installation and do not use the "- d64" 
 command-line switch in your Java command lines, the system attempts (by 
 default) to use the 32-bit library (which is not installed, because you installed 64-bit in this example...), and the result 
 is an error message complaining about the kernel model.</p>
        <h4>Using ECC Keys for TLS&#160;with Java 7 </h4>
        <p>For optimal Java performance when using Elliptic Curve keys to perform TLS with Java 7, where those keys reside in the HSM,  you must configure the SunEC security provider (sun.security.ec.SunEC) to be below the LunaProvider in your java.security file.</p>
        <p>We suggest that you not attempt to resolve a performance issue by having the LunaProvider as the default because that would result in the symmetric keys also being used in the HSM which is not optimal for performance.</p>
        <h4>A Security Note for Java Developers</h4>
        <p>The SafeNet JSP is a Java API that is intended to be used as an interface between customer-written or third-party Java applications and the <span class="DefaultProduct">SafeNet Luna Network HSM</span>.  Managing security issues associated with the overall operational environment in which the application is running, including the user interface, is the responsibility of the application.  </p>
        <p>A common example would be input and capture of user name and password.  The application, or a set of organizational procedures, is responsible for making the access control decision regarding whether the user has the necessary permissions (at the organizational level) to access the HSM's services and then must provide protection for the password as it is entered, and erasure from memory after the operation is completed.  The SafeNet JSP will control access to the HSM based on the correct password being input from the application via the Login method, but security outside the HSM&#160;is your responsibility.  </p>
        <h4>Non-standard ECDSA</h4>
        <p>The SafeNet provider maps the "ECDSA" signature algorithm to "NONEwithECDSA". The Java convention is to map it to "SHA1withECDSA". This is noted here in case you wish to use it in provider inter-operability testing. This mapping is noted in the Javadoc as well.</p>
        <p>For comparison, "RSA" maps to "NONEwithRSA" while "DSA" maps to "SHA1withDSA". </p>
        <p class="footer"><span class="DefaultProduct">SafeNet Luna Network HSM</span> <span class="DefaultRelease">7.2</span> <span class="DefaultProjectTitle">Product Documentation</span> <br /><span class="DefaultPartNumber">007-013576-004</span> <span class="DefaultRevision">Rev. C</span> <span style="color: #5e5e5c;"><![CDATA[  ]]></span> <span class="DefaultDateLong">06 May 2019</span> <span style="color: #5e5e5c;"><![CDATA[  ]]></span> <span class="DefaultCopyright">Copyright 2001-2019</span>&#160;<span class="DefaultCompanyNameLong">Gemalto</span> <span style="color: #5e5e5c;"><![CDATA[  ]]></span>All rights reserved. </p>
    </body>
</html>