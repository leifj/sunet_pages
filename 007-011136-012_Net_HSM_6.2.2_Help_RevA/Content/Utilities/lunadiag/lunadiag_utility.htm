<!DOCTYPE html>
<html xmlns:MadCap="http://www.madcapsoftware.com/Schemas/MadCap.xsd" lang="en-us" xml:lang="en-us" data-mc-search-type="Stem" data-mc-help-system-file-name="index.xml" data-mc-path-to-help-system="../../../" data-mc-target-type="WebHelp2" data-mc-runtime-file-type="Topic" data-mc-preload-images="false" data-mc-in-preview-mode="false" data-mc-medium="non-print" data-mc-toc-path="Utilities Reference Guide|Lunadiag">
    <head>
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <meta charset="utf-8" />
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <meta http-equiv="Content-Type" content="text/html; charset=utf-8" /><title>Lunadiag Utility</title>
        <link href="../../../Skins/Default/Stylesheets/Slideshow.css" rel="stylesheet" data-mc-generated="True" />
        <link href="../../../Skins/Default/Stylesheets/TextEffects.css" rel="stylesheet" data-mc-generated="True" />
        <link href="../../../Skins/Default/Stylesheets/Topic.css" rel="stylesheet" data-mc-generated="True" />
        <link href="../../../Skins/Default/Stylesheets/Components/Styles.css" rel="stylesheet" data-mc-generated="True" />
        <link href="../../Resources/TableStyles/Breadcrumbs.css" rel="stylesheet" />
        <link href="../../Resources/Stylesheets/Gemalto_Template_Enterprise.css" rel="stylesheet" />
        <script src="../../../Resources/Scripts/custom.modernizr.js">
        </script>
        <script src="../../../Resources/Scripts/jquery.min.js">
        </script>
        <script src="../../../Resources/Scripts/require.min.js">
        </script>
        <script src="../../../Resources/Scripts/require.config.js">
        </script>
        <script src="../../../Resources/Scripts/foundation.min.js">
        </script>
        <script src="../../../Resources/Scripts/plugins.min.js">
        </script>
        <script src="../../../Resources/Scripts/MadCapAll.js">
        </script>
    </head>
    <body>
        <table style="width: 100%;border-spacing: 0px 0px;mc-table-style: url('../../Resources/TableStyles/Breadcrumbs.css');border-left-style: none;border-left-width: 1px;border-left-color: #000000;border-right-style: none;border-right-width: 1px;border-right-color: #000000;border-top-style: none;border-top-width: 0px;border-top-color: #000000;border-bottom-style: solid;border-bottom-width: 2px;border-bottom-color: #e6e6e6;" class="TableStyle-Breadcrumbs" cellspacing="0">
            <col style="width: 41px;" class="TableStyle-Breadcrumbs-Column-Column1" />
            <col class="TableStyle-Breadcrumbs-Column-Column1" />
            <tbody>
                <tr class="TableStyle-Breadcrumbs-Body-Body1">
                    <th class="TableStyle-Breadcrumbs-BodyB-Column1-Body1">
                        <p class="home" style="font-weight: normal;"><a href="../../Home_sa.htm">Home</a> &gt;
                        </p>
                    </th>
                    <th class="TableStyle-Breadcrumbs-BodyA-Column1-Body1">
                        <div class="MCBreadcrumbsBox_0"><span class="MCBreadcrumbsPrefix">  <![CDATA[ ]]></span><span class="MCBreadcrumbsSelf">Utilities Reference Guide</span><span class="MCBreadcrumbsDivider"> &gt; </span><a class="MCBreadcrumbsLink" href="lunadiag.htm">Lunadiag</a><span class="MCBreadcrumbsDivider"> &gt; </span><span class="MCBreadcrumbs">Lunadiag Utility</span>
                        </div>
                    </th>
                </tr>
            </tbody>
        </table>
        <h2>Lunadiag Utility</h2>
        <p>Lunadiag is a diagnostic tool for SafeNet card products. In general, 
 you may never need to use it, other than to confirm a successful SafeNet installation. If you experience problems with a SafeNet product and need 
 to contact Customer Support, you may be asked to perform additional tests 
 with Lunadiag, as part of the troubleshooting process. In that circumstance, 
 the support representative will instruct you. Several menu items are self-explanatory. 
 The more obscure items are of interest only to Technical Support in very 
 specific circumstances.</p>
        <p>However, if you are an application developer, you may wish to use Lunadiag 
 during your software-development. You have the option to run Lunadiag 
 from the command line of a console window. From the command line, the 
 syntax for  Lunadiag is:</p>
        <p class="code">&#160;&#160;lunadiag 
 &#160;[-s=num] 
 &#160;[-o=num] 
 &#160;[-c=num] 
 &lt;[options]&gt;</p>
        <p>Where </p>
        <p><span style="font-family: 'Courier New', monospace;">-s=num</span> &#160;&#160;&#160;&#160;Number 
 of slots to test at once. &#160;</p>
        <p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;(Range: 
 1.. N; default: 1  where N is the number of slots available to the client)</p>
        <p><span style="font-family: 'Courier New', monospace;">-o=num</span> &#160;&#160;&#160;&#160;Offset 
 into slots to begin testing </p>
        <p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;(Range: 0.. N-1; default: 0)</p>
        <p><span style="font-family: 'Courier New', monospace;">-c=num</span> &#160;&#160;&#160;&#160;Command 
 to run (Range: 1..16)</p>
        <p>for example, <span style="font-family: 'Courier New', monospace;">lunadiag 
 -s=1 -o=1 -c=11</span></p>
        <p>The spaces are required. The following additional options can be executed, 
 and exit immediately without user prompt.</p>
        <p><span style="font-family: 'Courier New', monospace;">-CHRYSTOKI</span> 
 &#160;&#160;Perform 
 the Chrystoki Library configuration test.</p>
        <p><span style="font-family: 'Courier New', monospace;">-DUALPORT</span> 
 &#160;&#160;&#160;&#160;Dump 
 dualport.</p>
        <p><span style="font-family: 'Courier New', monospace;">-FIPS</span> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;Test 
 for FIPS setting for one token. &#160;</p>
        <p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;Exit 
 code 1 implies FIPS enabled.</p>
        <h3>Using Lunadiag &#160;</h3>
        <p>Run lunadiag with no arguments, to get a list of slots that it can see.</p><pre xml:space="preserve">C:\Program Files\SafeNet\LunaClient&gt;lunadiag
lunadiag  version 8.0  Date: Feb 13 2015 Time: 14:21:44
Detecting Luna devices ...
Detection complete.

Slots available:
        Slot #0 - Present     - LunaNet Slot
        Slot #1 - Present     - LunaNet Slot
        Slot #2 - Present     - LunaNet Slot
        Slot #3 - Present     - Viper PCI Card
        Slot #4 - Not present - Luna UHD Tunnel Slot
        Slot #5 - Present     - Luna UHD Slot
        Slot #6 - Not present - Luna UHD Slot
        Slot #7 - Not present - Luna UHD Slot
Enter slot to test:
</pre>
        <p>&#160;</p>
        <p>In the slot list, above, slots 0, 1, and 2 are listed as "LunaNet Slot", and correspond to SafeNet Network HSM application partitions that are registered with this client/host. </p>
        <p>Slot 3, "Viper PCI Card", is a locally contained SafeNet PCIe HSM physical slot. While LunaCM shows a separate HSM administrative slot and application partition slot (if HSM firmware is version 6.22.0 or newer), lunadiag shows a single physical slot.</p>
        <p>Similarly, Slot 5, "Present - Luna UHD Slot",  is a SafeNet USB HSM physical slot. </p>
        <p>Slot 4 "Not present - Luna UHD Tunnel Slot", is reserved for a USB HSM Device (UHD) like a SafeNet Backup HSM that could be directly connected to the SafeNet PCIe HSM card.</p>
        <p>The slots listed as "Not Present - Luna UHD Slot" are placeholders for other possible devices that could be USB-connected, but currently are not.</p>
        <p>Lunadiag displays a menu of commands, once you have selected a slot  to work on.</p><pre xml:space="preserve">C:\Program Files\SafeNet\LunaClient&gt;lunadiag
lunadiag  version 8.0  Date: Feb 13 2015 Time: 14:21:44
Detecting Luna devices ...
Detection complete.

Slots available:
        Slot #0 - Present     - LunaNet Slot
        Slot #1 - Present     - LunaNet Slot
        Slot #2 - Present     - LunaNet Slot
        Slot #3 - Present     - Viper PCI Card
        Slot #4 - Not present - Luna UHD Tunnel Slot
        Slot #5 - Present     - Luna UHD Slot
        Slot #6 - Not present - Luna UHD Slot
        Slot #7 - Not present - Luna UHD Slot
Enter slot to test:
</pre>
        <p>&#160;</p>
        <p>In order to see the lunadiag menu of commands, first select a slot on which to act:</p><pre xml:space="preserve">Enter slot to test: 0

----------------------------------------
lunadiag  version 8.0  Date: Feb 13 2015 Time: 14:21:44

                Main Menu

           1   Select slot to test
           2   Driver Test
           3   Communication Test
           4   Read Firmware Level
           5   Read Protocol Level
           6   Read Capabilities
           7   Read Token Policies
           8   Read TSV
           9   Read Dualport
          10   Read Dualport Command
          11   Token Info Test
          12   Mechanism Info Test
          16   Read Debug/Trace Information

           0   Exit
----------------------------------------
</pre>
        <p>&#160;</p>
        <p>Command 9 is a complete dual-port dump of a SafeNet PCIe HSM, which includes any debug/trace information at the end. This command does not work for SafeNet USB HSM because that HSM is not built around dual-port architecture. </p>
        <p>Command 10 attempts to present information from the current command. </p>
        <p>Command 16 provides just the debug/trace information for either a SafeNet USB HSM or a SafeNet PCIe HSM. For SafeNet PCIe HSM, this is a much more compact output than is available from command 9. For SafeNet USB HSM, this is all the information available, since there is no dual-port to expose. </p>
        <p>The "missing" commands, 13, 14, and 15 appear only in special circumstances. The example that might have some general relevance is where Microsoft IIS is in use, and settings "AppIdMajor=1" and "AppIdMinor=42" are present in the Crystoki.ini file; this causes menu item 15 to appear. Generally, if a menu number does not appear, you do not need it. If in doubt, contact Technical Support.</p>
        <p>
            <br />
        </p>
        <h3>Verify Successful Installation</h3>
        <p>If you can run tests </p><pre xml:space="preserve">&#160;2  Driver Test 
&#160;3  Communication Test</pre>
        <p>and</p><pre xml:space="preserve">&#160;4  Read Firmware Level
</pre>
        <p>successfully (if they do not return error messages) then the installation 
 was successful.</p>
        <p>If there is a problem, check the connections to your HSM.</p>
        <p>If there is still a problem, remove and re-install the SafeNet HSM Client software.</p>
        <p>If problems persist, contact SafeNet/Gemalto Technical Support.</p>
        <p class="footer"><span class="DefaultProduct">SafeNet Network HSM</span> <span class="DefaultRelease">6.2.2</span> <span class="DefaultProjectTitle">Product Documentation</span> <br /><span class="DefaultPartNumber">007-011136-012</span> <span class="DefaultRevision">Rev. A</span> <span style="color: #5e5e5c;"><![CDATA[  ]]></span> <span class="DefaultDateLong">01 December 2016</span> <span style="color: #5e5e5c;"><![CDATA[  ]]></span> <span class="DefaultCopyright">Copyright 2001-2016</span>&#160;<span class="DefaultCompanyNameLong">Gemalto</span> <span style="color: #5e5e5c;"><![CDATA[  ]]></span>All rights reserved. </p>
    </body>
</html>