<!DOCTYPE html>
<html xmlns:MadCap="http://www.madcapsoftware.com/Schemas/MadCap.xsd" lang="en-us" xml:lang="en-us" data-mc-search-type="Stem" data-mc-help-system-file-name="index.xml" data-mc-path-to-help-system="../../../" data-mc-target-type="WebHelp2" data-mc-runtime-file-type="Topic" data-mc-preload-images="false" data-mc-in-preview-mode="false" data-mc-medium="non-print" data-mc-toc-path="Appliance Administration Guide|Timestamping – NTP and Time Drift">
    <head>
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <meta charset="utf-8" />
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <meta http-equiv="Content-Type" content="text/html; charset=utf-8" /><title>Example Using Secure NTP</title>
        <link href="../../../Skins/Default/Stylesheets/Slideshow.css" rel="stylesheet" data-mc-generated="True" />
        <link href="../../../Skins/Default/Stylesheets/TextEffects.css" rel="stylesheet" data-mc-generated="True" />
        <link href="../../../Skins/Default/Stylesheets/Topic.css" rel="stylesheet" data-mc-generated="True" />
        <link href="../../../Skins/Default/Stylesheets/Components/Styles.css" rel="stylesheet" data-mc-generated="True" />
        <link href="../../Resources/TableStyles/Breadcrumbs.css" rel="stylesheet" />
        <link href="../../Resources/Stylesheets/Gemalto_Template_Enterprise.css" rel="stylesheet" />
        <script src="../../../Resources/Scripts/custom.modernizr.js">
        </script>
        <script src="../../../Resources/Scripts/jquery.min.js">
        </script>
        <script src="../../../Resources/Scripts/require.min.js">
        </script>
        <script src="../../../Resources/Scripts/require.config.js">
        </script>
        <script src="../../../Resources/Scripts/foundation.min.js">
        </script>
        <script src="../../../Resources/Scripts/plugins.min.js">
        </script>
        <script src="../../../Resources/Scripts/MadCapAll.js">
        </script>
    </head>
    <body>
        <table style="width: 100%;border-spacing: 0px 0px;mc-table-style: url('../../Resources/TableStyles/Breadcrumbs.css');border-left-style: none;border-left-width: 1px;border-left-color: #000000;border-right-style: none;border-right-width: 1px;border-right-color: #000000;border-top-style: none;border-top-width: 0px;border-top-color: #000000;border-bottom-style: solid;border-bottom-width: 2px;border-bottom-color: #e6e6e6;" class="TableStyle-Breadcrumbs" cellspacing="0">
            <col style="width: 41px;" class="TableStyle-Breadcrumbs-Column-Column1" />
            <col class="TableStyle-Breadcrumbs-Column-Column1" />
            <tbody>
                <tr class="TableStyle-Breadcrumbs-Body-Body1">
                    <th class="TableStyle-Breadcrumbs-BodyB-Column1-Body1">
                        <p class="home" style="font-weight: normal;"><a href="../../Home_sa.htm">Home</a> &gt;
                        </p>
                    </th>
                    <th class="TableStyle-Breadcrumbs-BodyA-Column1-Body1">
                        <div class="MCBreadcrumbsBox_0"><span class="MCBreadcrumbsPrefix">  <![CDATA[ ]]></span><span class="MCBreadcrumbsSelf">Appliance Administration Guide</span><span class="MCBreadcrumbsDivider"> &gt; </span><a class="MCBreadcrumbsLink" href="ntp_time.htm">Timestamping – NTP and Time Drift</a><span class="MCBreadcrumbsDivider"> &gt; </span><span class="MCBreadcrumbs">Example Using Secure NTP</span>
                        </div>
                    </th>
                </tr>
            </tbody>
        </table>
        <h2>Example Using Secure NTP</h2>
        <p>We suggest that you use secure NTP (as opposed to the non-secure standard variety) for your SafeNet Network HSM. Secure NTP can be mixed with regular/simple NTP. For this example, any simple NTP will be removed for now:</p><pre xml:space="preserve">[kuso] lunash:&gt;sysc ntp list</pre><pre xml:space="preserve">=================================================================</pre><pre xml:space="preserve">NTP Servers:</pre><pre xml:space="preserve">server 127.127.1.0</pre><pre xml:space="preserve">server ntp.cpsc.ucalgary.ca</pre><pre xml:space="preserve">=================================================================</pre><pre xml:space="preserve">Command Result : 0 (Success)</pre><pre xml:space="preserve">[kuso] lunash:&gt;sysc ntp delete ntp.cpsc.ucalgary.ca</pre><pre xml:space="preserve">NTP server ntp.cpsc.ucalgary.ca deleted</pre><pre xml:space="preserve">NTP is enabled</pre><pre xml:space="preserve">Shutting down ntpd:                                        [  OK  ]</pre><pre xml:space="preserve">Starting ntpd:                                             [  OK  ]</pre><pre xml:space="preserve">Please wait to see the result ......</pre><pre xml:space="preserve">NTP is running</pre><pre xml:space="preserve">===========================================================</pre><pre xml:space="preserve">NTP Associations Status:</pre><pre xml:space="preserve">ind assID status  conf reach auth condition  last_event cnt</pre><pre xml:space="preserve">===========================================================</pre><pre xml:space="preserve">1  7095  9014   yes   yes  none    reject   reachable  1</pre><pre xml:space="preserve">===========================================================</pre><pre xml:space="preserve">Please look at the ntp log to see any potential problem.</pre><pre xml:space="preserve">Command Result : 0 (Success)</pre><pre xml:space="preserve">[kuso] lunash:&gt;</pre>
        <p>&#160;</p>
        <p>Obtain an identity scheme  from the secure NTP server (IFF, GQ or MV key). Check with the site of the server for the particulars. For this example, an IFF key is used. It must be scp’d to the SafeNet Network HSM server and installed:</p><pre xml:space="preserve">[kuso] lunash:&gt;sysconf ntp  autokeyAuth install -idscheme IFF -keyfile ntpkey_IFFkey_tor1-jprobe.upn.local.3436099994</pre><pre xml:space="preserve">------- Installing Imported Identity Scheme File -------</pre><pre xml:space="preserve">Configured Autokey IFF Identity Scheme.</pre><pre xml:space="preserve">You must restart NTP for the changes to take effect.</pre><pre xml:space="preserve">Check NTP status after restarting it to make sure that the client is able to start and sync with the server.</pre><pre xml:space="preserve">Command Result : 0 (Success)</pre><pre xml:space="preserve">[kuso] lunash:&gt;</pre>
        <p>&#160;</p>
        <p>As instructed, restart NTP:</p><pre xml:space="preserve">[kuso] lunash:&gt;service restart ntp</pre><pre xml:space="preserve">Shutting down ntp:                                         [  OK  ]</pre><pre xml:space="preserve">Starting ntp:                                              [  OK  ]</pre><pre xml:space="preserve">Command Result : 0 (Success)</pre><pre xml:space="preserve">[kuso] lunash:&gt;</pre>
        <p>&#160;</p>
        <p>The Secure NTP used for this example uses the default parameters, so only the password is specified:</p><pre xml:space="preserve">[kuso] lunash:&gt;sysconf ntp autokeyAuth generate -p myPas$w0rd!</pre><pre xml:space="preserve">Generate new keys and certificates using ntp-keygen</pre><pre xml:space="preserve">Using OpenSSL version 9070df</pre><pre xml:space="preserve">Random seed file /root/.rnd 1024 bytes</pre><pre xml:space="preserve">Generating RSA keys (512 bits)...</pre><pre xml:space="preserve">RSA 0 1 5       1 11 24                         3 1 2</pre><pre xml:space="preserve">Generating new host file and link</pre><pre xml:space="preserve">ntpkey_host_kuso-&gt;ntpkey_RSAkey_kuso.3437830225</pre><pre xml:space="preserve">Using host key as sign key</pre><pre xml:space="preserve">Generating certificate RSA-MD5</pre><pre xml:space="preserve">X509v3 Basic Constraints: critical,CA:TRUE</pre><pre xml:space="preserve">X509v3 Key Usage: digitalSignature,keyCertSign</pre><pre xml:space="preserve">Generating new cert file and link</pre><pre xml:space="preserve">ntpkey_cert_kuso-&gt;ntpkey_RSA-MD5cert_kuso.3437830225</pre><pre xml:space="preserve">ntp-keygen Result: 0</pre><pre xml:space="preserve">You must restart NTP for the changes to take effect.</pre><pre xml:space="preserve">Check NTP status after restarting it to make sure that the client is able to start and sync with the server.</pre><pre xml:space="preserve">Command Result : 0 (Success)</pre><pre xml:space="preserve">[kuso] lunash:&gt;</pre>
        <p>&#160;</p>
        <p>As instructed, restart NTP at this time:</p><pre xml:space="preserve">kuso] lunash:&gt;service restart ntp</pre><pre xml:space="preserve">Shutting down ntp:                                         [  OK  ]</pre><pre xml:space="preserve">Starting ntp:                                              [  OK  ]</pre><pre xml:space="preserve">Command Result : 0 (Success)</pre><pre xml:space="preserve">[kuso] lunash:&gt;</pre>
        <p>&#160;</p>
        <p>Check the status of NTP. Like standard NTP, this may take a few minutes for a proper synchronization to occur:</p><pre xml:space="preserve">[kuso] lunash:&gt;sysconf ntp status</pre><pre xml:space="preserve">NTP is running</pre><pre xml:space="preserve">NTP is enabled</pre><pre xml:space="preserve">Peers:</pre><pre xml:space="preserve">==============================================================================</pre><pre xml:space="preserve">remote           refid      st t when poll reach   delay   offset  jitter</pre><pre xml:space="preserve">==============================================================================</pre><pre xml:space="preserve">LOCAL(0)        .LOCL.          10 l    6   64   77    0.000    0.000   0.001<br />*tor1-jprobe.upn 206.248.171.198  2 u   59   64    3    0.341  -554.47   3.309</pre><pre xml:space="preserve">==============================================================================</pre><pre xml:space="preserve">Associations:</pre><pre xml:space="preserve">==============================================================================</pre><pre xml:space="preserve">ind assID status  conf reach auth condition  last_event cnt</pre><pre xml:space="preserve">===========================================================</pre><pre xml:space="preserve">1 56812  9614   yes   yes  ok  sys.peer   sys_peer  1<br />2  5725  f63a   yes   yes   ok   sys.peer    sys_peer  3</pre><pre xml:space="preserve">==============================================================================</pre><pre xml:space="preserve">NTP Time:</pre><pre xml:space="preserve">==============================================================================</pre><pre xml:space="preserve">ntp_gettime() returns code 0 (OK)</pre><pre xml:space="preserve">time cce922c5.76cdb000  Tue, Dec  9 2008 12:00:53.464, (.464076),</pre><pre xml:space="preserve">maximum error 452335 us, estimated error 0 us</pre><pre xml:space="preserve">ntp_adjtime() returns code 0 (OK)</pre><pre xml:space="preserve">modes 0x0 (),</pre><pre xml:space="preserve">offset 0.000 us, frequency 0.000 ppm, interval 4 s,</pre><pre xml:space="preserve">maximum error 452335 us, estimated error 0 us,</pre><pre xml:space="preserve">status 0x1 (PLL),</pre><pre xml:space="preserve">time constant 2, precision 1.000 us, tolerance 512 ppm,</pre><pre xml:space="preserve">==============================================================================</pre><pre xml:space="preserve">Command Result : 0 (Success)</pre><pre xml:space="preserve">[kuso] lunash:&gt;</pre>
        <p class="footer"><span class="DefaultProduct">SafeNet Network HSM</span> <span class="DefaultRelease">6.2.2</span> <span class="DefaultProjectTitle">Product Documentation</span> <br /><span class="DefaultPartNumber">007-011136-012</span> <span class="DefaultRevision">Rev. A</span> <span style="color: #5e5e5c;"><![CDATA[  ]]></span> <span class="DefaultDateLong">01 December 2016</span> <span style="color: #5e5e5c;"><![CDATA[  ]]></span> <span class="DefaultCopyright">Copyright 2001-2016</span>&#160;<span class="DefaultCompanyNameLong">Gemalto</span> <span style="color: #5e5e5c;"><![CDATA[  ]]></span>All rights reserved. </p>
    </body>
</html>