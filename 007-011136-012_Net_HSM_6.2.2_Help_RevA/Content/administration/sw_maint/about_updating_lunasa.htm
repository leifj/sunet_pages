<!DOCTYPE html>
<html xmlns:MadCap="http://www.madcapsoftware.com/Schemas/MadCap.xsd" lang="en-us" xml:lang="en-us" data-mc-search-type="Stem" data-mc-help-system-file-name="index.xml" data-mc-path-to-help-system="../../../" data-mc-target-type="WebHelp2" data-mc-runtime-file-type="Topic" data-mc-preload-images="false" data-mc-in-preview-mode="false" data-mc-medium="non-print" data-mc-toc-path="Administration Guide|Software Updates and Maintenance">
    <head>
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <meta charset="utf-8" />
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <meta http-equiv="Content-Type" content="text/html; charset=utf-8" /><title>About Updating SafeNet Network HSM</title>
        <link href="../../../Skins/Default/Stylesheets/Slideshow.css" rel="stylesheet" data-mc-generated="True" />
        <link href="../../../Skins/Default/Stylesheets/TextEffects.css" rel="stylesheet" data-mc-generated="True" />
        <link href="../../../Skins/Default/Stylesheets/Topic.css" rel="stylesheet" data-mc-generated="True" />
        <link href="../../../Skins/Default/Stylesheets/Components/Styles.css" rel="stylesheet" data-mc-generated="True" />
        <link href="../../Resources/TableStyles/List1.css" rel="stylesheet" />
        <link href="../../Resources/TableStyles/Breadcrumbs.css" rel="stylesheet" />
        <link href="../../Resources/Stylesheets/Gemalto_Template_Enterprise.css" rel="stylesheet" />
        <script src="../../../Resources/Scripts/custom.modernizr.js">
        </script>
        <script src="../../../Resources/Scripts/jquery.min.js">
        </script>
        <script src="../../../Resources/Scripts/require.min.js">
        </script>
        <script src="../../../Resources/Scripts/require.config.js">
        </script>
        <script src="../../../Resources/Scripts/foundation.min.js">
        </script>
        <script src="../../../Resources/Scripts/plugins.min.js">
        </script>
        <script src="../../../Resources/Scripts/MadCapAll.js">
        </script>
    </head>
    <body>
        <table style="width: 100%;border-spacing: 0px 0px;mc-table-style: url('../../Resources/TableStyles/Breadcrumbs.css');border-left-style: none;border-left-width: 1px;border-left-color: #000000;border-right-style: none;border-right-width: 1px;border-right-color: #000000;border-top-style: none;border-top-width: 0px;border-top-color: #000000;border-bottom-style: solid;border-bottom-width: 2px;border-bottom-color: #e6e6e6;" class="TableStyle-Breadcrumbs" cellspacing="0">
            <col style="width: 41px;" class="TableStyle-Breadcrumbs-Column-Column1" />
            <col class="TableStyle-Breadcrumbs-Column-Column1" />
            <tbody>
                <tr class="TableStyle-Breadcrumbs-Body-Body1">
                    <th class="TableStyle-Breadcrumbs-BodyB-Column1-Body1">
                        <p class="home" style="font-weight: normal;"><a href="../../Home_sa.htm">Home</a> &gt;
                        </p>
                    </th>
                    <th class="TableStyle-Breadcrumbs-BodyA-Column1-Body1">
                        <div class="MCBreadcrumbsBox_0"><span class="MCBreadcrumbsPrefix"> </span><span class="MCBreadcrumbsSelf">Administration Guide</span><span class="MCBreadcrumbsDivider"> &gt; </span><a class="MCBreadcrumbsLink" href="sw_maint.htm">Software Updates and Maintenance</a><span class="MCBreadcrumbsDivider"> &gt; </span><span class="MCBreadcrumbs">About Updating SafeNet Enterprise HSM</span>
                        </div>
                    </th>
                </tr>
            </tbody>
        </table>
        <h2><a name="kanchor162"></a><a name="kanchor163"></a><a name="kanchor164"></a>About Updating SafeNet Network HSM</h2>
        <p>Your SafeNet Network HSM system consists of components that might, from time to time, 
 require updating to newer versions. The newer version might have fixes 
 or functional improvements that are useful or important for your application. 
 The components that might be affected are:</p>
        <p class="ul1" data-mc-autonum="&lt;b&gt;•&lt;/b&gt;"><span class="autonumber"><span class="ul1Bullet"><b>•</b></span></span>Client software</p>
        <p class="ul1" data-mc-autonum="&lt;b&gt;•&lt;/b&gt;"><span class="autonumber"><span class="ul1Bullet"><b>•</b></span></span>SafeNet Network HSM system software (the lunash command-line 
 shell and its underlying software)</p>
        <p class="ul1" data-mc-autonum="&lt;b&gt;•&lt;/b&gt;"><span class="autonumber"><span class="ul1Bullet"><b>•</b></span></span>SafeNet Network HSM keycard firmware</p>
        <p class="ul1" data-mc-autonum="&lt;b&gt;•&lt;/b&gt;"><span class="autonumber"><span class="ul1Bullet"><b>•</b></span></span>SafeNet Backup HSM firmware</p>
        <h3><a name="kanchor165"></a>How Firmware 
 Updates Affect Agency Validation</h3>
        <p>In the case of FIPS 140, cryptographic devices are evaluated as a combination of hardware and firmware. Therefore, if either of those elements changes, the device is no longer covered by the current validation certificate. If you require that equipment used in your application be (for example) FIPS 140-2 level 3 validated, you can use the most recent of our relevant HSM products that has been validated - which applies to a specific hardware and firmware combination. If we release a newer version of firmware, your own security or compliance policies would not permit you to install that update until we have submitted the updated HSM for [re-] evaluation, and a new validation certificate has been issued.</p>
        <p>
&#160;As a general rule (exceptions are possible) we submit HSMs with new firmware versions. If the changes are small or do not affect areas that concern the FIPS evaluators, then the re-evaluation is performed on a delta basis and therefore occurs relatively quickly. For a completely new product or major revision, the evaluators require a complete re-submission and the process takes roughly a year from submission to certificate. Therefore, when a FIPS-candidate firmware version exists, our practice is to ship the respective HSM product with the most recent FIPS-validated firmware version installed, and with the candidate version as a standby update file (on the appliance, ready to install, but not yet installed).  This ensures that customers who require validated systems continue to get them, and that customers who do not require validated systems are able to easily and quickly apply the update if they choose to do so. &#160;</p>
        <p>The obvious trade-off is that customers who elect to remain with the as-shipped installed firmware version are maintaining the FIPS compliance at the cost of any upgraded capabilities or any security or functional fixes that are part of the firmware update. 
Similarly, customers who choose to perform the update benefit from the improved  capabilities and any security or functional fixes, but at the cost of moving out of FIPS compliance.</p>
        <h3>Updating the Client Software</h3>
        <p>To update the software on a Client, you simply remove the older version 
 and Install the newer, using the same procedure (for your operating system) 
 that you used for the original software installation. That applies to 
 SafeNet Network HSM Client software itself, as well as to the SDK material. </p>
        <p>As an example, the Client uninstall, when invoked on Windows, removes libraries, utilities and other material related to the client, but does not remove configuration files and certificates. This allows you to install the newer version and be able to resume operation without need to manually restore configuration settings and without need to recreate, re-exchange, and re-register client and appliance certificates for NTL. </p>
        <h3>Updating the Appliance Software</h3>
        <p class="note" data-mc-autonum="&lt;b&gt;Note:&lt;/b&gt; &#160;"><span class="autonumber"><span><b>Note:</b> &#160;</span></span>Appliance software upgrade is a one-way operation. There is currently no way to downgrade the appliance software once a new version is applied. This contrasts with the SafeNet HSM client software, which can be replaced with any version by uninstalling the current version and installing a desired version, and the SafeNet HSM firmware, which can be rolled back to the version that was installed before the currently-installed version (applies only to versions since firmware rollback was enabled). &#160;</p>
        <h5>To update the system software</h5>
        <p><a name="kanchor166"></a>To update system software and firmware, you must move the updates, in 
 the form of update package files, to SafeNet Network HSM and apply them. Updates 
 are accompanied by instructions that provide detailed update 
 instructions for each component. System and firmware updates require an 
 authentication code, which is provided in a text file accompanying the update package.</p>
        <p class="ol1Start" data-mc-autonum="1."><span class="autonumber"><span class="ol1Number">1.</span></span>Copy the SafeNet Network HSM 6.x.y-z Appliance package file from the ftp directory to the SafeNet Network HSM, as follows:. &#160;<br /> <span class="code">scp \&lt;path&gt;\lunasa_update-6.x.y-z.spkg admin@&lt;LunaSAhostname&gt;:</span> <br />where x.y-z is the version and build number &#160;&#160;<br />(in Windows, use the supplied PSCP utility). </p>
        <p class="ol1" data-mc-autonum="2."><span class="autonumber"><span class="ol1Number">2.</span></span>Stop all client applications connected to the SafeNet Network HSM appliance. &#160;</p>
        <p class="ol1" data-mc-autonum="3."><span class="autonumber"><span class="ol1Number">3.</span></span>At the shell prompt, log in to the SafeNet Network HSM appliance as admin. &#160;</p>
        <p class="ol1" data-mc-autonum="4."><span class="autonumber"><span class="ol1Number">4.</span></span>Log in to the SafeNet Network HSM as HSM Admin or SO. &#160;<br />Use <span class="code">lunash:&gt;hsm login</span> <br />For SafeNet Network HSM with PED Authentication, the blue PED Key is required. &#160;<br />For SafeNet Network HSM with Password Authentication, you are prompted for the HSM Admin (SO) password. &#160;</p>
        <p class="ol1" data-mc-autonum="5."><span class="autonumber"><span class="ol1Number">5.</span></span>[Optional Step] Verify that the file that you copied is present on the SafeNet Network HSM &#160;<br /> <span class="code">lunash:&gt;package listfile</span> <![CDATA[ ]]></p>
        <p class="ol1" data-mc-autonum="6."><span class="autonumber"><span class="ol1Number">6.</span></span> [Optional Step] Verify the package on the SafeNet Network HSM &#160;<br /> <span class="code">lunash:&gt;package verify lunasa_update-6.x.y-z.spkg -authcode ################</span> <br />where "################" is the authorization code from the file lunasa_update-6x.y-z.auth. &#160;<br />The verification process requires approximately one and a half minutes. &#160;</p>
        <p class="ol1" data-mc-autonum="7."><span class="autonumber"><span class="ol1Number">7.</span></span>Install the software upgrade package on SafeNet Network HSM &#160;<br />&#160;&#160;&#160;<span class="code">lunash:&gt;package update lunasa_update-6.x.y-z.spkg.spkg -authcode  ############### </span>&#160;<br />where "################" is the authorization code from the file lunasa_update-6.x.y-z.auth. &#160;<br />The installation/update process requires approximately one and a half minutes. During that time, a series of messages shows the progress of the update. &#160;</p>
        <p class="ol1" data-mc-autonum="8."><span class="autonumber"><span class="ol1Number">8.</span></span>At the end of this process, a message “Software update completed!” appears. The software version is now 6.x.y-z. If the software update also included a firmware update, then the firmware 6.v.w package is now on the appliance, waiting to be installed in the HSM.<br />Perform a reboot of the SafeNet Network HSM appliance before you update the firmware. &#160;<br /> <span class="code">lunash:&gt; sysconf appliance reboot</span> <br /></p>
        <h5>To update your HSM firmware to 6.v.w.</h5>
        <p>  &#160;In general, a new SafeNet Network HSM is delivered with the current FIPS- validated firmware installed on the internal HSM card, and with the most recent firmware version (typically in the process of being FIPS validated) included - waiting, but not yet installed - on the SafeNet Network HSM hard drive as an optional update.  Similarly, when you install a software update package that includes a firmware component, the software is changed and the accompanying new firmware goes into the waiting area on the appliance hard disk, replacing any previous optional firmware. </p>
        <p>Regardless of whether the optional firmware update is one that was originally loaded (as an option) or one that was supplied later with a software update (as an option), it is always a separate step if you wish to install that waiting (optional) firmware into the HSM. </p>
        <p class="warning_note">It is strongly recommended that your Luna SA be connected 
 to an uninterruptible power supply (UPS) when you perform a firmware update. There 
 is a small chance that a power failure during the update command could 
 leave your Luna SA in an unrecoverable condition.</p>
        <p class="caution_note">For PED-authenticated Luna HSMs,  ensure that the SRK (the use of the purple PED Key)&#160;is disabled (bring the external portion of the MTK&#160;back into the HSM) before you begin the firmware update operation. This requires that you present the currently valid purple PED Key when you issue the <b>hsm srk disable</b> command. &#160;If you run <b>hsm update firmware</b> while SRK is enabled (a portion of the MTK is outside the HSM, on a purple PED&#160;Key) you can expect an error like:</p><pre xml:space="preserve"><span class="code">Error:  'hsm update firmware' failed. (10A0B : LUNA_RET_OPERATION_RESTRICTED)</span></pre><pre xml:space="preserve"> <br /></pre>
        <p class="caution_note">If you have had SRK enabled and a valid purple PED Key, you can always perform <b>hsm srk enable</b> again after the firmware update operation, and resume with a new external secure recovery vector (SRV)&#160;imprinted onto a new purple PED Key (SRK). </p>
        <p class="note" data-mc-autonum="&lt;b&gt;Note:&lt;/b&gt; &#160;"><span class="autonumber"><span><b>Note:</b> &#160;</span></span>On a multi-partition HSM, when updating from older firmware to version 6.22.0 firmware or later, you might need to re-size partitions. This is due to infrastructure that supports the Per-Partition SO (PPSO) capability, which imposes increased overhead for each partition. For additional information, see <a href="../partitions/partition_creation.htm#Sizes_of_Partitions_" class="MCXref xref">Sizes of Partitions &#160;</a>.</p>
        <p class="ol1Start" data-mc-autonum="1."><span class="autonumber"><span class="ol1Number">1.</span></span>Log in to the HSM with: &#160;<br />&#160;&#160;<span class="code">lunash:&gt; hsm login</span> <![CDATA[ ]]></p>
        <p class="ol1" data-mc-autonum="2."><span class="autonumber"><span class="ol1Number">2.</span></span>Run the firmware update command: &#160;<br /> <span class="code">lunash:&gt; hsm firmware upgrade</span></p>
        <p class="ol1" data-mc-autonum="3."><span class="autonumber"><span class="ol1Number">3.</span></span>Log in to the HSM with: &#160;<br /> <span class="code">lunash:&gt; hsm login</span> <![CDATA[ ]]></p>
        <p class="ol1" data-mc-autonum="4."><span class="autonumber"><span class="ol1Number">4.</span></span>Verify that the change has taken place (should show version 6.v.w): &#160;<br /> <span class="code">lunash:&gt; hsm show</span> <![CDATA[ ]]></p>
        <p class="notepad_note">A capability update or a firmware update is meant to be applied just one time to an HSM. If you attempt to re-apply a capability update to an HSM that already has the capability installed, the system throws an error like " C0000002 : RC_GENERAL_ERROR ". A similar result occurs if you attempt to install a particular firmware update more than once on one HSM. This is expected behavior.</p>
        <p>For information and instructions regarding purchased Capability Updates, see <a href="luna_hsm_capability_upgrades.htm" class="MCXref xref">Applying SafeNet HSM Capability Upgrades</a>.</p>
        <h3>Standalone Firmware Update</h3>
        <p>On occasion you might need to update HSM firmware on a standalone basis - that is, where the activity is not part of appliance software update. The process is similar, except that the package transferred to the SafeNet Network HSM appliance is just a wrapper around the firmware update, and does not contain other appliance software. This can occur when you are performing evaluations and might be testing several firmware versions, or when, for whatever reason, the firmware version that you wish to install is not currently the standby firmware version on the appliance, in which case SafeNet supplies a standalone firmware update secure package .</p>
        <p class="note" data-mc-autonum="&lt;b&gt;Note:&lt;/b&gt; &#160;"><span class="autonumber"><span><b>Note:</b> &#160;</span></span>If the Secure Recovery Key (SRK) on the HSM is enabled, it must be disabled before you can upgrade the HSM firmware. The SRK is an external split of the HSM's Master Tamper Key (MTK) that is imprinted on the purple PED key. When you disable the SRK, the SRV (Secure Recovery Vector) portion of the MTK is returned to the HSM, so that the SRV is no longer external to the HSM. It is only in this state that you can upgrade the HSM firmware. After you upgrade the firmware, you can re-enable SRK, if desired, to re-imprint a purple PED key with the SRV.</p>
        <p class="note" data-mc-autonum="&lt;b&gt;Note:&lt;/b&gt; &#160;"><span class="autonumber"><span><b>Note:</b> &#160;</span></span>If you intend to re-size partitions, or to perform a firmware update (example, from pre-6.22.0 to version 6.22.0 or newer) that alters the available space in partitions, be sure to backup the contents of your HSM first. It might be required to remove some objects from partitions that are at-or-near capacity. They can be restored after all re-sizing and new-partition creation has finished. </p>
        <h5>To perform a standalone firmware update</h5>
        <p class="ol1Start" data-mc-autonum="1."><span class="autonumber"><span class="ol1Number">1.</span></span>Obtain the firmware update secure package from SafeNet. Use scp/pscp to upload the package to the SafeNet Network HSM appliance.  &#160;</p>
        <table style="width: 97%;mc-table-style: url('../../Resources/TableStyles/List1.css');" class="TableStyle-List1" cellspacing="0">
            <col class="Column-Column1" />
            <col class="Column-Column1" />
            <tbody>
                <tr class="Body-Body1">
                    <td class="BodyE-Column1-Body1" style="font-weight: bold;">Linux/UNIX</td>
                    <td class="BodyD-Column1-Body1">scp /&lt;path&gt;/&lt;packagename&gt;.spkg admin@&lt;LunaSAhostname&gt;: &#160;</td>
                </tr>
                <tr class="Body-Body1">
                    <td class="BodyB-Column1-Body1" style="font-weight: bold;">Windows</td>
                    <td class="BodyA-Column1-Body1">pscp \&lt;path&gt;\&lt;packagename&gt;.spkg admin@&lt;LunaSAhostname&gt;:</td>
                </tr>
            </tbody>
        </table>
        <p class="ol1" data-mc-autonum="2."><span class="autonumber"><span class="ol1Number">2.</span></span>Stop all client applications connected to the SafeNet Network HSM appliance. &#160;</p>
        <p class="ol1" data-mc-autonum="3."><span class="autonumber"><span class="ol1Number">3.</span></span>At the shell prompt, log in to the SafeNet Network HSM appliance as admin. &#160;</p>
        <p class="ol1" data-mc-autonum="4."><span class="autonumber"><span class="ol1Number">4.</span></span>Log in to the SafeNet Network HSM as HSM Admin or SO. &#160;<br />Use <span class="code">lunash:&gt;hsm login</span><br />For SafeNet Network HSM with PED Authentication, the blue PED Key is required. &#160;<br />For SafeNet Network HSM with Password Authentication, you are prompted for the HSM Admin (SO) password. &#160;</p>
        <p class="ol1" data-mc-autonum="5."><span class="autonumber"><span class="ol1Number">5.</span></span>[Optional Step] Verify that the file that you copied is present on the SafeNet Network HSM &#160;<br /><span class="code">lunash:&gt;package listfile</span> <![CDATA[ ]]></p>
        <p class="ol1" data-mc-autonum="6."><span class="autonumber"><span class="ol1Number">6.</span></span> [Optional Step] Verify the package on the SafeNet Network HSM &#160;<br /><span class="code">lunash:&gt;package verify &lt;packagename&gt;.spkg -authcode ################</span><br />where "################" is the authorization code from the file &lt;packagename&gt;.auth. &#160;<br /></p>
        <p class="ol1" data-mc-autonum="7."><span class="autonumber"><span class="ol1Number">7.</span></span>Install the firmware upgrade secure package on SafeNet Network HSM &#160;<br />&#160;&#160;&#160;<span class="code">lunash:&gt;package update &lt;packagename&gt;.spkg.spkg -authcode  ############### </span>&#160;<br />where "################" is the authorization code from the file &lt;packagename&gt;.auth. &#160;<br />The package update process completes in seconds. &#160;The firmware  package is now on the appliance, waiting to be installed in the HSM. &#160;&#160;</p>
        <p class="note" data-mc-autonum="&lt;b&gt;Note:&lt;/b&gt; &#160;"><span class="autonumber"><span><b>Note:</b> &#160;</span></span>It is strongly recommended that your SafeNet HSM be powered from an uninterruptible power supply (UPS) when you perform the firmware update. </p>
        <p class="ol1" data-mc-autonum="8."><span class="autonumber"><span class="ol1Number">8.</span></span>Run the firmware update command: &#160;<br /><span class="code">lunash:&gt; hsm firmware upgrade</span></p>
        <p class="ol1" data-mc-autonum="9."><span class="autonumber"><span class="ol1Number">9.</span></span>Log in to the HSM with: &#160;<br /><span class="code">lunash:&gt; hsm login</span> <![CDATA[ ]]></p>
        <p class="ol1" data-mc-autonum="10."><span class="autonumber"><span class="ol1Number">10.</span></span>Verify that the change has taken place (should show the desired target version ): &#160;<br /><span class="code">lunash:&gt; hsm show</span> <![CDATA[ ]]></p>
        <h3>Service Provider Ability to Update/Patch Appliance Software</h3>
        <p>Previously, updating or applying a patch to SafeNet HSM appliance software required that you log into the HSM as SO, in order to validate the upgrade package for installation. In the Service Provider context, you might be the owner and manager of an HSM appliance, but you have given control of the HSM to your customer, who is renting the HSM as a service and who probably changed the HSM credentials. </p>
        <p>Beginning with release 6.2.1, the <b>package update</b> lunash command interface is updated to include the <b>-useevp</b> option. This allows you to specify use of OpenSSL EVP (Digital EnVeloPe library) API to validate the update package, rather than invoking the HSM to do so (which would require HSM SO login).</p>
        <p>This change allows you to perform appliance-side management tasks without encroaching on the autonomy and security of your HSM-as-a-service customers. See revised command syntax at <a href="../../lunash/commands/package/package_update.htm#package" class="MCXref xref">package update</a>. &#160;<span style="color: #ffffff;">&#160;https://jirahsm.safenet-inc.com:8443/browse/SPCD-5</span> &#160;&#160;</p>
        <p>
            <br />
        </p>
        <p class="footer"><span class="DefaultProduct">SafeNet Network HSM</span> <span class="DefaultRelease">6.2.2</span> <span class="DefaultProjectTitle">Product Documentation</span> <br /><span class="DefaultPartNumber">007-011136-012</span> <span class="DefaultRevision">Rev. A</span> <span style="color: #5e5e5c;"><![CDATA[  ]]></span> <span class="DefaultDateLong">01 December 2016</span> <span style="color: #5e5e5c;"><![CDATA[  ]]></span> <span class="DefaultCopyright">Copyright 2001-2016</span>&#160;<span class="DefaultCompanyNameLong">Gemalto</span> <span style="color: #5e5e5c;"><![CDATA[  ]]></span>All rights reserved. </p>
    </body>
</html>