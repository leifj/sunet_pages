<!DOCTYPE html>
<html xmlns:MadCap="http://www.madcapsoftware.com/Schemas/MadCap.xsd" lang="en-us" xml:lang="en-us" data-mc-search-type="Stem" data-mc-help-system-file-name="index.xml" data-mc-path-to-help-system="../../../" data-mc-target-type="WebHelp2" data-mc-runtime-file-type="Topic" data-mc-preload-images="false" data-mc-in-preview-mode="false" data-mc-medium="non-print" data-mc-toc-path="Administration Guide|Audit Logging">
    <head>
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <meta charset="utf-8" />
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <meta http-equiv="Content-Type" content="text/html; charset=utf-8" /><title>Audit Logging Overview</title>
        <link href="../../../Skins/Default/Stylesheets/Slideshow.css" rel="stylesheet" data-mc-generated="True" />
        <link href="../../../Skins/Default/Stylesheets/TextEffects.css" rel="stylesheet" data-mc-generated="True" />
        <link href="../../../Skins/Default/Stylesheets/Topic.css" rel="stylesheet" data-mc-generated="True" />
        <link href="../../../Skins/Default/Stylesheets/Components/Styles.css" rel="stylesheet" data-mc-generated="True" />
        <link href="../../Resources/TableStyles/Page.css" rel="stylesheet" />
        <link href="../../Resources/TableStyles/Breadcrumbs.css" rel="stylesheet" />
        <link href="../../Resources/Stylesheets/Gemalto_Template_Enterprise.css" rel="stylesheet" />
        <script src="../../../Resources/Scripts/custom.modernizr.js">
        </script>
        <script src="../../../Resources/Scripts/jquery.min.js">
        </script>
        <script src="../../../Resources/Scripts/require.min.js">
        </script>
        <script src="../../../Resources/Scripts/require.config.js">
        </script>
        <script src="../../../Resources/Scripts/foundation.min.js">
        </script>
        <script src="../../../Resources/Scripts/plugins.min.js">
        </script>
        <script src="../../../Resources/Scripts/MadCapAll.js">
        </script>
    </head>
    <body>
        <table style="width: 100%;border-spacing: 0px 0px;mc-table-style: url('../../Resources/TableStyles/Breadcrumbs.css');border-left-style: none;border-left-width: 1px;border-left-color: #000000;border-right-style: none;border-right-width: 1px;border-right-color: #000000;border-top-style: none;border-top-width: 0px;border-top-color: #000000;border-bottom-style: solid;border-bottom-width: 2px;border-bottom-color: #e6e6e6;" class="TableStyle-Breadcrumbs" cellspacing="0">
            <col style="width: 41px;" class="TableStyle-Breadcrumbs-Column-Column1" />
            <col class="TableStyle-Breadcrumbs-Column-Column1" />
            <tbody>
                <tr class="TableStyle-Breadcrumbs-Body-Body1">
                    <th class="TableStyle-Breadcrumbs-BodyB-Column1-Body1">
                        <p class="home" style="font-weight: normal;"><a href="../../Home_sa.htm">Home</a> &gt;
                        </p>
                    </th>
                    <th class="TableStyle-Breadcrumbs-BodyA-Column1-Body1">
                        <div class="MCBreadcrumbsBox_0"><span class="MCBreadcrumbsPrefix">  <![CDATA[ ]]></span><span class="MCBreadcrumbsSelf">Administration Guide</span><span class="MCBreadcrumbsDivider"> &gt; </span><a class="MCBreadcrumbsLink" href="audit.htm">Audit Logging</a><span class="MCBreadcrumbsDivider"> &gt; </span><span class="MCBreadcrumbs">Audit Logging Overview</span>
                        </div>
                    </th>
                </tr>
            </tbody>
        </table>
        <h2>Audit Logging Overview</h2>
        <p>The HSM can log its events with varying levels of verbosity (like critical events only, failures, failures and successes, key usage, all). By default, only critical events are logged, which imposes virtually no load on the HSM.</p>
        <p>In addition, you have the option to create the Audit user on the HSM and specify that log entries are secured for writing off the HSM. As above, the level/frequency of that logging can be specified by setting the logging threshold.</p>
        <p>Or, you can just specify that entries are written to the SafeNet Network Appliance file system without verification security. </p>
        <p>Beginning with release 5.2, SafeNet HSMs consolidate and enhance auditing of HSM operations in the Standard Audit Logging feature. </p>
        <p class="ul1" data-mc-autonum="&lt;b&gt;•&lt;/b&gt;"><span class="autonumber"><span class="ul1Bullet"><b>•</b></span></span>This method is the most secure and verifiable, to satisfy the strictest auditing requirements. </p>
        <p class="ul1" data-mc-autonum="&lt;b&gt;•&lt;/b&gt;"><span class="autonumber"><span class="ul1Bullet"><b>•</b></span></span>This method places the highest Audit-related load on the HSM. </p>
        <p>Beginning with release 6.2.1 in general release (and 5.3.10 in limited release), SafeNet Network HSM offers direct-to-file, or appliance-side logging of HSM activity. </p>
        <p class="ul1" data-mc-autonum="&lt;b&gt;•&lt;/b&gt;"><span class="autonumber"><span class="ul1Bullet"><b>•</b></span></span>This method preserves the HSM activity audit records and offloads them to the file system for further processing or off-board storage, without securing or validating the resulting records or files.</p>
        <p class="ul1" data-mc-autonum="&lt;b&gt;•&lt;/b&gt;"><span class="autonumber"><span class="ul1Bullet"><b>•</b></span></span>This method imposes substantially less processing load on the HSM, compared with the fully secured logging method (above). </p>
        <p>The audit logging feature works only with hardware and software update levels at, or newer than, the versions that introduced the feature:</p>
        <h5>Hardware</h5>
        <p class="ul1" data-mc-autonum="&lt;b&gt;•&lt;/b&gt;" data-mc-conditions="Default.SA"><span class="autonumber"><span class="ul1Bullet"><b>•</b></span></span>SafeNet Network HSM 5.x (or newer) appliance</p>
        <h5>Software &#160;&#160;</h5>
        <p class="ul1" data-mc-autonum="&lt;b&gt;•&lt;/b&gt;"><span class="autonumber"><span class="ul1Bullet"><b>•</b></span></span>Client Software 5.2.0 or newer &#160;&#160;</p>
        <p class="ul1" data-mc-autonum="&lt;b&gt;•&lt;/b&gt;"><span class="autonumber"><span class="ul1Bullet"><b>•</b></span></span>HSM Firmware 6.10.x or newer &#160;&#160;</p>
        <p class="ul1" data-mc-autonum="&lt;b&gt;•&lt;/b&gt;"><span class="autonumber"><span class="ul1Bullet"><b>•</b></span></span>SafeNet&#160;PED 2.5.0-2 or newer (if PED-authenticated HSM) &#160;&#160;</p>
        <h3 data-mc-conditions="Default.SA">Two "audit" entities on SafeNet Network HSM</h3>
        <p data-mc-conditions="Default.SA">The audit logging function is controlled by two roles on SafeNet Network HSM, that must be used together : </p>
        <p class="ul1" data-mc-autonum="&lt;b&gt;•&lt;/b&gt;" data-mc-conditions="Default.SA"><span class="autonumber"><span class="ul1Bullet"><b>•</b></span></span>the "audit" appliance account (use ssh or PuTTy to log in as "audit", instead of "admin", or "operator", or "monitor", etc.) &#160;</p>
        <p class="ul1" data-mc-autonum="&lt;b&gt;•&lt;/b&gt;" data-mc-conditions="Default.SA"><span class="autonumber"><span class="ul1Bullet"><b>•</b></span></span>the "audit" HSM account (accessible only if you have logged into the appliance as "audit"; this account must be initialized) &#160;</p>
        <p data-mc-conditions="Default.SA">On SafeNet Network HSM, the audit logging is managed by an audit user (an appliance system role), in combination with the HSM audit role, through a set of <span class="code">lunash:&gt;</span> commands. The audit user can perform only the audit-logging related tasks and self-related tasks. Other HSM appliance users, such as admin, operator, and monitor, have no access to the audit logging commands.</p>
        <p data-mc-conditions="Default.SA">For factory configured SafeNet Network HSM, and after upgrading earlier SafeNet Network HSM 5.x versions to SafeNet Network HSM 5.2 (or newer), a default appliance (lunash) audit user is automatically created. Upon first login, the audit user is asked to change his password. That appliance audit user would need to initialize the HSM audit role first, before being able to administer the audit logging. The SafeNet Network HSM admin user can create more audit users when necessary.</p>
        <p data-mc-conditions="Default.SA">To simplify configuration,</p>
        <p class="ul1" data-mc-autonum="&lt;b&gt;•&lt;/b&gt;" data-mc-conditions="Default.SA"><span class="autonumber"><span class="ul1Bullet"><b>•</b></span></span>the maximum log file size is capped at 4 MB &#160;&#160;</p>
        <p class="ul1" data-mc-autonum="&lt;b&gt;•&lt;/b&gt;" data-mc-conditions="Default.SA"><span class="autonumber"><span class="ul1Bullet"><b>•</b></span></span>the log path is kept internal &#160;&#160;</p>
        <p class="ul1" data-mc-autonum="&lt;b&gt;•&lt;/b&gt;" data-mc-conditions="Default.SA"><span class="autonumber"><span class="ul1Bullet"><b>•</b></span></span>the rotation offset is set at 0 </p>
        <h3 data-mc-conditions="Default.SA">Audit user on the appliance</h3>
        <p data-mc-conditions="Default.SA">The HSM Audit role does not exist until it is created (initialized). The appliance audit user is a standard user account on SafeNet Network HSM, with default password "PASSWORD" (without the quotation marks)</p>
        <h3>Audit Role on HSM</h3>
        <p>A SafeNet HSM Audit role allows complete separation of Audit responsibilities from the Security Officer (SO or HSM Admin), the Partition User (or Owner), and other HSM roles.    If the Audit role is initialized, the HSM and Partition administrators are prevented from working with the log files, and auditors are unable to perform administrative tasks on the HSM. As a general rule, the Audit role should be created before the HSM Security Officer role, to ensure that all important HSM operations (including those that occur during initialization), are captured.</p>
        <h4>Password-authenticated HSMs</h4>
        <p>For SafeNet HSMs with Password Authentication, the auditor role logs into the HSM to perform their activities using a password.</p>
        <h4>PED-authenticated HSMs</h4>
        <p>For SafeNet HSMs with PED Authentication, the auditor role logs  into the HSM to perform their activities using the Audit (white) PED Key. The Audit feature works only with SafeNet PED version 2.5.0-3 or newer. Older versions of PED firmware are not aware of the Audit role and Audit Key. </p>
        <h4>Role Initialization</h4>
        <p>Ceating the Audit role (and imprinting the white PED&#160;Key for PED authenticated HSMs) does not require the presence or cooperation of the HSM SO.</p>
        <h3 data-mc-conditions="Default.SA">Appliance Audit User Available Commands</h3>
        <p data-mc-conditions="Default.SA">The Audit role has a limited set of operations available to it, on the HSM, as reflected in the reduced command set available to the "audit" user when logged in to the shell (lunash:&gt;). </p><pre xml:space="preserve" data-mc-conditions="Default.SA">login as: audit</pre><pre xml:space="preserve" data-mc-conditions="Default.SA">audit@192.20.9.23's password:</pre><pre xml:space="preserve" data-mc-conditions="Default.SA">Last login: Mon Jan 19 14:28:27 2015 from 192.20.10.110

SafeNet Network HSM 6.0.0-29 Command Line Shell - Copyright (c) 2001-2015 SafeNet, Inc. All rights reserved.

[mylunasa] lunash:&gt;?

The following top-level commands are available:

 Name                 (short)    Description
 --------------------------------------------------------------------------------
 help                 he         Get Help
 exit                 e          Exit Luna Shell
 hsm                  hs         &gt; Hsm
 audit                a          &gt; Audit
 my                   m          &gt; My
 network              n          &gt; Network
</pre>
        <h3>Audit Logging Features</h3>
        <p>The following list summarizes the functionality of the audit secure logging feature:</p>
        <p class="ul1" data-mc-autonum="&lt;b&gt;•&lt;/b&gt;"><span class="autonumber"><span class="ul1Bullet"><b>•</b></span></span>Log entries originate from the SafeNet HSM - the feature is implemented via HSM firmware (rather than in the library)&#160;for maximum security &#160;&#160;</p>
        <p class="ul1" data-mc-autonum="&lt;b&gt;•&lt;/b&gt;"><span class="autonumber"><span class="ul1Bullet"><b>•</b></span></span>Log origin is assured<br /></p>
        <p class="ul1" data-mc-autonum="&lt;b&gt;•&lt;/b&gt;"><span class="autonumber"><span class="ul1Bullet"><b>•</b></span></span>Logs and individual records can be validated by any SafeNet HSM that is a member of the same domain &#160;&#160;</p>
        <p class="ul1" data-mc-autonum="&lt;b&gt;•&lt;/b&gt;"><span class="autonumber"><span class="ul1Bullet"><b>•</b></span></span>The audit logging feature is applicable to password-authenticated (FIPS 140-2 level 2) and to PED-authenticated (FIPS 140-2 level 3) product configurations (but not between the two - see the "same domain" requirement, above)</p>
        <p class="ul1" data-mc-autonum="&lt;b&gt;•&lt;/b&gt;"><span class="autonumber"><span class="ul1Bullet"><b>•</b></span></span>Each entry includes the following:</p>
        <p class="ul2" data-mc-autonum="&lt;b&gt;–&lt;/b&gt;"><span class="autonumber"><span class="ul2Bullet"><b>–</b></span></span>when the event occurred</p>
        <p class="ul2" data-mc-autonum="&lt;b&gt;–&lt;/b&gt;"><span class="autonumber"><span class="ul2Bullet"><b>–</b></span></span>who initiated the event (the authenticated entity) </p>
        <p class="ul2" data-mc-autonum="&lt;b&gt;–&lt;/b&gt;"><span class="autonumber"><span class="ul2Bullet"><b>–</b></span></span>what the event was</p>
        <p class="ul2" data-mc-autonum="&lt;b&gt;–&lt;/b&gt;"><span class="autonumber"><span class="ul2Bullet"><b>–</b></span></span>the result of the logging event (success, error, etc.)</p>
        <p class="ul1" data-mc-autonum="&lt;b&gt;•&lt;/b&gt;"><span class="autonumber"><span class="ul1Bullet"><b>•</b></span></span>Multiple categories of audit logging are supported, configured by the audit role &#160;&#160;</p>
        <p class="ul1" data-mc-autonum="&lt;b&gt;•&lt;/b&gt;"><span class="autonumber"><span class="ul1Bullet"><b>•</b></span></span>Audit management is a separate role - the role creation does not require the presence or co-operation of the SafeNet HSM SO</p>
        <p class="ul1" data-mc-autonum="&lt;b&gt;•&lt;/b&gt;"><span class="autonumber"><span class="ul1Bullet"><b>•</b></span></span>The category of audit logging is configurable by (and only by) the audit role </p>
        <p class="ul1" data-mc-autonum="&lt;b&gt;•&lt;/b&gt;"><span class="autonumber"><span class="ul1Bullet"><b>•</b></span></span>Audit log integrity is ensured against the following:</p>
        <p class="ul2" data-mc-autonum="&lt;b&gt;–&lt;/b&gt;"><span class="autonumber"><span class="ul2Bullet"><b>–</b></span></span>Truncation - erasing part of a log record</p>
        <p class="ul2" data-mc-autonum="&lt;b&gt;–&lt;/b&gt;"><span class="autonumber"><span class="ul2Bullet"><b>–</b></span></span>Modification - modifying a log record </p>
        <p class="ul2" data-mc-autonum="&lt;b&gt;–&lt;/b&gt;"><span class="autonumber"><span class="ul2Bullet"><b>–</b></span></span>Deletion - erasing of the entire log record </p>
        <p class="ul2" data-mc-autonum="&lt;b&gt;–&lt;/b&gt;"><span class="autonumber"><span class="ul2Bullet"><b>–</b></span></span>Addition - writing of a fake log record &#160;</p>
        <p class="ul1" data-mc-autonum="&lt;b&gt;•&lt;/b&gt;"><span class="autonumber"><span class="ul1Bullet"><b>•</b></span></span>Log origin is assured</p>
        <p class="ul1" data-mc-autonum="&lt;b&gt;•&lt;/b&gt;"><span class="autonumber"><span class="ul1Bullet"><b>•</b></span></span>The following critical events are logged unconditionally, regardless of the state of the audit role (initialized or not):</p>
        <p class="ul2" data-mc-autonum="&lt;b&gt;–&lt;/b&gt;"><span class="autonumber"><span class="ul2Bullet"><b>–</b></span></span>Tamper</p>
        <p class="ul2" data-mc-autonum="&lt;b&gt;–&lt;/b&gt;"><span class="autonumber"><span class="ul2Bullet"><b>–</b></span></span>Decommission </p>
        <p class="ul2" data-mc-autonum="&lt;b&gt;–&lt;/b&gt;"><span class="autonumber"><span class="ul2Bullet"><b>–</b></span></span>Zeroization </p>
        <p class="ul2" data-mc-autonum="&lt;b&gt;–&lt;/b&gt;"><span class="autonumber"><span class="ul2Bullet"><b>–</b></span></span>SO creation</p>
        <p class="ul2" data-mc-autonum="&lt;b&gt;–&lt;/b&gt;"><span class="autonumber"><span class="ul2Bullet"><b>–</b></span></span> Audit role creation</p>
        <h3>Audit Log Secret</h3>
        <p>The HSM creates a log secret unique to the HSM, computed during the first initialization after manufacture. The log secret resides in flash memory (permanent, non-volatile memory), and is used to create log records that are sent to a log file. Later, the log secret is used to prove that a log record originated from a legitimate HSM and has not been tampered with. </p>
        <h3>Audit Log Records</h3>
        <p>A log record consists of two fields – the log message and the HMAC for the previous record.  When the HSM  creates a log record, it uses the log secret to compute the SHA256-HMAC of all data contained in that log message, plus the HMAC of the previous log entry.  The HMAC is stored in HSM flash memory.  The log message is then transmitted, along with the HMAC of the previous record, to the host.  The host has a logging daemon to receive and store the log data on the host hard drive. </p>
        <p> For the first log message ever returned from the HSM to the host there is no previous record and, therefore, no HMAC in flash.  In this case, the previous HMAC is set to zero and the first HMAC is computed over the first log message concatenated with 32 zero-bytes.  The first record in the log file  then consists of the first log message plus 32 zero-bytes.  The second record consists of the second message plus HMAC1 = HMAC (message1 || 0x0000).  This results in the organization shown below.</p>
        <table style="width: 100%;mc-table-style: url('../../Resources/TableStyles/Page.css');" class="TableStyle-Page" cellspacing="0">
            <col class="TableStyle-Page-Column-Column1" style="width: 150px;" />
            <col class="TableStyle-Page-Column-Column1" style="width: 150px;" />
            <tbody>
                <tr class="TableStyle-Page-Body-Body1">
                    <td class="TableStyle-Page-BodyE-Column1-Body1">MSG 1</td>
                    <td class="TableStyle-Page-BodyD-Column1-Body1">HMAC 0</td>
                </tr>
                <tr class="TableStyle-Page-Body-Body1">
                    <td class="TableStyle-Page-BodyE-Column1-Body1">&#160;</td>
                    <td class="TableStyle-Page-BodyD-Column1-Body1">. . .</td>
                </tr>
                <tr class="TableStyle-Page-Body-Body1">
                    <td class="TableStyle-Page-BodyE-Column1-Body1">MSG n-1</td>
                    <td class="TableStyle-Page-BodyD-Column1-Body1">HMAC n-2</td>
                </tr>
                <tr class="TableStyle-Page-Body-Body1">
                    <td class="TableStyle-Page-BodyE-Column1-Body1">MSG n</td>
                    <td class="TableStyle-Page-BodyD-Column1-Body1">HMAC n-1</td>
                </tr>
                <tr class="TableStyle-Page-Body-Body1">
                    <td class="TableStyle-Page-BodyE-Column1-Body1">. . . </td>
                    <td class="TableStyle-Page-BodyD-Column1-Body1">&#160;</td>
                </tr>
                <tr class="TableStyle-Page-Body-Body1">
                    <td class="TableStyle-Page-BodyE-Column1-Body1">MSG n+m</td>
                    <td class="TableStyle-Page-BodyD-Column1-Body1">HMAC n+m-1</td>
                </tr>
                <tr class="TableStyle-Page-Body-Body1">
                    <td class="TableStyle-Page-BodyE-Column1-Body1">MSG n+m+1</td>
                    <td class="TableStyle-Page-BodyD-Column1-Body1">HMAC n+m</td>
                </tr>
                <tr class="TableStyle-Page-Body-Body1">
                    <td class="TableStyle-Page-BodyE-Column1-Body1">. . .</td>
                    <td class="TableStyle-Page-BodyD-Column1-Body1">&#160;</td>
                </tr>
                <tr class="TableStyle-Page-Body-Body1">
                    <td class="TableStyle-Page-BodyB-Column1-Body1">MSG end</td>
                    <td class="TableStyle-Page-BodyA-Column1-Body1">HMAC n+m-1</td>
                </tr>
            </tbody>
        </table>
        <p>&#160;</p>
        <table style="width: 100%;mc-table-style: url('../../Resources/TableStyles/Page.css');" class="TableStyle-Page" cellspacing="0">
            <col class="TableStyle-Page-Column-Column1" style="width: 150px;" />
            <col class="TableStyle-Page-Column-Column1" style="width: 150px;" />
            <tbody>
                <tr class="TableStyle-Page-Body-Body1">
                    <td class="TableStyle-Page-BodyB-Column1-Body1">Recent HMAC in NVRAM</td>
                    <td class="TableStyle-Page-BodyA-Column1-Body1">HMAC end</td>
                </tr>
            </tbody>
        </table>
        <p>To verify a sequence of <i>m</i> log records which is a subset of the complete log, starting at index <i>n</i>, the host must submit the data illustrated above.  The HSM calculates the HMAC for each record the same way as it did when the record was originally generated, and compares this HMAC to the value it received.  If all of the calculated HMACs match the received HMACs, then the entire sequence verifies.  If an HMAC doesn’t match, then the associated record and all following records can be considered suspect.  Because the HMAC of each message depends on the HMAC of the previous one, inserting or altering messages would cause the calculated HMAC to be invalid.</p>
        <p>The HSM always stores the HMAC of the most-recently generated log message in flash memory.  When checking truncation, the host would send the newest record in its log to the HSM; and, the HSM would compute the HMAC and compare it to the one in flash.  If it does not match, then truncation has occurred. </p>
        <h3>Audit Log Message Format</h3>
        <p>Each message is a fixed-length, comma delimited, and newline-terminated string.  The table below shows the width and meaning of the fields in a message.</p>
        <table style="width: 100%;mc-table-style: url('../../Resources/TableStyles/Page.css');" class="TableStyle-Page" cellspacing="0">
            <col class="TableStyle-Page-Column-Column1" />
            <col class="TableStyle-Page-Column-Column1" />
            <col style="width: 222px;" class="TableStyle-Page-Column-Column1" />
            <thead>
                <tr class="TableStyle-Page-Head-Header1">
                    <th class="TableStyle-Page-HeadE-Column1-Header1">Offset &#160;&#160;</th>
                    <th class="TableStyle-Page-HeadE-Column1-Header1">Length (Chars)</th>
                    <th class="TableStyle-Page-HeadD-Column1-Header1">Description &#160;&#160;</th>
                </tr>
            </thead>
            <tbody>
                <tr class="TableStyle-Page-Body-Body1">
                    <td class="TableStyle-Page-BodyE-Column1-Body1">0</td>
                    <td class="TableStyle-Page-BodyE-Column1-Body1">10</td>
                    <td class="TableStyle-Page-BodyD-Column1-Body1">Sequence number</td>
                </tr>
                <tr class="TableStyle-Page-Body-Body1">
                    <td class="TableStyle-Page-BodyE-Column1-Body1">10</td>
                    <td class="TableStyle-Page-BodyE-Column1-Body1">1</td>
                    <td class="TableStyle-Page-BodyD-Column1-Body1">Comma</td>
                </tr>
                <tr class="TableStyle-Page-Body-Body1">
                    <td class="TableStyle-Page-BodyE-Column1-Body1">11</td>
                    <td class="TableStyle-Page-BodyE-Column1-Body1">17</td>
                    <td class="TableStyle-Page-BodyD-Column1-Body1">Timestamp</td>
                </tr>
                <tr class="TableStyle-Page-Body-Body1">
                    <td class="TableStyle-Page-BodyE-Column1-Body1">28</td>
                    <td class="TableStyle-Page-BodyE-Column1-Body1">1</td>
                    <td class="TableStyle-Page-BodyD-Column1-Body1">Comma</td>
                </tr>
                <tr class="TableStyle-Page-Body-Body1">
                    <td class="TableStyle-Page-BodyE-Column1-Body1">29</td>
                    <td class="TableStyle-Page-BodyE-Column1-Body1">256</td>
                    <td class="TableStyle-Page-BodyD-Column1-Body1">Message text, interpreted from raw data &#160;&#160;</td>
                </tr>
                <tr class="TableStyle-Page-Body-Body1">
                    <td class="TableStyle-Page-BodyE-Column1-Body1">285</td>
                    <td class="TableStyle-Page-BodyE-Column1-Body1">1</td>
                    <td class="TableStyle-Page-BodyD-Column1-Body1">Comma</td>
                </tr>
                <tr class="TableStyle-Page-Body-Body1">
                    <td class="TableStyle-Page-BodyE-Column1-Body1">286</td>
                    <td class="TableStyle-Page-BodyE-Column1-Body1">64</td>
                    <td class="TableStyle-Page-BodyD-Column1-Body1">HMAC of previous record as ASCII-HEX &#160;&#160;</td>
                </tr>
                <tr class="TableStyle-Page-Body-Body1">
                    <td class="TableStyle-Page-BodyE-Column1-Body1">350</td>
                    <td class="TableStyle-Page-BodyE-Column1-Body1">1</td>
                    <td class="TableStyle-Page-BodyD-Column1-Body1">Comma &#160;&#160;</td>
                </tr>
                <tr class="TableStyle-Page-Body-Body1">
                    <td class="TableStyle-Page-BodyE-Column1-Body1">351</td>
                    <td class="TableStyle-Page-BodyE-Column1-Body1">96</td>
                    <td class="TableStyle-Page-BodyD-Column1-Body1">Data for this record as ASCII-HEX (raw data) &#160;&#160;</td>
                </tr>
                <tr class="TableStyle-Page-Body-Body1">
                    <td class="TableStyle-Page-BodyB-Column1-Body1">447</td>
                    <td class="TableStyle-Page-BodyB-Column1-Body1">1</td>
                    <td class="TableStyle-Page-BodyA-Column1-Body1">Newline '\n'</td>
                </tr>
            </tbody>
        </table>
        <p>The raw data for the message is stored in ASCII-HEX form, along with a human-readable version. Although this format makes the messages larger, it simplifies the verification process, as the HSM expects to receive raw data records.</p>
        <h5>Example</h5>
        <p>The following example shows a sample log record. It is separated into multiple lines for readability even though it is a single record.  Some white spaces are also omitted.</p><pre xml:space="preserve">38,12/08/13 15:30:50,session 1 Access 2147483651:22621 operation LUNA_CREATE_CONTAINER</pre><pre xml:space="preserve">returned LUNA_RET_SM_UNKNOWN_TOSM_STATE(0x00300014) (using PIN (entry=LUNA_ENTRY_DATA_AREA)),</pre><pre xml:space="preserve">29C51014B6F131EC67CF48734101BBE301335C25F43EDF8828745C40755ABE25,</pre><pre xml:space="preserve">2600001003600B00EA552950140030005D580000030000800100000000000000000000000000000000000000</pre><pre xml:space="preserve">&#160;</pre>
        <p>The sequence number is “38”. The time is “12/08/13 15:30:50”.</p>
        <p>The log message is “session 1 Access 2147483651:22621 operation LUNA_CREATE_CONTAINER returned LUNA_RET_SM_UNKNOWN_TOSM_STATE(0x00300014) (using PIN (entry=LUNA_ENTRY_DATA_AREA))”. In the message text, the “who” is the session identified by “session 1 Access 2147483651:22621” (the application is identified by the access ID major = 2147483651, minor = 22621).  The “what” is “LUNA_CREATE_CONTAINER”.  The operation status is “LUNA_RET_SM_UNKNOWN_TOSM_STATE(0x00300014)”.</p>
        <p>The HMAC of previous record is “29C51014B6F131EC67CF48734101BBE301335C25F43EDF8828745C40755ABE25”.</p>
        <p>The remainder is the raw data for this record as ASCII-HEX.</p>
        <p class="ul1" data-mc-autonum="&lt;b&gt;•&lt;/b&gt;"><span class="autonumber"><span class="ul1Bullet"><b>•</b></span></span>The “who” is lunash session “session 1 Access 2147483651:22621” <br />(identified by the lunash access ID major = 2147483651, minor = 22621). </p>
        <p class="ul1" data-mc-autonum="&lt;b&gt;•&lt;/b&gt;"><span class="autonumber"><span class="ul1Bullet"><b>•</b></span></span>The “what” is “LUNA_CREATE_CONTAINER”. </p>
        <p class="ul1" data-mc-autonum="&lt;b&gt;•&lt;/b&gt;"><span class="autonumber"><span class="ul1Bullet"><b>•</b></span></span>The operation status is “LUNA_RET_SM_UNKNOWN_TOSM_STATE(0x00300014)”.</p>
        <p class="note" data-mc-autonum="&lt;b&gt;Note:&lt;/b&gt; &#160;"><span class="autonumber"><span><b>Note:</b> &#160;</span></span>Log Rotation Categories, Rotation Intervals, and other Configurable Factors are covered here in the Administration &amp; Maintenance Manual. Command syntax is in the Reference Manual. </p>
        <h3>Synchronizing Time between HSM and Host</h3>
        <p>The HSM has an internal real-time clock (RTC). The RTC does not have a relevant time value until it is synchronized with the HOST system time. Because the HSM and the host time could drift apart over time, periodic re-synchronization is necessary. Only an authenticated audit officer is allowed to synchronize the time.</p>
        <h3>Log Secret and Log Verification</h3>
        <p>The 256-bit log secret which is used to compute the HMACs is stored in the parameter area on the HSM.  It is set the first time an event is logged. It can be exported from one HSM to another so that a particular sequence of log messages can be verified by the other HSM. Conversely, it can be imported from other HSMs for verification purpose.</p>
        <p>To accomplish cross-HSM verification, the HSM  generates a key-cloning vector (KCV, a.k.a the Domain key) for the audit role when it is initialized.  The KCV can then be used to encrypt the log secret for export to the HOST.</p>
        <p>To verify a log that was generated on another HSM, assuming it is in the same domain, we simply import the wrapped secret, which the HSM subsequently decrypts; any records that are submitted to the host for verification will use this secret thereafter.</p>
        <p>When the HSM exports the secret, it calculates a 32-bit checksum which is appended to the secret before it is encrypted with the KCV.</p>
        <p>When the HSM imports the wrapped secret, it is decrypted, and the 32-bit checksum is calculated over the decrypted secret.  If this doesn’t match the decrypted checksum, then the secret that the HSM is trying to import comes from a system on a different domain, and an error is returned. &#160;&#160;</p>
        <p>To verify a log generated on another HSM,  in the same domain, the host passes to the target HSM the wrapped secret, which the target HSM subsequently decrypts; any records submitted to the target HSM for verification use this secret thereafter.</p>
        <p>Importing a log secret from another HSM does not overwrite the target log secret because the operation  writes the foreign log secret only to a separate parameter area for the wrapped log secret. </p>
        <p class="caution" data-mc-autonum="&lt;b&gt;CAUTION:&lt;/b&gt; &#160;"><span class="autonumber"><span><b>CAUTION:</b> &#160;</span></span>Once an HSM has imported a wrapped log secret from another HSM, it must export and then re-import its own log secret in order to verify its own logs again.</p>
        <h3>Capacity</h3>
        <p>The log capacity of SafeNet HSMs varies depending upon the physical memory available on the device. The SafeNet PCIe HSM and the HSM contained in the SafeNet Network HSM appliance are the SafeNet K6 HSM card. The HSM inside both the SafeNet USB HSM and the SafeNet Remote Backup HSM is the SafeNet G5 HSM module. </p>
        <p>The K6 HSM has approximately 16 MB available for Audit logging (or more than 200,000 records, depending on the size/content of each record).</p>
        <p>The G5 HSM has approximately 4 MB available for Audit logging (or more than 50,000 records, depending on the size/content of each record).</p>
        <p>In both cases, the normal function of Audit Logging is to export log entries constantly to the file system. Short-term, within-the-HSM log storage capacity becomes important only in the rare situations where the HSM remains functioning but the file system is unreachable from the HSM. This would be a rare or unlikely event for an HSM connected to a server or workstation, and almost unheard-of in the closed and hardened environment of a SafeNet Network HSM appliance.</p>
        <h3>Time Reported in Log</h3>
        <p>When you perform <span class="code">audit time get</span> you might see a variance of a few seconds between the reported HSM time and the Host time. Any difference up to five seconds should be considered normal, as the HSM reads new values from its internal clock on a five-second interval. So, typically, Host time would show as slightly ahead.</p>
        <h3>Configuration Persists</h3>
        <p>Audit Logging configuration is not removed or reset upon HSM re-initialization. It survives tamper and decommission and factory reset. Logs must be cleared  by specific command. Therefore, if your security regime requires decommission at end-of-life, or prior to shipping an HSM, then explicit clearing of HSM logs should be part of that procedure.</p>
        <p>This is by design, as part of separation of roles in the HSM. When the Audit role exists, the SO cannot modify the logging configuration, and therefore cannot hide any activity from auditors. </p>
        <h3>Audit Logging Stops Working if the Current Log File is Deleted</h3>
        <p>As a general rule, you should not delete a file while it is open and in use by an application. In most systems, deletion of a file is deletion of an inode, but the actual file itself, while now invisible, remains on the file system until the space is cleaned up or overwritten. If a file is in use by an application - such as audit logging, in this case - the application can continue using and updating that file, unaware that it is now in deleted status. </p>
        <p>If you delete the current audit log file, the audit logging feature does not detect that and does not create a new file, so you might lose log entries. </p>
        <p>The workaround is to restart the pedClient daemon, which creates a new log file.</p>
        <p class="footer"><span class="DefaultProduct">SafeNet Network HSM</span> <span class="DefaultRelease">6.2.2</span> <span class="DefaultProjectTitle">Product Documentation</span> <br /><span class="DefaultPartNumber">007-011136-012</span> <span class="DefaultRevision">Rev. A</span> <span style="color: #5e5e5c;"><![CDATA[  ]]></span> <span class="DefaultDateLong">01 December 2016</span> <span style="color: #5e5e5c;"><![CDATA[  ]]></span> <span class="DefaultCopyright">Copyright 2001-2016</span>&#160;<span class="DefaultCompanyNameLong">Gemalto</span> <span style="color: #5e5e5c;"><![CDATA[  ]]></span>All rights reserved. </p>
    </body>
</html>